import{Y as Ur,N as pe,Z as xn,_ as jr,S as te,i as ee,s as ne,F as ge,H as Me,$ as we,l as sn,p as un,a0 as Oo,a1 as Io,a as Qt,a2 as Br,t as it,g as Nn,b as ct,c as An,d as $t,M as Po,P as Vr,n as he,R as Gr,T as zr,U as Jr,o as kt,v as Dt,z as Ut,a3 as xo,a4 as Le,a5 as Zr,I as qr,L as Yr,X as Wr,r as Ln,j as Xr,k as Hr,Q as Mn,y as Kr}from"./BuiltInSelector-389d765d.js";const Fo=Symbol.for("svelte-maplibre");function cn(){return jr(Fo)}function Qr(){return Ur(Fo,{map:pe(null),source:xn(null),layer:xn(null),popupTarget:xn(null),cluster:pe(),loadedImages:pe(new Set),minzoom:pe(0),maxzoom:pe(24),layerEvent:pe(null)})}function $r(h,u,p){let l;const{map:O}=cn();ge(h,O,x=>p(4,l=x));let{position:d="top-left"}=u,{container:m=void 0}=u,v=null;return Me(()=>{l!=null&&l.loaded()&&v&&l.removeControl(v)}),h.$$set=x=>{"position"in x&&p(1,d=x.position),"container"in x&&p(2,m=x.container)},h.$$.update=()=>{if(h.$$.dirty&30&&l&&!v){let x;typeof m=="string"?x=document.querySelector(m)??void 0:x=m,p(3,v=new we.FullscreenControl({container:x})),l.addControl(v,d)}},[O,d,m,v,l]}class ti extends te{constructor(u){super(),ee(this,u,$r,null,ne,{position:1,container:2})}}function ei(h,u,p){let l;const{map:O}=cn();ge(h,O,w=>p(8,l=w));let{position:d="top-left"}=u,{positionOptions:m=void 0}=u,{fitBoundsOptions:v=void 0}=u,{trackUserLocation:x=!1}=u,{showAccuracyCircle:S=!0}=u,{showUserLocation:A=!0}=u,G=null;return Me(()=>{l!=null&&l.loaded()&&G&&l.removeControl(G)}),h.$$set=w=>{"position"in w&&p(1,d=w.position),"positionOptions"in w&&p(2,m=w.positionOptions),"fitBoundsOptions"in w&&p(3,v=w.fitBoundsOptions),"trackUserLocation"in w&&p(4,x=w.trackUserLocation),"showAccuracyCircle"in w&&p(5,S=w.showAccuracyCircle),"showUserLocation"in w&&p(6,A=w.showUserLocation)},h.$$.update=()=>{h.$$.dirty&510&&l&&!G&&(p(7,G=new we.GeolocateControl({positionOptions:m,fitBoundsOptions:v,trackUserLocation:x,showAccuracyCircle:S,showUserLocation:A})),l.addControl(G,d))},[O,d,m,v,x,S,A,G,l]}class ni extends te{constructor(u){super(),ee(this,u,ei,null,ne,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}var wn=Pn;function Pn(h,u){return h===u||h!==h&&u!==u?!0:typeof h!=typeof u||{}.toString.call(h)!={}.toString.call(u)||h!==Object(h)||!h?!1:Array.isArray(h)?Lo(h,u):{}.toString.call(h)=="[object Set]"?Lo(Array.from(h),Array.from(u)):{}.toString.call(h)=="[object Object]"?ri(h,u):oi(h,u)}function oi(h,u){return h.toString()===u.toString()}function Lo(h,u){var p=h.length;if(p!=u.length)return!1;for(var l=0;l<p;l++)if(!Pn(h[l],u[l]))return!1;return!0}function ri(h,u){var p=Object.keys(h),l=p.length;if(l!=Object.keys(u).length)return!1;for(var O=0;O<l;O++){var d=p[O];if(!(u.hasOwnProperty(d)&&Pn(h[d],u[d])))return!1}return!0}function ii(h,u,p){let l;const{map:O}=cn();ge(h,O,A=>p(6,l=A));let{position:d="top-left"}=u,{showCompass:m=!0}=u,{showZoom:v=!0}=u,{visualizePitch:x=!1}=u,S=null;return Me(()=>{l!=null&&l.loaded()&&S&&l.removeControl(S)}),h.$$set=A=>{"position"in A&&p(1,d=A.position),"showCompass"in A&&p(2,m=A.showCompass),"showZoom"in A&&p(3,v=A.showZoom),"visualizePitch"in A&&p(4,x=A.visualizePitch)},h.$$.update=()=>{h.$$.dirty&126&&l&&!S&&(p(5,S=new we.NavigationControl({showCompass:m,showZoom:v,visualizePitch:x})),l.addControl(S,d))},[O,d,m,v,x,S,l]}class ai extends te{constructor(u){super(),ee(this,u,ii,null,ne,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function si(h,u,p){let l;const{map:O}=cn();ge(h,O,S=>p(5,l=S));let{position:d="bottom-left"}=u,{maxWidth:m=void 0}=u,{unit:v="metric"}=u,x=null;return Me(()=>{l!=null&&l.loaded()&&x&&l.removeControl(x)}),h.$$set=S=>{"position"in S&&p(1,d=S.position),"maxWidth"in S&&p(2,m=S.maxWidth),"unit"in S&&p(3,v=S.unit)},h.$$.update=()=>{h.$$.dirty&62&&l&&!x&&(p(4,x=new we.ScaleControl({maxWidth:m,unit:v})),l.addControl(x,d))},[O,d,m,v,x,l]}class ui extends te{constructor(u){super(),ee(this,u,si,null,ne,{position:1,maxWidth:2,unit:3})}}const ci=h=>({map:h&8,loadedImages:h&16,allImagesLoaded:h&32}),Mo=h=>({map:h[3],loadedImages:h[4],allImagesLoaded:h[5]});function wo(h){let u,p,l=h[2]&&No(h);const O=h[27].default,d=Vr(O,h,h[26],Mo);return{c(){l&&l.c(),u=he(),d&&d.c()},m(m,v){l&&l.m(m,v),Qt(m,u,v),d&&d.m(m,v),p=!0},p(m,v){m[2]?l?(l.p(m,v),v&4&&it(l,1)):(l=No(m),l.c(),it(l,1),l.m(u.parentNode,u)):l&&(Nn(),ct(l,1,1,()=>{l=null}),An()),d&&d.p&&(!p||v&67108920)&&Gr(d,O,m,m[26],p?Jr(O,m[26],v,ci):zr(m[26]),Mo)},i(m){p||(it(l),it(d,m),p=!0)},o(m){ct(l),ct(d,m),p=!1},d(m){m&&$t(u),l&&l.d(m),d&&d.d(m)}}}function No(h){let u,p,l,O,d,m,v,x;return u=new ai({props:{position:h[6]}}),l=new ni({props:{position:h[6],fitBoundsOptions:{maxZoom:12}}}),d=new ti({props:{position:h[6]}}),v=new ui({props:{position:h[6]}}),{c(){kt(u.$$.fragment),p=he(),kt(l.$$.fragment),O=he(),kt(d.$$.fragment),m=he(),kt(v.$$.fragment)},m(S,A){Dt(u,S,A),Qt(S,p,A),Dt(l,S,A),Qt(S,O,A),Dt(d,S,A),Qt(S,m,A),Dt(v,S,A),x=!0},p(S,A){const G={};A&64&&(G.position=S[6]),u.$set(G);const w={};A&64&&(w.position=S[6]),l.$set(w);const B={};A&64&&(B.position=S[6]),d.$set(B);const L={};A&64&&(L.position=S[6]),v.$set(L)},i(S){x||(it(u.$$.fragment,S),it(l.$$.fragment,S),it(d.$$.fragment,S),it(v.$$.fragment,S),x=!0)},o(S){ct(u.$$.fragment,S),ct(l.$$.fragment,S),ct(d.$$.fragment,S),ct(v.$$.fragment,S),x=!1},d(S){S&&($t(p),$t(O),$t(m)),Ut(u,S),Ut(l,S),Ut(d,S),Ut(v,S)}}}function li(h){let u,p,l,O,d,m=h[3]&&h[0]&&wo(h);return{c(){u=sn("div"),m&&m.c(),un(u,"class",p=Oo(h[1])+" svelte-p00lfq"),Io(u,"expand-map",!h[1])},m(v,x){Qt(v,u,x),m&&m.m(u,null),l=!0,O||(d=Br(h[9].call(null,u)),O=!0)},p(v,[x]){v[3]&&v[0]?m?(m.p(v,x),x&9&&it(m,1)):(m=wo(v),m.c(),it(m,1),m.m(u,null)):m&&(Nn(),ct(m,1,1,()=>{m=null}),An()),(!l||x&2&&p!==(p=Oo(v[1])+" svelte-p00lfq"))&&un(u,"class",p),(!l||x&2)&&Io(u,"expand-map",!v[1])},i(v){l||(it(m),l=!0)},o(v){ct(m),l=!1},d(v){v&&$t(u),m&&m.d(),O=!1,d()}}}function di(h,u,p){let l,O,d,m,{$$slots:v={},$$scope:x}=u,{map:S=null}=u,{class:A=void 0}=u,{style:G}=u,{center:w=[0,0]}=u,{zoom:B=1}=u,{pitch:L=0}=u,{bearing:F=0}=u,{bounds:X=void 0}=u,{loaded:Et=!1}=u,{minZoom:H=0}=u,{maxZoom:Y=22}=u,{interactive:oe=!0}=u,{attributionControl:jt=!0}=u,{preserveDrawingBuffer:ye=!1}=u,{maxBounds:re=void 0}=u,{images:ie=[]}=u,{standardControls:Bt=!1}=u,{filterLayers:Vt=void 0}=u,{transformRequest:at=void 0}=u;const ht=Po(),{map:gt,loadedImages:Gt}=Qr();ge(h,gt,T=>p(3,d=T)),ge(h,Gt,T=>p(4,m=T));let Mt=new Set;function me(T){d!=null&&d.loaded()&&("url"in T?(Mt.add(T.id),d.loadImage(T.url,(j,Ct)=>{Mt.delete(T.id),j?ht("error",j):Ct&&(d==null||d.addImage(T.id,Ct,T.options),m.add(T.id),Gt.set(m))})):(d.addImage(T.id,T.data,T.options),m.add(T.id),Gt.set(m)))}function ve(T){return xo(gt,d=new we.Map({container:T,style:G,center:w,zoom:B,pitch:L,bearing:F,minZoom:H,maxZoom:Y,interactive:oe,preserveDrawingBuffer:ye,maxBounds:re,bounds:X,attributionControl:jt,transformRequest:at}),d),d.on("load",j=>{p(0,Et=!0),ht("load",d)}),d.on("error",j=>ht("error",{...j,map:d})),d.on("movestart",j=>ht("movestart",{...j,map:d})),d.on("moveend",j=>{p(10,w=j.target.getCenter()),p(11,B=j.target.getZoom()),p(12,X=j.target.getBounds()),ht("moveend",{...j,map:d})}),d.on("zoomstart",j=>ht("zoomstart",{...j,map:d})),d.on("zoom",j=>{p(11,B=j.target.getZoom()),ht("zoom",{...j,map:d})}),d.on("zoomend",j=>{p(11,B=j.target.getZoom()),ht("zoomend",{...j,map:d})}),d.on("styledata",j=>{if(d&&Vt){const Ct=d.getStyle().layers;if(Ct)for(let ot of Ct)Vt(ot)||d.setLayoutProperty(ot.id,"visibility","none")}ht("styledata",{...j,map:d})}),{destroy(){p(0,Et=!1),d==null||d.remove(),xo(gt,d=null,d)}}}return h.$$set=T=>{"map"in T&&p(13,S=T.map),"class"in T&&p(1,A=T.class),"style"in T&&p(14,G=T.style),"center"in T&&p(10,w=T.center),"zoom"in T&&p(11,B=T.zoom),"pitch"in T&&p(15,L=T.pitch),"bearing"in T&&p(16,F=T.bearing),"bounds"in T&&p(12,X=T.bounds),"loaded"in T&&p(0,Et=T.loaded),"minZoom"in T&&p(17,H=T.minZoom),"maxZoom"in T&&p(18,Y=T.maxZoom),"interactive"in T&&p(19,oe=T.interactive),"attributionControl"in T&&p(20,jt=T.attributionControl),"preserveDrawingBuffer"in T&&p(21,ye=T.preserveDrawingBuffer),"maxBounds"in T&&p(22,re=T.maxBounds),"images"in T&&p(23,ie=T.images),"standardControls"in T&&p(2,Bt=T.standardControls),"filterLayers"in T&&p(24,Vt=T.filterLayers),"transformRequest"in T&&p(25,at=T.transformRequest),"$$scope"in T&&p(26,x=T.$$scope)},h.$$.update=()=>{if(h.$$.dirty&4&&p(6,l=typeof Bt=="boolean"?void 0:Bt),h.$$.dirty&8&&p(13,S=d),h.$$.dirty&8388617&&Et&&d!=null&&d.loaded())for(let T of ie)!Mt.has(T.id)&&!d.hasImage(T.id)&&me(T);h.$$.dirty&8388624&&p(5,O=ie.every(T=>m.has(T.id))),h.$$.dirty&1032&&w&&!wn(w,d==null?void 0:d.getCenter())&&(d==null||d.panTo(w)),h.$$.dirty&2056&&B&&!wn(B,d==null?void 0:d.getZoom())&&(d==null||d.zoomTo(B)),h.$$.dirty&4104&&X&&!wn(X,d==null?void 0:d.getBounds())&&(d==null||d.fitBounds(X))},[Et,A,Bt,d,m,O,l,gt,Gt,ve,w,B,X,S,G,L,F,H,Y,oe,jt,ye,re,ie,Vt,at,x,v]}class fi extends te{constructor(u){super(),ee(this,u,di,li,ne,{map:13,class:1,style:14,center:10,zoom:11,pitch:15,bearing:16,bounds:12,loaded:0,minZoom:17,maxZoom:18,interactive:19,attributionControl:20,preserveDrawingBuffer:21,maxBounds:22,images:23,standardControls:2,filterLayers:24,transformRequest:25})}}var Ro={exports:{}};(function(h,u){(function(p,l){h.exports=l()})(Le,function(){var p=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(i,a,g){if(n[i]===void 0)throw new Error("Invalid event type: "+i);n[i].push({selector:a,fn:g})},render:function(i){e.store.featureChanged(i)}},r=function(i,a){for(var g=n[i],y=g.length;y--;){var C=g[y];if(C.selector(a)){C.fn.call(o,a)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(o),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(i){r("drag",i)},click:function(i){r("click",i)},mousemove:function(i){r("mousemove",i)},mousedown:function(i){r("mousedown",i)},mouseup:function(i){r("mouseup",i)},mouseout:function(i){r("mouseout",i)},keydown:function(i){r("keydown",i)},keyup:function(i){r("keyup",i)},touchstart:function(i){r("touchstart",i)},touchmove:function(i){r("touchmove",i)},touchend:function(i){r("touchend",i)},tap:function(i){r("tap",i)}}};function l(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function o(){if(this instanceof o){var r=[null];r.push.apply(r,arguments);var i=Function.bind.apply(e,r);return new i}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);Object.defineProperty(n,o,r.get?r:{enumerable:!0,get:function(){return t[o]}})}),n}var O={},d={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},m=d;function v(t){var e=0;if(t&&t.length>0){e+=Math.abs(x(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(x(t[n]))}return e}function x(t){var e,n,o,r,i,a,g=0,y=t.length;if(y>2){for(a=0;a<y;a++)a===y-2?(o=y-2,r=y-1,i=0):a===y-1?(o=y-1,r=0,i=1):(o=a,r=a+1,i=a+2),e=t[o],n=t[r],g+=(S(t[i][0])-S(e[0]))*Math.sin(S(n[1]));g=g*m.RADIUS*m.RADIUS/2}return g}function S(t){return t*Math.PI/180}O.geometry=function t(e){var n,o=0;switch(e.type){case"Polygon":return v(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=v(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},O.ring=x;var A={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},G={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},w={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},B={POLYGON:"polygon",LINE:"line_string",POINT:"point"},L={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},F={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},X={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Et={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},H={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Y={ACTIVE:"true",INACTIVE:"false"},oe=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],jt=-85,ye=Object.freeze({__proto__:null,classes:A,sources:G,cursors:w,types:B,geojsonTypes:L,modes:F,events:X,updateActions:Et,meta:H,activeStates:Y,interactions:oe,LAT_MIN:-90,LAT_RENDERED_MIN:jt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),re={Point:0,LineString:1,MultiLineString:1,Polygon:2};function ie(t,e){var n=re[t.geometry.type]-re[e.geometry.type];return n===0&&t.geometry.type===L.POLYGON?t.area-e.area:n}function Bt(t){return t.map(function(e){return e.geometry.type===L.POLYGON&&(e.area=O.geometry({type:L.FEATURE,property:{},geometry:e.geometry})),e}).sort(ie).map(function(e){return delete e.area,e})}function Vt(t,e){return e===void 0&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function at(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),t[e]!==void 0&&(typeof t[e]=="string"?this._items[t[e]]=e:this._nums[t[e]]=e)}at.prototype.add=function(t){return this.has(t)||(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length),this},at.prototype.delete=function(t){return this.has(t)===!1||(this._length--,delete this._items[t],delete this._nums[t]),this},at.prototype.has=function(t){return(typeof t=="string"||typeof t=="number")&&(this._items[t]!==void 0||this._nums[t]!==void 0)},at.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach(function(n){e.push({k:n,v:t._items[n]})}),Object.keys(this._nums).forEach(function(n){e.push({k:JSON.parse(n),v:t._nums[n]})}),e.sort(function(n,o){return n.v-o.v}).map(function(n){return n.k})},at.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var ht=[H.FEATURE,H.MIDPOINT,H.VERTEX],gt={click:function(t,e,n){return Gt(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return Gt(t,e,n,n.options.touchBuffer)}};function Gt(t,e,n,o){if(n.map===null)return[];var r=t?Vt(t,o):e,i={};n.options.styles&&(i.layers=n.options.styles.map(function(C){return C.id}));var a=n.map.queryRenderedFeatures(r,i).filter(function(C){return ht.indexOf(C.properties.meta)!==-1}),g=new at,y=[];return a.forEach(function(C){var E=C.properties.id;g.has(E)||(g.add(E),y.push(C))}),Bt(y)}function Mt(t,e){var n=gt.click(t,null,e),o={mouse:w.NONE};return n[0]&&(o.mouse=n[0].properties.active===Y.ACTIVE?w.MOVE:w.POINTER,o.feature=n[0].properties.meta),e.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=w.ADD),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}function me(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function ve(t,e,n){n===void 0&&(n={});var o=n.fineTolerance!=null?n.fineTolerance:4,r=n.grossTolerance!=null?n.grossTolerance:12,i=n.interval!=null?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var a=me(t.point,e.point);return a<o||a<r&&e.time-t.time<i}function T(t,e,n){n===void 0&&(n={});var o=n.tolerance!=null?n.tolerance:25,r=n.interval!=null?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,me(t.point,e.point)<o&&e.time-t.time<r}var j={},Ct={get exports(){return j},set exports(t){j=t}}.exports=function(t,e){if(e||(e=16),t===void 0&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,t/o))/Math.log(e)*o;var r=n-Math.floor(n),i="";for(o=0;o<Math.floor(n);o++)i=Math.floor(Math.random()*e).toString(e)+i;if(r){var a=Math.pow(e,r);i=Math.floor(Math.random()*a).toString(e)+i}var g=parseInt(i,e);return g!==1/0&&g>=Math.pow(2,t)?Ct(t,e):i};Ct.rack=function(t,e,n){var o=function(i){var a=0;do{if(a++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var g=Ct(t,e)}while(Object.hasOwnProperty.call(r,g));return r[g]=i,g},r=o.hats={};return o.get=function(i){return o.hats[i]},o.set=function(i,a){return o.hats[i]=a,o},o.bits=t||128,o.base=e||16,o};var ot=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||j(),this.type=e.geometry.type};ot.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ot.prototype.incomingCoords=function(t){this.setCoordinates(t)},ot.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},ot.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ot.prototype.setProperty=function(t,e){this.properties[t]=e},ot.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:L.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ot.prototype.internal=function(t){var e={id:this.id,meta:H.FEATURE,"meta:type":this.type,active:Y.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:L.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var zt=function(t,e){ot.call(this,t,e)};(zt.prototype=Object.create(ot.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},zt.prototype.updateCoordinate=function(t,e,n){this.coordinates=arguments.length===3?[e,n]:[t,e],this.changed()},zt.prototype.getCoordinate=function(){return this.getCoordinates()};var Tt=function(t,e){ot.call(this,t,e)};(Tt.prototype=Object.create(ot.prototype)).isValid=function(){return this.coordinates.length>1},Tt.prototype.addCoordinate=function(t,e,n){this.changed();var o=parseInt(t,10);this.coordinates.splice(o,0,[e,n])},Tt.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},Tt.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},Tt.prototype.updateCoordinate=function(t,e,n){var o=parseInt(t,10);this.coordinates[o]=[e,n],this.changed()};var dt=function(t,e){ot.call(this,t,e),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(dt.prototype=Object.create(ot.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(t){return t.length>2})},dt.prototype.incomingCoords=function(t){this.coordinates=t.map(function(e){return e.slice(0,-1)}),this.changed()},dt.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},dt.prototype.addCoordinate=function(t,e,n){this.changed();var o=t.split(".").map(function(r){return parseInt(r,10)});this.coordinates[o[0]].splice(o[1],0,[e,n])},dt.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},dt.prototype.getCoordinate=function(t){var e=t.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},dt.prototype.getCoordinates=function(){return this.coordinates.map(function(t){return t.concat([t[0]])})},dt.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);this.coordinates[r]===void 0&&(this.coordinates[r]=[]),this.coordinates[r][i]=[e,n]};var jo={MultiPoint:zt,MultiLineString:Tt,MultiPolygon:dt},Ne=function(t,e,n,o,r){var i=n.split("."),a=parseInt(i[0],10),g=i[1]?i.slice(1).join("."):null;return t[a][e](g,o,r)},lt=function(t,e){if(ot.call(this,t,e),delete this.coordinates,this.model=jo[e.geometry.type],this.model===void 0)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function R(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(lt.prototype=Object.create(ot.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map(function(o){return new n(e.ctx,{id:j(),type:L.FEATURE,properties:{},geometry:{coordinates:o,type:e.type.replace("Multi","")}})})},lt.prototype.isValid=function(){return this.features.every(function(t){return t.isValid()})},lt.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},lt.prototype.getCoordinate=function(t){return Ne(this.features,"getCoordinate",t)},lt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(t){return t.type===L.POLYGON?t.getCoordinates():t.coordinates})))},lt.prototype.updateCoordinate=function(t,e,n){Ne(this.features,"updateCoordinate",t,e,n),this.changed()},lt.prototype.addCoordinate=function(t,e,n){Ne(this.features,"addCoordinate",t,e,n),this.changed()},lt.prototype.removeCoordinate=function(t){Ne(this.features,"removeCoordinate",t),this.changed()},lt.prototype.getFeatures=function(){return this.features},R.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},R.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce(function(n,o){return n[o.feature_id]===void 0&&(n[o.feature_id]=!0,e._ctx.store.get(o.feature_id).changed()),n},{})},R.prototype.getSelected=function(){return this._ctx.store.getSelected()},R.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},R.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},R.prototype.getFeature=function(t){return this._ctx.store.get(t)},R.prototype.select=function(t){return this._ctx.store.select(t)},R.prototype.deselect=function(t){return this._ctx.store.deselect(t)},R.prototype.deleteFeature=function(t,e){return e===void 0&&(e={}),this._ctx.store.delete(t,e)},R.prototype.addFeature=function(t){return this._ctx.store.add(t)},R.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},R.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},R.prototype.setActionableState=function(t){t===void 0&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},R.prototype.changeMode=function(t,e,n){return e===void 0&&(e={}),n===void 0&&(n={}),this._ctx.events.changeMode(t,e,n)},R.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},R.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},R.prototype.featuresAt=function(t,e,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return gt[n](t,e,this._ctx)},R.prototype.newFeature=function(t){var e=t.geometry.type;return e===L.POINT?new zt(this._ctx,t):e===L.LINE_STRING?new Tt(this._ctx,t):e===L.POLYGON?new dt(this._ctx,t):new lt(this._ctx,t)},R.prototype.isInstanceOf=function(t,e){if(t===L.POINT)return e instanceof zt;if(t===L.LINE_STRING)return e instanceof Tt;if(t===L.POLYGON)return e instanceof dt;if(t==="MultiFeature")return e instanceof lt;throw new Error("Unknown feature class: "+t)},R.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},R.prototype.onSetup=function(){},R.prototype.onDrag=function(){},R.prototype.onClick=function(){},R.prototype.onMouseMove=function(){},R.prototype.onMouseDown=function(){},R.prototype.onMouseUp=function(){},R.prototype.onMouseOut=function(){},R.prototype.onKeyUp=function(){},R.prototype.onKeyDown=function(){},R.prototype.onTouchStart=function(){},R.prototype.onTouchMove=function(){},R.prototype.onTouchEnd=function(){},R.prototype.onTap=function(){},R.prototype.onStop=function(){},R.prototype.onTrash=function(){},R.prototype.onCombineFeature=function(){},R.prototype.onUncombineFeature=function(){},R.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Fn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Bo=Object.keys(Fn);function Vo(t){var e=Object.keys(t);return function(n,o){o===void 0&&(o={});var r={},i=e.reduce(function(a,g){return a[g]=t[g],a},new R(n));return{start:function(){var a=this;r=i.onSetup(o),Bo.forEach(function(g){var y,C=Fn[g],E=function(){return!1};t[C]&&(E=function(){return!0}),a.on(g,E,(y=C,function(_){return i[y](r,_)}))})},stop:function(){i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(a,g){i.toDisplayFeatures(r,a,g)}}}}function _e(t){return[].concat(t).filter(function(e){return e!==void 0})}function Go(){var t=this;if(!(t.ctx.map&&t.ctx.map.getSource(G.HOT)!==void 0))return y();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],o=[];t.isDirty?o=t.getAllIds():(n=t.getChangedIds().filter(function(C){return t.get(C)!==void 0}),o=t.sources.hot.filter(function(C){return C.properties.id&&n.indexOf(C.properties.id)===-1&&t.get(C.properties.id)!==void 0}).map(function(C){return C.properties.id})),t.sources.hot=[];var r=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(function(C){var E=C.properties.id||C.properties.parent;return n.indexOf(E)===-1});var i=r!==t.sources.cold.length||o.length>0;function a(C,E){var _=t.get(C).internal(e);t.ctx.events.currentModeRender(_,function(N){t.sources[E].push(N)})}if(n.forEach(function(C){return a(C,"hot")}),o.forEach(function(C){return a(C,"cold")}),i&&t.ctx.map.getSource(G.COLD).setData({type:L.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(G.HOT).setData({type:L.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(X.SELECTION_CHANGE,{features:t.getSelected().map(function(C){return C.toGeoJSON()}),points:t.getSelectedCoordinates().map(function(C){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:C.coordinates}}})}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var g=t._deletedFeaturesToEmit.map(function(C){return C.toGeoJSON()});t._deletedFeaturesToEmit=[],t.ctx.map.fire(X.DELETE,{features:g})}function y(){t.isDirty=!1,t.clearChangedIds()}y(),t.ctx.map.fire(X.RENDER,{})}function z(t){var e,n=this;this._features={},this._featureIds=new at,this._selectedFeatureIds=new at,this._selectedCoordinates=[],this._changedFeatureIds=new at,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame(function(){e=null,Go.call(n)}))},this.isDirty=!1}function Rn(t,e){var n=t._selectedCoordinates.filter(function(o){return t._selectedFeatureIds.has(o.feature_id)});t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}z.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},z.prototype.setDirty=function(){return this.isDirty=!0,this},z.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},z.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},z.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},z.prototype.getAllIds=function(){return this._featureIds.values()},z.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},z.prototype.delete=function(t,e){var n=this;return e===void 0&&(e={}),_e(t).forEach(function(o){n._featureIds.has(o)&&(n._featureIds.delete(o),n._selectedFeatureIds.delete(o),e.silent||n._deletedFeaturesToEmit.indexOf(n._features[o])===-1&&n._deletedFeaturesToEmit.push(n._features[o]),delete n._features[o],n.isDirty=!0)}),Rn(this,e),this},z.prototype.get=function(t){return this._features[t]},z.prototype.getAll=function(){var t=this;return Object.keys(this._features).map(function(e){return t._features[e]})},z.prototype.select=function(t,e){var n=this;return e===void 0&&(e={}),_e(t).forEach(function(o){n._selectedFeatureIds.has(o)||(n._selectedFeatureIds.add(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),this},z.prototype.deselect=function(t,e){var n=this;return e===void 0&&(e={}),_e(t).forEach(function(o){n._selectedFeatureIds.has(o)&&(n._selectedFeatureIds.delete(o),n._changedFeatureIds.add(o),e.silent||(n._emitSelectionChange=!0))}),Rn(this,e),this},z.prototype.clearSelected=function(t){return t===void 0&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},z.prototype.setSelected=function(t,e){var n=this;return e===void 0&&(e={}),t=_e(t),this.deselect(this._selectedFeatureIds.values().filter(function(o){return t.indexOf(o)===-1}),{silent:e.silent}),this.select(t.filter(function(o){return!n._selectedFeatureIds.has(o)}),{silent:e.silent}),this},z.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},z.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},z.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},z.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map(function(e){return t.get(e)})},z.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map(function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}})},z.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},z.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},z.prototype.storeMapConfig=function(){var t=this;oe.forEach(function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())})},z.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach(function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()})},z.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]===void 0||this._mapInitialConfig[t]};var wt=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o=t[n];for(var r in o)zo.call(o,r)&&(e[r]=o[r])}return e},zo=Object.prototype.hasOwnProperty,Jo=["mode","feature","mouse"];function Zo(t){var e=null,n=null,o={onRemove:function(){return t.map.off("load",o.connect),clearInterval(n),o.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect:function(){t.map.off("load",o.connect),clearInterval(n),o.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(r){var i=r.fire;return r.fire=function(a,g){var y=arguments;return i.length===1&&arguments.length!==1&&(y=[wt({},{type:a},g)]),i.apply(r,y)},t.map=r,t.events=function(a){var g=Object.keys(a.options.modes).reduce(function(f,I){return f[I]=Vo(a.options.modes[I]),f},{}),y={},C={},E={},_=null,N=null;E.drag=function(f,I){I({point:f.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:w.DRAG}),N.drag(f)):f.originalEvent.stopPropagation()},E.mousedrag=function(f){E.drag(f,function(I){return!ve(y,I)})},E.touchdrag=function(f){E.drag(f,function(I){return!T(C,I)})},E.mousemove=function(f){if((f.originalEvent.buttons!==void 0?f.originalEvent.buttons:f.originalEvent.which)===1)return E.mousedrag(f);var I=Mt(f,a);f.featureTarget=I,N.mousemove(f)},E.mousedown=function(f){y={time:new Date().getTime(),point:f.point};var I=Mt(f,a);f.featureTarget=I,N.mousedown(f)},E.mouseup=function(f){var I=Mt(f,a);f.featureTarget=I,ve(y,{point:f.point,time:new Date().getTime()})?N.click(f):N.mouseup(f)},E.mouseout=function(f){N.mouseout(f)},E.touchstart=function(f){if(f.originalEvent.preventDefault(),a.options.touchEnabled){C={time:new Date().getTime(),point:f.point};var I=gt.touch(f,null,a)[0];f.featureTarget=I,N.touchstart(f)}},E.touchmove=function(f){if(f.originalEvent.preventDefault(),a.options.touchEnabled)return N.touchmove(f),E.touchdrag(f)},E.touchend=function(f){if(f.originalEvent.preventDefault(),a.options.touchEnabled){var I=gt.touch(f,null,a)[0];f.featureTarget=I,T(C,{time:new Date().getTime(),point:f.point})?N.tap(f):N.touchend(f)}};var q=function(f){return!(f===8||f===46||f>=48&&f<=57)};function P(f,I,D){D===void 0&&(D={}),N.stop();var rt=g[f];if(rt===void 0)throw new Error(f+" is not valid");_=f;var Q=rt(a,I);N=p(Q,a),D.silent||a.map.fire(X.MODE_CHANGE,{mode:f}),a.store.setDirty(),a.store.render()}E.keydown=function(f){(f.srcElement||f.target).classList[0]==="mapboxgl-canvas"&&(f.keyCode!==8&&f.keyCode!==46||!a.options.controls.trash?q(f.keyCode)?N.keydown(f):f.keyCode===49&&a.options.controls.point?P(F.DRAW_POINT):f.keyCode===50&&a.options.controls.line_string?P(F.DRAW_LINE_STRING):f.keyCode===51&&a.options.controls.polygon&&P(F.DRAW_POLYGON):(f.preventDefault(),N.trash()))},E.keyup=function(f){q(f.keyCode)&&N.keyup(f)},E.zoomend=function(){a.store.changeZoom()},E.data=function(f){if(f.dataType==="style"){var I=a.setup,D=a.map,rt=a.options,Q=a.store;rt.styles.some(function(yn){return D.getLayer(yn.id)})||(I.addLayers(),Q.setDirty(),Q.render())}};var K={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){_=a.options.defaultMode,N=p(g[_](a),a)},changeMode:P,actionable:function(f){var I=!1;Object.keys(f).forEach(function(D){if(K[D]===void 0)throw new Error("Invalid action type");K[D]!==f[D]&&(I=!0),K[D]=f[D]}),I&&a.map.fire(X.ACTIONABLE,{actions:K})},currentModeName:function(){return _},currentModeRender:function(f,I){return N.render(f,I)},fire:function(f,I){E[f]&&E[f](I)},addEventListeners:function(){a.map.on("mousemove",E.mousemove),a.map.on("mousedown",E.mousedown),a.map.on("mouseup",E.mouseup),a.map.on("data",E.data),a.map.on("touchmove",E.touchmove),a.map.on("touchstart",E.touchstart),a.map.on("touchend",E.touchend),a.container.addEventListener("mouseout",E.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",E.keydown),a.container.addEventListener("keyup",E.keyup))},removeEventListeners:function(){a.map.off("mousemove",E.mousemove),a.map.off("mousedown",E.mousedown),a.map.off("mouseup",E.mouseup),a.map.off("data",E.data),a.map.off("touchmove",E.touchmove),a.map.off("touchstart",E.touchstart),a.map.off("touchend",E.touchend),a.container.removeEventListener("mouseout",E.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",E.keydown),a.container.removeEventListener("keyup",E.keyup))},trash:function(f){N.trash(f)},combineFeatures:function(){N.combineFeatures()},uncombineFeatures:function(){N.uncombineFeatures()},getMode:function(){return _}}}(t),t.ui=function(a){var g={},y=null,C={mode:null,feature:null,mouse:null},E={mode:null,feature:null,mouse:null};function _(f){E=wt(E,f)}function N(){var f,I;if(a.container){var D=[],rt=[];Jo.forEach(function(Q){E[Q]!==C[Q]&&(D.push(Q+"-"+C[Q]),E[Q]!==null&&rt.push(Q+"-"+E[Q]))}),D.length>0&&(f=a.container.classList).remove.apply(f,D),rt.length>0&&(I=a.container.classList).add.apply(I,rt),C=wt(C,E)}}function q(f,I){I===void 0&&(I={});var D=document.createElement("button");return D.className=A.CONTROL_BUTTON+" "+I.className,D.setAttribute("title",I.title),I.container.appendChild(D),D.addEventListener("click",function(rt){if(rt.preventDefault(),rt.stopPropagation(),rt.target===y)return P(),void I.onDeactivate();K(f),I.onActivate()},!0),D}function P(){y&&(y.classList.remove(A.ACTIVE_BUTTON),y=null)}function K(f){P();var I=g[f];I&&I&&f!=="trash"&&(I.classList.add(A.ACTIVE_BUTTON),y=I)}return{setActiveButton:K,queueMapClasses:_,updateMapClasses:N,clearMapClasses:function(){_({mode:null,feature:null,mouse:null}),N()},addButtons:function(){var f=a.options.controls,I=document.createElement("div");return I.className=A.CONTROL_GROUP+" "+A.CONTROL_BASE,f&&(f[B.LINE]&&(g[B.LINE]=q(B.LINE,{container:I,className:A.CONTROL_BUTTON_LINE,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(F.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),f[B.POLYGON]&&(g[B.POLYGON]=q(B.POLYGON,{container:I,className:A.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(F.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),f[B.POINT]&&(g[B.POINT]=q(B.POINT,{container:I,className:A.CONTROL_BUTTON_POINT,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(F.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),f.trash&&(g.trash=q("trash",{container:I,className:A.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){a.events.trash()}})),f.combine_features&&(g.combine_features=q("combineFeatures",{container:I,className:A.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),f.uncombine_features&&(g.uncombine_features=q("uncombineFeatures",{container:I,className:A.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),I},removeButtons:function(){Object.keys(g).forEach(function(f){var I=g[f];I.parentNode&&I.parentNode.removeChild(I),delete g[f]})}}}(t),t.container=r.getContainer(),t.store=new z(t),e=t.ui.addButtons(),t.options.boxSelect&&(r.boxZoom.disable(),r.dragPan.disable(),r.dragPan.enable()),r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval(function(){r.loaded()&&o.connect()},16)),t.events.start(),e},addLayers:function(){t.map.addSource(G.COLD,{data:{type:L.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(G.HOT,{data:{type:L.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(function(r){t.map.addLayer(r)}),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach(function(r){t.map.getLayer(r.id)&&t.map.removeLayer(r.id)}),t.map.getSource(G.COLD)&&t.map.removeSource(G.COLD),t.map.getSource(G.HOT)&&t.map.removeSource(G.HOT)}};return t.setup=o,o}var kn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Ae(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function Dn(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&t.originalEvent.button===0}function Jt(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===Y.ACTIVE&&t.featureTarget.properties.meta===H.FEATURE}function ln(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===Y.INACTIVE&&t.featureTarget.properties.meta===H.FEATURE}function Pe(t){return t.featureTarget===void 0}function Un(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===H.FEATURE}function be(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===H.VERTEX}function Fe(t){return!!t.originalEvent&&t.originalEvent.shiftKey===!0}function Re(t){return t.keyCode===27}function ke(t){return t.keyCode===13}var qo=Object.freeze({__proto__:null,isOfMetaType:Ae,isShiftMousedown:Dn,isActiveFeature:Jt,isInactiveFeature:ln,noTarget:Pe,isFeature:Un,isVertex:be,isShiftDown:Fe,isEscapeKey:Re,isEnterKey:ke,isTrue:function(){return!0}}),Yo=ae;function ae(t,e){this.x=t,this.y=e}function dn(t,e){var n=e.getBoundingClientRect();return new Yo(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function se(t,e,n,o){return{type:L.FEATURE,properties:{meta:H.VERTEX,parent:t,coord_path:n,active:o?Y.ACTIVE:Y.INACTIVE},geometry:{type:L.POINT,coordinates:e}}}function jn(t,e,n){var o=e.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>85||o[1]<jt||r[1]>85||r[1]<jt)return null;var i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:L.FEATURE,properties:{meta:H.MIDPOINT,parent:t,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:L.POINT,coordinates:[i.lng,i.lat]}}}function De(t,e,n){e===void 0&&(e={}),n===void 0&&(n=null);var o,r=t.geometry,i=r.type,a=r.coordinates,g=t.properties&&t.properties.id,y=[];function C(_,N){var q="",P=null;_.forEach(function(K,f){var I=N!=null?N+"."+f:String(f),D=se(g,K,I,E(I));if(e.midpoints&&P){var rt=jn(g,P,D);rt&&y.push(rt)}P=D;var Q=JSON.stringify(K);q!==Q&&y.push(D),f===0&&(q=Q)})}function E(_){return!!e.selectedPaths&&e.selectedPaths.indexOf(_)!==-1}return i===L.POINT?y.push(se(g,a,n,E(n))):i===L.POLYGON?a.forEach(function(_,N){C(_,n!==null?n+"."+N:String(N))}):i===L.LINE_STRING?C(a,n):i.indexOf(L.MULTI_PREFIX)===0&&(o=i.replace(L.MULTI_PREFIX,""),a.forEach(function(_,N){var q={type:L.FEATURE,properties:t.properties,geometry:{type:o,coordinates:_}};y=y.concat(De(q,e,N))})),y}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=o,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),r=e.x+n*(this.x-e.x)-o*(this.y-e.y),i=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(t){return t instanceof ae?t:Array.isArray(t)?new ae(t[0],t[1]):t};var yt={enable:function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable:function(t){setTimeout(function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()},0)}},Ee={},Wo={get exports(){return Ee},set exports(t){Ee=t}},Bn=function(t){if(!t||!t.type)return null;var e=Xo[t.type];if(!e)return null;if(e==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if(e==="feature")return{type:"FeatureCollection",features:[t]};if(e==="featurecollection")return t},Xo={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ho=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce(function(n,o){return n.concat(t(o))},[]),e;case"Feature":return e.geometry?t(e.geometry).map(function(n){var o={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:n};return e.id!==void 0&&(o.id=e.id),o}):[e];case"MultiPoint":return e.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return e.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return e.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return e.geometries.map(t).reduce(function(n,o){return n.concat(o)},[]);case"Point":case"Polygon":case"LineString":return[e]}}}),Ko=Bn,Ue=l(Ho),Qo=function(t){return function e(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(o,r){return Array.isArray(r)&&Array.isArray(r[0])?o.concat(e(r)):(o.push(r),o)},[])}(t)};Ue instanceof Function||(Ue=Ue.default);var fn={},$o={get exports(){return fn},set exports(t){fn=t}}.exports=function(t){return new ft(t)};function ft(t){this.value=t}function Vn(t,e,n){var o=[],r=[],i=!0;return function a(g){var y=n?Gn(g):g,C={},E=!0,_={node:y,node_:g,path:[].concat(o),parent:r[r.length-1],parents:r,key:o.slice(-1)[0],isRoot:o.length===0,level:o.length,circular:null,update:function(P,K){_.isRoot||(_.parent.node[_.key]=P),_.node=P,K&&(E=!1)},delete:function(P){delete _.parent.node[_.key],P&&(E=!1)},remove:function(P){zn(_.parent.node)?_.parent.node.splice(_.key,1):delete _.parent.node[_.key],P&&(E=!1)},keys:null,before:function(P){C.before=P},after:function(P){C.after=P},pre:function(P){C.pre=P},post:function(P){C.post=P},stop:function(){i=!1},block:function(){E=!1}};if(!i)return _;function N(){if(typeof _.node=="object"&&_.node!==null){_.keys&&_.node_===_.node||(_.keys=je(_.node)),_.isLeaf=_.keys.length==0;for(var P=0;P<r.length;P++)if(r[P].node_===g){_.circular=r[P];break}}else _.isLeaf=!0,_.keys=null;_.notLeaf=!_.isLeaf,_.notRoot=!_.isRoot}N();var q=e.call(_,_.node);return q!==void 0&&_.update&&_.update(q),C.before&&C.before.call(_,_.node),E&&(typeof _.node!="object"||_.node===null||_.circular||(r.push(_),N(),Be(_.keys,function(P,K){o.push(P),C.pre&&C.pre.call(_,_.node[P],P);var f=a(_.node[P]);n&&Ve.call(_.node,P)&&(_.node[P]=f.node),f.isLast=K==_.keys.length-1,f.isFirst=K==0,C.post&&C.post.call(_,f),o.pop()}),r.pop()),C.after&&C.after.call(_,_.node)),_}(t).node}function Gn(t){if(typeof t=="object"&&t!==null){var e;if(zn(t))e=[];else if(ue(t)==="[object Date]")e=new Date(t.getTime?t.getTime():t);else if(function(r){return ue(r)==="[object RegExp]"}(t))e=new RegExp(t);else if(function(r){return ue(r)==="[object Error]"}(t))e={message:t.message};else if(function(r){return ue(r)==="[object Boolean]"}(t))e=new Boolean(t);else if(function(r){return ue(r)==="[object Number]"}(t))e=new Number(t);else if(function(r){return ue(r)==="[object String]"}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},o=function(){};o.prototype=n,e=new o}return Be(je(t),function(r){e[r]=t[r]}),e}return t}ft.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!Ve.call(e,o)){e=void 0;break}e=e[o]}return e},ft.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!Ve.call(e,o))return!1;e=e[o]}return!0},ft.prototype.set=function(t,e){for(var n=this.value,o=0;o<t.length-1;o++){var r=t[o];Ve.call(n,r)||(n[r]={}),n=n[r]}return n[t[o]]=e,e},ft.prototype.map=function(t){return Vn(this.value,t,!0)},ft.prototype.forEach=function(t){return this.value=Vn(this.value,t,!1),this.value},ft.prototype.reduce=function(t,e){var n=arguments.length===1,o=n?this.value:e;return this.forEach(function(r){this.isRoot&&n||(o=t.call(this,o,r))}),o},ft.prototype.paths=function(){var t=[];return this.forEach(function(e){t.push(this.path)}),t},ft.prototype.nodes=function(){var t=[];return this.forEach(function(e){t.push(this.node)}),t},ft.prototype.clone=function(){var t=[],e=[];return function n(o){for(var r=0;r<t.length;r++)if(t[r]===o)return e[r];if(typeof o=="object"&&o!==null){var i=Gn(o);return t.push(o),e.push(i),Be(je(o),function(a){i[a]=n(o[a])}),t.pop(),e.pop(),i}return o}(this.value)};var je=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function ue(t){return Object.prototype.toString.call(t)}var zn=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"},Be=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};Be(je(ft.prototype),function(t){$o[t]=function(e){var n=[].slice.call(arguments,1),o=new ft(e);return o[t].apply(o,n)}});var Ve=Object.hasOwnProperty||function(t,e){return e in t},tr=st;function st(t){if(!(this instanceof st))return new st(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}st.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},st.prototype.equals=function(t){var e;return e=t instanceof st?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},st.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},st.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof st?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},st.prototype.bbox=function(){return this._valid?this._bbox:null},st.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},st.prototype.intersect=function(t){return this._valid?(e=t instanceof st?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},st.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},st.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var er=function(t){if(!t)return[];var e=Ue(Ko(t)),n=[];return e.features.forEach(function(o){o.geometry&&(n=n.concat(Qo(o.geometry.coordinates)))}),n},nr=fn,or=tr,Jn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},rr=Object.keys(Jn);function pn(t){for(var e=or(),n=er(t),o=0;o<n.length;o++)e.include(n[o]);return e}Wo.exports=function(t){return pn(t).bbox()},Ee.polygon=function(t){return pn(t).polygon()},Ee.bboxify=function(t){return nr(t).map(function(e){e&&rr.some(function(n){return!!e[n]&&Jn[n].indexOf(e.type)!==-1})&&(e.bbox=pn(e).bbox(),this.update(e))})};var Ge=-90;function hn(t,e){var n=Ge,o=90,r=Ge,i=90,a=270,g=-270;t.forEach(function(C){var E=Ee(C),_=E[1],N=E[3],q=E[0],P=E[2];_>n&&(n=_),N<o&&(o=N),N>r&&(r=N),_<i&&(i=_),q<a&&(a=q),P>g&&(g=P)});var y=e;return n+y.lat>85&&(y.lat=85-n),r+y.lat>90&&(y.lat=90-r),o+y.lat<-85&&(y.lat=-85-o),i+y.lat<Ge&&(y.lat=Ge-i),a+y.lng<=-270&&(y.lng+=360*Math.ceil(Math.abs(y.lng)/360)),g+y.lng>=270&&(y.lng-=360*Math.ceil(Math.abs(y.lng)/360)),y}function gn(t,e){var n=hn(t.map(function(o){return o.toGeoJSON()}),e);t.forEach(function(o){var r,i=o.getCoordinates(),a=function(y){var C={lng:y[0]+n.lng,lat:y[1]+n.lat};return[C.lng,C.lat]},g=function(y){return y.map(function(C){return a(C)})};o.type===L.POINT?r=a(i):o.type===L.LINE_STRING||o.type===L.MULTI_POINT?r=i.map(a):o.type===L.POLYGON||o.type===L.MULTI_LINE_STRING?r=i.map(g):o.type===L.MULTI_POLYGON&&(r=i.map(function(y){return y.map(function(C){return g(C)})})),o.incomingCoords(r)})}var tt={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(o){return e.getFeature(o)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(X.UPDATE,{action:Et.MOVE,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter(function(g){return t.isInstanceOf("MultiFeature",g)}),o=!1;if(e.length>1){o=!0;var r=e[0].type.replace("Multi","");e.forEach(function(g){g.type.replace("Multi","")!==r&&(o=!1)})}var i=n.length>0,a=e.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:i,trash:a})},getUniqueIds:function(t){return t.length?t.map(function(e){return e.properties.id}).filter(function(e){return e!==void 0}).reduce(function(e,n){return e.add(n),e},new at).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){yt.enable(this)},onMouseMove:function(t){return this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};tt.onTap=tt.onClick=function(t,e){return Pe(e)?this.clickAnywhere(t,e):Ae(H.VERTEX)(e)?this.clickOnVertex(t,e):Un(e)?this.clickOnFeature(t,e):void 0},tt.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(o){return e.doRender(o)})),yt.enable(this),this.stopExtendedInteractions(t)},tt.clickOnVertex=function(t,e){this.changeMode(F.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:w.MOVE})},tt.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},tt.clickOnFeature=function(t,e){var n=this;yt.disable(this),this.stopExtendedInteractions(t);var o=Fe(e),r=this.getSelectedIds(),i=e.featureTarget.properties.id,a=this.isSelected(i);if(!o&&a&&this.getFeature(i).type!==L.POINT)return this.changeMode(F.DIRECT_SELECT,{featureId:i});a&&o?(this.deselect(i),this.updateUIClasses({mouse:w.POINTER}),r.length===1&&yt.enable(this)):!a&&o?(this.select(i),this.updateUIClasses({mouse:w.MOVE})):a||o||(r.forEach(function(g){return n.doRender(g)}),this.setSelected(i),this.updateUIClasses({mouse:w.MOVE})),this.doRender(i)},tt.onMouseDown=function(t,e){return Jt(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&Dn(e)?this.startBoxSelect(t,e):void 0},tt.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=dn(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},tt.onTouchStart=function(t,e){if(Jt(e))return this.startOnActiveFeature(t,e)},tt.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},tt.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:w.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(A.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=dn(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),r=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),a=Math.max(t.boxSelectStartLocation.y,n.y),g="translate("+o+"px, "+i+"px)";t.boxSelectElement.style.transform=g,t.boxSelectElement.style.WebkitTransform=g,t.boxSelectElement.style.width=r-o+"px",t.boxSelectElement.style.height=a-i+"px"},tt.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};gn(this.getSelected(),n),t.dragMoveLocation=e.lngLat},tt.onTouchEnd=tt.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var o=[t.boxSelectStartLocation,dn(e.originalEvent,this.map.getContainer())],r=this.featuresAt(null,o,"click"),i=this.getUniqueIds(r).filter(function(a){return!n.isSelected(a)});i.length&&(this.select(i),i.forEach(function(a){return n.doRender(a)}),this.updateUIClasses({mouse:w.MOVE}))}this.stopExtendedInteractions(t)},tt.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?Y.ACTIVE:Y.INACTIVE,n(e),this.fireActionable(),e.properties.active===Y.ACTIVE&&e.geometry.type!==L.POINT&&De(e).forEach(n)},tt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},tt.onCombineFeatures=function(){var t=this.getSelected();if(!(t.length===0||t.length<2)){for(var e=[],n=[],o=t[0].type.replace("Multi",""),r=0;r<t.length;r++){var i=t[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach(function(g){e.push(g)}):e.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:L.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:e}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(X.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},tt.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(e.length!==0){for(var n=[],o=[],r=function(a){var g=e[a];t.isInstanceOf("MultiFeature",g)&&(g.getFeatures().forEach(function(y){t.addFeature(y),y.properties=g.properties,n.push(y.toGeoJSON()),t.select([y.id])}),t.deleteFeature(g.id,{silent:!0}),o.push(g.toGeoJSON()))},i=0;i<e.length;i++)r(i);n.length>1&&this.map.fire(X.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var Zn=Ae(H.VERTEX),ir=Ae(H.MIDPOINT),Nt={fireUpdate:function(){this.map.fire(X.UPDATE,{action:Et.CHANGE_COORDINATES,features:this.getSelected().map(function(t){return t.toGeoJSON()})})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,o=t.selectedCoordPaths.indexOf(n.coord_path);Fe(e)||o!==-1?Fe(e)&&o===-1&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var r=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map(function(n){return{feature_id:t,coord_path:n}})},onFeature:function(t,e){t.selectedCoordPaths.length===0?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){gn(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var o=t.selectedCoordPaths.map(function(g){return t.feature.getCoordinate(g)}),r=hn(o.map(function(g){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:g}}}),n),i=0;i<o.length;i++){var a=o[i];t.feature.updateCoordinate(t.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(F.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(F.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===L.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,o.selectedCoordPaths)),this.setSelected(e),yt.disable(this),this.setActionableState({trash:!0}),o},onStop:function(){yt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=Y.ACTIVE,n(e),De(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=Y.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort(function(e,n){return n.localeCompare(e,"en",{numeric:!0})}).forEach(function(e){return t.feature.removeCoordinate(e)}),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(F.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=Jt(e),o=Zn(e),r=t.selectedCoordPaths.length===0;return n&&r||o&&!r?this.updateUIClasses({mouse:w.MOVE}):this.updateUIClasses({mouse:w.NONE}),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};Nt.onTouchStart=Nt.onMouseDown=function(t,e){return Zn(e)?this.onVertex(t,e):Jt(e)?this.onFeature(t,e):ir(e)?this.onMidpoint(t,e):void 0},Nt.onDrag=function(t,e){if(t.canDragMove===!0){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},Nt.onClick=function(t,e){return Pe(e)?this.clickNoTarget(t,e):Jt(e)?this.clickActiveFeature(t,e):ln(e)?this.clickInactive(t,e):void this.stopDragging(t)},Nt.onTap=function(t,e){return Pe(e)?this.clickNoTarget(t,e):Jt(e)?this.clickActiveFeature(t,e):ln(e)?this.clickInactive(t,e):void 0},Nt.onTouchEnd=Nt.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var vt={};function ze(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}vt.onSetup=function(){var t=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:w.ADD}),this.activateUIButton(B.POINT),this.setActionableState({trash:!0}),{point:t}},vt.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT)},vt.onTap=vt.onClick=function(t,e){this.updateUIClasses({mouse:w.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(X.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.point.id]})},vt.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},vt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.point.id;if(e.properties.active=o?Y.ACTIVE:Y.INACTIVE,!o)return n(e)},vt.onTrash=vt.stopDrawingAndRemove,vt.onKeyUp=function(t,e){if(Re(e)||ke(e))return this.stopDrawingAndRemove(t,e)};var Zt={onSetup:function(){var t=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),yt.disable(this),this.updateUIClasses({mouse:w.ADD}),this.activateUIButton(B.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ze(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:w.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),be(e)&&this.updateUIClasses({mouse:w.POINTER})}};Zt.onTap=Zt.onClick=function(t,e){return be(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},Zt.onKeyUp=function(t,e){Re(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT)):ke(e)&&this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},Zt.onStop=function(t){this.updateUIClasses({mouse:w.NONE}),yt.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(X.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT,{},{silent:!0})))},Zt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?Y.ACTIVE:Y.INACTIVE,!o)return n(e);if(e.geometry.coordinates.length!==0){var r=e.geometry.coordinates[0].length;if(!(r<3)){if(e.properties.meta=H.FEATURE,n(se(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),r>3){var i=e.geometry.coordinates[0].length-3;n(se(t.polygon.id,e.geometry.coordinates[0][i],"0."+i,!1))}if(r<=4){var a=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:L.FEATURE,properties:e.properties,geometry:{coordinates:a,type:L.LINE_STRING}}),r===3)return}return n(e)}}},Zt.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT)};var qt={onSetup:function(t){var e,n,o=(t=t||{}).featureId,r="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var i=t.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=e.coordinates.length-1;if(e.coordinates[a][0]===i[0]&&e.coordinates[a][1]===i[1])n=a+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[a]));else{if(e.coordinates[0][0]!==i[0]||e.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),yt.disable(this),this.updateUIClasses({mouse:w.ADD}),this.activateUIButton(B.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:r}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ze(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&ze(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:w.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),be(e)&&this.updateUIClasses({mouse:w.POINTER})}};qt.onTap=qt.onClick=function(t,e){if(be(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},qt.onKeyUp=function(t,e){ke(e)?this.changeMode(F.SIMPLE_SELECT,{featureIds:[t.line.id]}):Re(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT))},qt.onStop=function(t){yt.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(X.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT,{},{silent:!0})))},qt.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(F.SIMPLE_SELECT)},qt.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?Y.ACTIVE:Y.INACTIVE,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=H.FEATURE,n(se(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],""+(t.direction==="forward"?e.geometry.coordinates.length-2:1),!1)),n(e))};var qn={simple_select:tt,direct_select:Nt,draw_point:vt,draw_polygon:Zt,draw_line_string:qt},ar={defaultMode:F.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:kn,modes:qn,controls:{},userProperties:!1},sr={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ur={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Yn(t,e){return t.map(function(n){return n.source?n:wt(n,{id:n.id+"."+e,source:e==="hot"?G.HOT:G.COLD})})}var Je={};(function(t,e){var n="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",i="[object Array]",a="[object Boolean]",g="[object Date]",y="[object Error]",C="[object Function]",E="[object Map]",_="[object Number]",N="[object Object]",q="[object Promise]",P="[object RegExp]",K="[object Set]",f="[object String]",I="[object Symbol]",D="[object WeakMap]",rt="[object ArrayBuffer]",Q="[object DataView]",yn=/^\[object .+?Constructor\]$/,pr=/^(?:0|[1-9]\d*)$/,J={};J["[object Float32Array]"]=J["[object Float64Array]"]=J["[object Int8Array]"]=J["[object Int16Array]"]=J["[object Int32Array]"]=J["[object Uint8Array]"]=J["[object Uint8ClampedArray]"]=J["[object Uint16Array]"]=J["[object Uint32Array]"]=!0,J[r]=J[i]=J[rt]=J[a]=J[Q]=J[g]=J[y]=J[C]=J[E]=J[_]=J[N]=J[P]=J[K]=J[f]=J[D]=!1;var Xn=typeof Le=="object"&&Le&&Le.Object===Object&&Le,hr=typeof self=="object"&&self&&self.Object===Object&&self,St=Xn||hr||Function("return this")(),Hn=e&&!e.nodeType&&e,Kn=Hn&&t&&!t.nodeType&&t,Qn=Kn&&Kn.exports===Hn,mn=Qn&&Xn.process,$n=function(){try{return mn&&mn.binding&&mn.binding("util")}catch{}}(),to=$n&&$n.isTypedArray;function gr(s,c){for(var b=-1,M=s==null?0:s.length;++b<M;)if(c(s[b],b,s))return!0;return!1}function yr(s){var c=-1,b=Array(s.size);return s.forEach(function(M,Z){b[++c]=[Z,M]}),b}function mr(s){var c=-1,b=Array(s.size);return s.forEach(function(M){b[++c]=M}),b}var eo,no,oo,vr=Array.prototype,_r=Function.prototype,qe=Object.prototype,vn=St["__core-js_shared__"],ro=_r.toString,_t=qe.hasOwnProperty,io=(eo=/[^.]+$/.exec(vn&&vn.keys&&vn.keys.IE_PROTO||""))?"Symbol(src)_1."+eo:"",ao=qe.toString,br=RegExp("^"+ro.call(_t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),so=Qn?St.Buffer:void 0,Ye=St.Symbol,uo=St.Uint8Array,co=qe.propertyIsEnumerable,Er=vr.splice,Yt=Ye?Ye.toStringTag:void 0,lo=Object.getOwnPropertySymbols,Cr=so?so.isBuffer:void 0,Tr=(no=Object.keys,oo=Object,function(s){return no(oo(s))}),_n=ce(St,"DataView"),Ce=ce(St,"Map"),bn=ce(St,"Promise"),En=ce(St,"Set"),Cn=ce(St,"WeakMap"),Te=ce(Object,"create"),Sr=Ht(_n),Or=Ht(Ce),Ir=Ht(bn),xr=Ht(En),Lr=Ht(Cn),fo=Ye?Ye.prototype:void 0,Tn=fo?fo.valueOf:void 0;function Wt(s){var c=-1,b=s==null?0:s.length;for(this.clear();++c<b;){var M=s[c];this.set(M[0],M[1])}}function Ot(s){var c=-1,b=s==null?0:s.length;for(this.clear();++c<b;){var M=s[c];this.set(M[0],M[1])}}function Xt(s){var c=-1,b=s==null?0:s.length;for(this.clear();++c<b;){var M=s[c];this.set(M[0],M[1])}}function We(s){var c=-1,b=s==null?0:s.length;for(this.__data__=new Xt;++c<b;)this.add(s[c])}function At(s){var c=this.__data__=new Ot(s);this.size=c.size}function Mr(s,c){var b=Ke(s),M=!b&&Fr(s),Z=!b&&!M&&Sn(s),k=!b&&!M&&!Z&&Eo(s),W=b||M||Z||k,$=W?function(nt,bt){for(var It=-1,ut=Array(nt);++It<nt;)ut[It]=bt(It);return ut}(s.length,String):[],mt=$.length;for(var et in s)!c&&!_t.call(s,et)||W&&(et=="length"||Z&&(et=="offset"||et=="parent")||k&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||Pr(et,mt))||$.push(et);return $}function Xe(s,c){for(var b=s.length;b--;)if(mo(s[b][0],c))return b;return-1}function Se(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Yt&&Yt in Object(s)?function(c){var b=_t.call(c,Yt),M=c[Yt];try{c[Yt]=void 0;var Z=!0}catch{}var k=ao.call(c);return Z&&(b?c[Yt]=M:delete c[Yt]),k}(s):function(c){return ao.call(c)}(s)}function po(s){return Oe(s)&&Se(s)==r}function ho(s,c,b,M,Z){return s===c||(s==null||c==null||!Oe(s)&&!Oe(c)?s!=s&&c!=c:function(k,W,$,mt,et,nt){var bt=Ke(k),It=Ke(W),ut=bt?i:Pt(k),xt=It?i:Pt(W),le=(ut=ut==r?N:ut)==N,Qe=(xt=xt==r?N:xt)==N,de=ut==xt;if(de&&Sn(k)){if(!Sn(W))return!1;bt=!0,le=!1}if(de&&!le)return nt||(nt=new At),bt||Eo(k)?go(k,W,$,mt,et,nt):function(V,U,$e,Ft,On,pt,Lt){switch($e){case Q:if(V.byteLength!=U.byteLength||V.byteOffset!=U.byteOffset)return!1;V=V.buffer,U=U.buffer;case rt:return!(V.byteLength!=U.byteLength||!pt(new uo(V),new uo(U)));case a:case g:case _:return mo(+V,+U);case y:return V.name==U.name&&V.message==U.message;case P:case f:return V==U+"";case E:var Rt=yr;case K:var xe=1&Ft;if(Rt||(Rt=mr),V.size!=U.size&&!xe)return!1;var tn=Lt.get(V);if(tn)return tn==U;Ft|=2,Lt.set(V,U);var fe=go(Rt(V),Rt(U),Ft,On,pt,Lt);return Lt.delete(V),fe;case I:if(Tn)return Tn.call(V)==Tn.call(U)}return!1}(k,W,ut,$,mt,et,nt);if(!(1&$)){var Ie=le&&_t.call(k,"__wrapped__"),Co=Qe&&_t.call(W,"__wrapped__");if(Ie||Co){var kr=Ie?k.value():k,Dr=Co?W.value():W;return nt||(nt=new At),et(kr,Dr,$,mt,nt)}}return de?(nt||(nt=new At),function(V,U,$e,Ft,On,pt){var Lt=1&$e,Rt=yo(V),xe=Rt.length,tn=yo(U).length;if(xe!=tn&&!Lt)return!1;for(var fe=xe;fe--;){var Kt=Rt[fe];if(!(Lt?Kt in U:_t.call(U,Kt)))return!1}var To=pt.get(V);if(To&&pt.get(U))return To==U;var en=!0;pt.set(V,U),pt.set(U,V);for(var In=Lt;++fe<xe;){var nn=V[Kt=Rt[fe]],on=U[Kt];if(Ft)var So=Lt?Ft(on,nn,Kt,U,V,pt):Ft(nn,on,Kt,V,U,pt);if(!(So===void 0?nn===on||On(nn,on,$e,Ft,pt):So)){en=!1;break}In||(In=Kt=="constructor")}if(en&&!In){var rn=V.constructor,an=U.constructor;rn==an||!("constructor"in V)||!("constructor"in U)||typeof rn=="function"&&rn instanceof rn&&typeof an=="function"&&an instanceof an||(en=!1)}return pt.delete(V),pt.delete(U),en}(k,W,$,mt,et,nt)):!1}(s,c,b,M,ho,Z))}function wr(s){return!(!bo(s)||function(c){return!!io&&io in c}(s))&&(vo(s)?br:yn).test(Ht(s))}function Nr(s){if(b=(c=s)&&c.constructor,M=typeof b=="function"&&b.prototype||qe,c!==M)return Tr(s);var c,b,M,Z=[];for(var k in Object(s))_t.call(s,k)&&k!="constructor"&&Z.push(k);return Z}function go(s,c,b,M,Z,k){var W=1&b,$=s.length,mt=c.length;if($!=mt&&!(W&&mt>$))return!1;var et=k.get(s);if(et&&k.get(c))return et==c;var nt=-1,bt=!0,It=2&b?new We:void 0;for(k.set(s,c),k.set(c,s);++nt<$;){var ut=s[nt],xt=c[nt];if(M)var le=W?M(xt,ut,nt,c,s,k):M(ut,xt,nt,s,c,k);if(le!==void 0){if(le)continue;bt=!1;break}if(It){if(!gr(c,function(Qe,de){if(Ie=de,!It.has(Ie)&&(ut===Qe||Z(ut,Qe,b,M,k)))return It.push(de);var Ie})){bt=!1;break}}else if(ut!==xt&&!Z(ut,xt,b,M,k)){bt=!1;break}}return k.delete(s),k.delete(c),bt}function yo(s){return function(c,b,M){var Z=b(c);return Ke(c)?Z:function(k,W){for(var $=-1,mt=W.length,et=k.length;++$<mt;)k[et+$]=W[$];return k}(Z,M(c))}(s,Rr,Ar)}function He(s,c){var b,M,Z=s.__data__;return((M=typeof(b=c))=="string"||M=="number"||M=="symbol"||M=="boolean"?b!=="__proto__":b===null)?Z[typeof c=="string"?"string":"hash"]:Z.map}function ce(s,c){var b=function(M,Z){return M==null?void 0:M[Z]}(s,c);return wr(b)?b:void 0}Wt.prototype.clear=function(){this.__data__=Te?Te(null):{},this.size=0},Wt.prototype.delete=function(s){var c=this.has(s)&&delete this.__data__[s];return this.size-=c?1:0,c},Wt.prototype.get=function(s){var c=this.__data__;if(Te){var b=c[s];return b===n?void 0:b}return _t.call(c,s)?c[s]:void 0},Wt.prototype.has=function(s){var c=this.__data__;return Te?c[s]!==void 0:_t.call(c,s)},Wt.prototype.set=function(s,c){var b=this.__data__;return this.size+=this.has(s)?0:1,b[s]=Te&&c===void 0?n:c,this},Ot.prototype.clear=function(){this.__data__=[],this.size=0},Ot.prototype.delete=function(s){var c=this.__data__,b=Xe(c,s);return!(b<0)&&(b==c.length-1?c.pop():Er.call(c,b,1),--this.size,!0)},Ot.prototype.get=function(s){var c=this.__data__,b=Xe(c,s);return b<0?void 0:c[b][1]},Ot.prototype.has=function(s){return Xe(this.__data__,s)>-1},Ot.prototype.set=function(s,c){var b=this.__data__,M=Xe(b,s);return M<0?(++this.size,b.push([s,c])):b[M][1]=c,this},Xt.prototype.clear=function(){this.size=0,this.__data__={hash:new Wt,map:new(Ce||Ot),string:new Wt}},Xt.prototype.delete=function(s){var c=He(this,s).delete(s);return this.size-=c?1:0,c},Xt.prototype.get=function(s){return He(this,s).get(s)},Xt.prototype.has=function(s){return He(this,s).has(s)},Xt.prototype.set=function(s,c){var b=He(this,s),M=b.size;return b.set(s,c),this.size+=b.size==M?0:1,this},We.prototype.add=We.prototype.push=function(s){return this.__data__.set(s,n),this},We.prototype.has=function(s){return this.__data__.has(s)},At.prototype.clear=function(){this.__data__=new Ot,this.size=0},At.prototype.delete=function(s){var c=this.__data__,b=c.delete(s);return this.size=c.size,b},At.prototype.get=function(s){return this.__data__.get(s)},At.prototype.has=function(s){return this.__data__.has(s)},At.prototype.set=function(s,c){var b=this.__data__;if(b instanceof Ot){var M=b.__data__;if(!Ce||M.length<199)return M.push([s,c]),this.size=++b.size,this;b=this.__data__=new Xt(M)}return b.set(s,c),this.size=b.size,this};var Ar=lo?function(s){return s==null?[]:(s=Object(s),function(c,b){for(var M=-1,Z=c==null?0:c.length,k=0,W=[];++M<Z;){var $=c[M];b($,M,c)&&(W[k++]=$)}return W}(lo(s),function(c){return co.call(s,c)}))}:function(){return[]},Pt=Se;function Pr(s,c){return!!(c=c??o)&&(typeof s=="number"||pr.test(s))&&s>-1&&s%1==0&&s<c}function Ht(s){if(s!=null){try{return ro.call(s)}catch{}try{return s+""}catch{}}return""}function mo(s,c){return s===c||s!=s&&c!=c}(_n&&Pt(new _n(new ArrayBuffer(1)))!=Q||Ce&&Pt(new Ce)!=E||bn&&Pt(bn.resolve())!=q||En&&Pt(new En)!=K||Cn&&Pt(new Cn)!=D)&&(Pt=function(s){var c=Se(s),b=c==N?s.constructor:void 0,M=b?Ht(b):"";if(M)switch(M){case Sr:return Q;case Or:return E;case Ir:return q;case xr:return K;case Lr:return D}return c});var Fr=po(function(){return arguments}())?po:function(s){return Oe(s)&&_t.call(s,"callee")&&!co.call(s,"callee")},Ke=Array.isArray,Sn=Cr||function(){return!1};function vo(s){if(!bo(s))return!1;var c=Se(s);return c==C||c=="[object GeneratorFunction]"||c=="[object AsyncFunction]"||c=="[object Proxy]"}function _o(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=o}function bo(s){var c=typeof s;return s!=null&&(c=="object"||c=="function")}function Oe(s){return s!=null&&typeof s=="object"}var Eo=to?function(s){return function(c){return s(c)}}(to):function(s){return Oe(s)&&_o(s.length)&&!!J[Se(s)]};function Rr(s){return(c=s)!=null&&_o(c.length)&&!vo(c)?Mr(s):Nr(s);var c}t.exports=function(s,c){return ho(s,c)}})({get exports(){return Je},set exports(t){Je=t}},Je);var cr=Je;function Wn(t,e){return t.length===e.length&&JSON.stringify(t.map(function(n){return n}).sort())===JSON.stringify(e.map(function(n){return n}).sort())}var lr={Polygon:dt,LineString:Tt,Point:zt,MultiPolygon:lt,MultiLineString:lt,MultiPoint:lt},dr=Object.freeze({__proto__:null,CommonSelectors:qo,constrainFeatureMovement:hn,createMidPoint:jn,createSupplementaryPoints:De,createVertex:se,doubleClickZoom:yt,euclideanDistance:me,featuresAt:gt,getFeatureAtAndSetCursors:Mt,isClick:ve,isEventAtCoordinates:ze,isTap:T,mapEventToBoundingBox:Vt,ModeHandler:p,moveFeatures:gn,sortFeatures:Bt,stringSetsAreEqual:Wn,StringSet:at,theme:kn,toDenseArray:_e}),fr=function(t,e){var n={options:t=function(r){r===void 0&&(r={});var i=wt(r);return r.controls||(i.controls={}),r.displayControlsDefault===!1?i.controls=wt(ur,r.controls):i.controls=wt(sr,r.controls),(i=wt(ar,i)).styles=Yn(i.styles,"cold").concat(Yn(i.styles,"hot")),i}(t)};e=function(r,i){return i.modes=F,i.getFeatureIdsAt=function(a){return gt.click({point:a},null,r).map(function(g){return g.properties.id})},i.getSelectedIds=function(){return r.store.getSelectedIds()},i.getSelected=function(){return{type:L.FEATURE_COLLECTION,features:r.store.getSelectedIds().map(function(a){return r.store.get(a)}).map(function(a){return a.toGeoJSON()})}},i.getSelectedPoints=function(){return{type:L.FEATURE_COLLECTION,features:r.store.getSelectedCoordinates().map(function(a){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:a.coordinates}}})}},i.set=function(a){if(a.type===void 0||a.type!==L.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");var g=r.store.createRenderBatch(),y=r.store.getAllIds().slice(),C=i.add(a),E=new at(C);return(y=y.filter(function(_){return!E.has(_)})).length&&i.delete(y),g(),C},i.add=function(a){var g=JSON.parse(JSON.stringify(Bn(a))).features.map(function(y){if(y.id=y.id||j(),y.geometry===null)throw new Error("Invalid geometry: null");if(r.store.get(y.id)===void 0||r.store.get(y.id).type!==y.geometry.type){var C=lr[y.geometry.type];if(C===void 0)throw new Error("Invalid geometry type: "+y.geometry.type+".");var E=new C(r,y);r.store.add(E)}else{var _=r.store.get(y.id);_.properties=y.properties,cr(_.getCoordinates(),y.geometry.coordinates)||_.incomingCoords(y.geometry.coordinates)}return y.id});return r.store.render(),g},i.get=function(a){var g=r.store.get(a);if(g)return g.toGeoJSON()},i.getAll=function(){return{type:L.FEATURE_COLLECTION,features:r.store.getAll().map(function(a){return a.toGeoJSON()})}},i.delete=function(a){return r.store.delete(a,{silent:!0}),i.getMode()!==F.DIRECT_SELECT||r.store.getSelectedIds().length?r.store.render():r.events.changeMode(F.SIMPLE_SELECT,void 0,{silent:!0}),i},i.deleteAll=function(){return r.store.delete(r.store.getAllIds(),{silent:!0}),i.getMode()===F.DIRECT_SELECT?r.events.changeMode(F.SIMPLE_SELECT,void 0,{silent:!0}):r.store.render(),i},i.changeMode=function(a,g){return g===void 0&&(g={}),a===F.SIMPLE_SELECT&&i.getMode()===F.SIMPLE_SELECT?(Wn(g.featureIds||[],r.store.getSelectedIds())||(r.store.setSelected(g.featureIds,{silent:!0}),r.store.render()),i):(a===F.DIRECT_SELECT&&i.getMode()===F.DIRECT_SELECT&&g.featureId===r.store.getSelectedIds()[0]||r.events.changeMode(a,g,{silent:!0}),i)},i.getMode=function(){return r.events.getMode()},i.trash=function(){return r.events.trash({silent:!0}),i},i.combineFeatures=function(){return r.events.combineFeatures({silent:!0}),i},i.uncombineFeatures=function(){return r.events.uncombineFeatures({silent:!0}),i},i.setFeatureProperty=function(a,g,y){return r.store.setFeatureProperty(a,g,y),i},i}(n,e),n.api=e;var o=Zo(n);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=B,e.options=t,e};function Ze(t){fr(t,this)}return Ze.modes=qn,Ze.constants=ye,Ze.lib=dr,Ze})})(Ro);var pi=Ro.exports;const hi=Zr(pi);function gi(h){let u='poly:"';for(let[l,O]of h.coordinates[0])u+=`${O} ${l} `;return u=u.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${u}); node(w)->.x; <;); out meta;`}`}function yi(h,u,p){let{map:l}=u;const O=Po();let d;return qr(async()=>{d=new hi({displayControlsDefault:!1,controls:{polygon:!0}}),l.addControl(d),l.on("draw.create",async m=>{let v=m.features[0];d.deleteAll();try{let S=await(await fetch(gi(v))).text();O("load",{testCase:void 0,boundaryGj:v,osmXML:S})}catch(x){O("error",x.toString())}})}),Me(()=>{l.removeControl(d)}),h.$$set=m=>{"map"in m&&p(0,l=m.map)},[l]}class mi extends te{constructor(u){super(),ee(this,u,yi,null,ne,{map:0})}}function Ao(h){let u,p;return u=new mi({props:{map:h[0]}}),u.$on("load",ko),u.$on("resetToNone",Do),u.$on("error",Uo),{c(){kt(u.$$.fragment)},m(l,O){Dt(u,l,O),p=!0},p(l,O){const d={};O&1&&(d.map=l[0]),u.$set(d)},i(l){p||(it(u.$$.fragment,l),p=!0)},o(l){ct(u.$$.fragment,l),p=!1},d(l){Ut(u,l)}}}function vi(h){let u,p,l,O,d,m;O=new Wr({}),O.$on("load",ko),O.$on("resetToNone",Do),O.$on("error",Uo);let v=h[0]&&Ao(h);return{c(){u=sn("div"),p=sn("h1"),p.textContent="Maps for Cats",l=he(),kt(O.$$.fragment),d=he(),v&&v.c(),un(u,"slot","left")},m(x,S){Qt(x,u,S),Ln(u,p),Ln(u,l),Dt(O,u,null),Ln(u,d),v&&v.m(u,null),m=!0},p(x,S){x[0]?v?(v.p(x,S),S&1&&it(v,1)):(v=Ao(x),v.c(),it(v,1),v.m(u,null)):v&&(Nn(),ct(v,1,1,()=>{v=null}),An())},i(x){m||(it(O.$$.fragment,x),it(v),m=!0)},o(x){ct(O.$$.fragment,x),ct(v),m=!1},d(x){x&&$t(u),Ut(O),v&&v.d()}}}function _i(h){let u,p,l,O;function d(v){h[2](v)}let m={style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo",center:[-.1095,51.5076],zoom:13};return h[0]!==void 0&&(m.map=h[0]),p=new fi({props:m}),Xr.push(()=>Hr(p,"map",d)),p.$on("load",h[1]),{c(){u=sn("div"),kt(p.$$.fragment),un(u,"slot","main"),Mn(u,"position","relative"),Mn(u,"width","100%"),Mn(u,"height","100vh")},m(v,x){Qt(v,u,x),Dt(p,u,null),O=!0},p(v,x){const S={};!l&&x&1&&(l=!0,S.map=v[0],Kr(()=>l=!1)),p.$set(S)},i(v){O||(it(p.$$.fragment,v),O=!0)},o(v){ct(p.$$.fragment,v),O=!1},d(v){v&&$t(u),Ut(p)}}}function bi(h){let u,p;return u=new Yr({props:{$$slots:{main:[_i],left:[vi]},$$scope:{ctx:h}}}),{c(){kt(u.$$.fragment)},m(l,O){Dt(u,l,O),p=!0},p(l,[O]){const d={};O&9&&(d.$$scope={dirty:O,ctx:l}),u.$set(d)},i(l){p||(it(u.$$.fragment,l),p=!0)},o(l){ct(u.$$.fragment,l),p=!1},d(l){Ut(u,l)}}}function ko(h){console.log(`got osm ${h.detail.osmXML.length}`)}function Do(h){console.log("reset to nil")}function Uo(h){window.alert(`Something broke: ${h.detail}`)}function Ei(h,u,p){let l;function O(){for(let m of l.getStyle().layers)(m.id.startsWith("road_")||m.id.startsWith("bridge_"))&&l.setLayoutProperty(m.id,"visibility","none")}function d(m){l=m,p(0,l)}return[l,O,d]}class Ci extends te{constructor(u){super(),ee(this,u,Ei,bi,ne,{})}}new Ci({target:document.getElementById("app")});
