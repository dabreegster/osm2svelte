import{S as J,i as N,s as T,b as P,a as A,c as k,d as v,e as d,m as C,t as _,g as K,f as h,h as Q,j as R,k as $,l as L,n as j,o as w,p as D,q as O,r as b,u as E,v as M,w as U,x as G,y as V,z as X,A as ne,B as re,L as oe,C as se}from"./OverpassSelector-c7abaf02.js";import{L as Y,h as x,n as I,a as ee,b as le,m as te,c as ie,d as ae,e as pe,A as fe,I as ue,M as ce,i as me,f as de}from"./MainLayers-49047439.js";import{T as $e}from"./TopLeftPanel-bdeee378.js";function z(l){let t,r;return t=new ee({props:{source:"connected-roads",gj:l[0],layerStyle:l[2],show:l[1]}}),{c(){v(t.$$.fragment)},m(e,o){C(t,e,o),r=!0},p(e,o){const n={};o&1&&(n.gj=e[0]),o&2&&(n.show=e[1]),t.$set(n)},i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){h(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function _e(l){let t,r,e,o,n=l[0]&&z(l);function a(i){l[5](i)}let s={gj:l[0],name:"Roads connected to intersection",downloadable:!1};return l[1]!==void 0&&(s.show=l[1]),r=new Y({props:s}),P.push(()=>A(r,"show",a)),{c(){n&&n.c(),t=k(),v(r.$$.fragment)},m(i,p){n&&n.m(i,p),d(i,t,p),C(r,i,p),o=!0},p(i,[p]){i[0]?n?(n.p(i,p),p&1&&_(n,1)):(n=z(i),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(K(),h(n,1,1,()=>{n=null}),Q());const m={};p&1&&(m.gj=i[0]),!e&&p&2&&(e=!0,m.show=i[1],R(()=>e=!1)),r.$set(m)},i(i){o||(_(n),_(r.$$.fragment,i),o=!0)},o(i){h(n),h(r.$$.fragment,i),o=!1},d(i){i&&$(t),n&&n.d(i),L(r,i)}}}function ge(l,t,r){let e,o;j(l,x,p=>r(3,e=p)),j(l,I,p=>r(4,o=p));let n,a=!0,s={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(p){a=p,r(1,a)}return l.$$.update=()=>{l.$$.dirty&24&&(o&&e?r(0,n=JSON.parse(o.debugRoadsConnectedToIntersectionGeojson(e.properties.id))):r(0,n=void 0))},[n,a,s,e,o,i]}class we extends J{constructor(t){super(),N(this,t,ge,_e,T,{})}}function q(l){let t,r;return t=new ee({props:{source:"movements",gj:l[0],layerStyle:l[2],show:l[1]}}),{c(){v(t.$$.fragment)},m(e,o){C(t,e,o),r=!0},p(e,o){const n={};o&1&&(n.gj=e[0]),o&2&&(n.show=e[1]),t.$set(n)},i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){h(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function he(l){let t,r,e,o,n=l[0]&&q(l);function a(i){l[5](i)}let s={gj:l[0],name:"Movement arrows",downloadable:!1};return l[1]!==void 0&&(s.show=l[1]),r=new Y({props:s}),P.push(()=>A(r,"show",a)),{c(){n&&n.c(),t=k(),v(r.$$.fragment)},m(i,p){n&&n.m(i,p),d(i,t,p),C(r,i,p),o=!0},p(i,[p]){i[0]?n?(n.p(i,p),p&1&&_(n,1)):(n=q(i),n.c(),_(n,1),n.m(t.parentNode,t)):n&&(K(),h(n,1,1,()=>{n=null}),Q());const m={};p&1&&(m.gj=i[0]),!e&&p&2&&(e=!0,m.show=i[1],R(()=>e=!1)),r.$set(m)},i(i){o||(_(n),_(r.$$.fragment,i),o=!0)},o(i){h(n),h(r.$$.fragment,i),o=!1},d(i){i&&$(t),n&&n.d(i),L(r,i)}}}function ye(l,t,r){let e,o;j(l,I,p=>r(3,e=p)),j(l,le,p=>r(4,o=p));let n,a=!0,s={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(p){a=p,r(1,a)}return l.$$.update=()=>{if(l.$$.dirty&24)if(e&&o){let p=o.properties;r(0,n=JSON.parse(e.debugMovementsFromLaneGeojson(p.road,p.index)))}else r(0,n=void 0)},[n,a,s,e,o,i]}class be extends J{constructor(t){super(),N(this,t,ye,he,T,{})}}function ke(l){let t,r,e,o,n,a;return{c(){t=w("div"),r=w("label"),e=w("input"),o=D(`
    Clockwise ordering of roads`),O(e,"type","checkbox")},m(s,i){d(s,t,i),b(t,r),b(r,e),e.checked=l[0],b(r,o),n||(a=E(e,"change",l[5]),n=!0)},p(s,[i]){i&1&&(e.checked=s[0])},i:M,o:M,d(s){s&&$(t),n=!1,a()}}}function ve(l,t,r){let e,o,n;j(l,te,p=>r(2,e=p)),j(l,x,p=>r(3,o=p)),j(l,I,p=>r(4,n=p));let a=[],s=!1;function i(){s=this.checked,r(0,s)}return l.$$.update=()=>{if(l.$$.dirty&31){for(let p of a)p.remove();if(r(1,a=[]),s&&o){let p=JSON.parse(n.debugClockwiseOrderingForIntersectionGeojson(o.properties.id));for(let m of p.features)a.push(new U.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1}).setLngLat(m.geometry.coordinates).setHTML(m.properties.label).addTo(e))}}},[s,a,e,o,n,i]}class Ce extends J{constructor(t){super(),N(this,t,ve,ke,T,{})}}function Le(l){let t,r,e,o,n,a;return t=new be({}),e=new Ce({}),n=new we({}),{c(){v(t.$$.fragment),r=k(),v(e.$$.fragment),o=k(),v(n.$$.fragment)},m(s,i){C(t,s,i),d(s,r,i),C(e,s,i),d(s,o,i),C(n,s,i),a=!0},p:M,i(s){a||(_(t.$$.fragment,s),_(e.$$.fragment,s),_(n.$$.fragment,s),a=!0)},o(s){h(t.$$.fragment,s),h(e.$$.fragment,s),h(n.$$.fragment,s),a=!1},d(s){s&&($(r),$(o)),L(t,s),L(e,s),L(n,s)}}}class Se extends J{constructor(t){super(),N(this,t,null,Le,T,{})}}function F(l,t,r){const e=l.slice();return e[4]=t[r],e}function H(l){let t,r=l[4]+"",e,o,n;return{c(){t=w("a"),e=D(r),n=D(","),O(t,"href",o="https://www.openstreetmap.org/node/"+l[4]),O(t,"target","_blank")},m(a,s){d(a,t,s),b(t,e),d(a,n,s)},p(a,s){s&1&&r!==(r=a[4]+"")&&X(e,r),s&1&&o!==(o="https://www.openstreetmap.org/node/"+a[4])&&O(t,"href",o)},d(a){a&&($(t),$(n))}}}function je(l){let t,r,e,o,n,a,s,i,p,m=G(l[0].properties.osm_node_ids),g=[];for(let c=0;c<m.length;c+=1)g[c]=H(F(l,m,c));return{c(){t=w("pre"),t.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=k(),e=w("div"),o=D(`OSM nodes:
  `);for(let c=0;c<g.length;c+=1)g[c].c();n=k(),a=w("div"),s=w("button"),s.textContent="Collapse intersection",O(s,"type","button")},m(c,u){d(c,t,u),d(c,r,u),d(c,e,u),b(e,o);for(let f=0;f<g.length;f+=1)g[f]&&g[f].m(e,null);d(c,n,u),d(c,a,u),b(a,s),i||(p=E(s,"click",l[2]),i=!0)},p(c,[u]){if(u&1){m=G(c[0].properties.osm_node_ids);let f;for(f=0;f<m.length;f+=1){const S=F(c,m,f);g[f]?g[f].p(S,u):(g[f]=H(S),g[f].c(),g[f].m(e,null))}for(;f<g.length;f+=1)g[f].d(1);g.length=m.length}},i:M,o:M,d(c){c&&($(t),$(r),$(e),$(n),$(a)),V(g,c),i=!1,p()}}}function Oe(l,t,r){let e;j(l,I,s=>r(3,e=s));let{intersection:o}=t,n=structuredClone(o.properties);delete n.osm_node_ids;function a(){e.collapseIntersection(o.properties.id),I.set(e)}return l.$$set=s=>{"intersection"in s&&r(0,o=s.intersection)},[o,n,a]}class Ie extends J{constructor(t){super(),N(this,t,Oe,je,T,{intersection:0})}}function W(l,t,r){const e=l.slice();return e[5]=t[r],e}function Z(l){let t,r=l[5]+"",e,o,n;return{c(){t=w("a"),e=D(r),n=D(","),O(t,"href",o="https://www.openstreetmap.org/way/"+l[5]),O(t,"target","_blank")},m(a,s){d(a,t,s),b(t,e),d(a,n,s)},p(a,s){s&1&&r!==(r=a[5]+"")&&X(e,r),s&1&&o!==(o="https://www.openstreetmap.org/way/"+a[5])&&O(t,"href",o)},d(a){a&&($(t),$(n))}}}function Me(l){let t,r,e,o,n,a,s,i,p,m,g,c=G(l[0].properties.osm_way_ids),u=[];for(let f=0;f<c.length;f+=1)u[f]=Z(W(l,c,f));return{c(){t=w("pre"),t.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=k(),e=w("div"),o=D(`OSM ways:
  `);for(let f=0;f<u.length;f+=1)u[f].c();n=k(),a=w("div"),s=w("button"),s.textContent="Collapse short road",i=k(),p=w("button"),p.textContent="Zip side-path",O(s,"type","button"),O(p,"type","button")},m(f,S){d(f,t,S),d(f,r,S),d(f,e,S),b(e,o);for(let y=0;y<u.length;y+=1)u[y]&&u[y].m(e,null);d(f,n,S),d(f,a,S),b(a,s),b(a,i),b(a,p),m||(g=[E(s,"click",l[2]),E(p,"click",l[3])],m=!0)},p(f,[S]){if(S&1){c=G(f[0].properties.osm_way_ids);let y;for(y=0;y<c.length;y+=1){const B=W(f,c,y);u[y]?u[y].p(B,S):(u[y]=Z(B),u[y].c(),u[y].m(e,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=c.length}},i:M,o:M,d(f){f&&($(t),$(r),$(e),$(n),$(a)),V(u,f),m=!1,ne(g)}}}function Je(l,t,r){let e;j(l,I,i=>r(4,e=i));let{lane:o}=t,n=structuredClone(o.properties);delete n.osm_way_ids;function a(){e.collapseShortRoad(o.properties.rod),I.set(e)}function s(){e.zipSidepath(o.properties.rod),I.set(e)}return l.$$set=i=>{"lane"in i&&r(0,o=i.lane)},[o,n,a,s]}class Ne extends J{constructor(t){super(),N(this,t,Je,Me,T,{lane:0})}}function Te(l,t,r){let e,o,n;j(l,te,s=>r(0,e=s)),j(l,ie,s=>r(1,o=s)),j(l,ae,s=>r(2,n=s));let a=new U.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});return re(()=>{a.remove()}),l.$$.update=()=>{if(l.$$.dirty&7)if(n){let s=document.createElement("div");new Ne({target:s,props:{lane:n}});let i=n.geometry.coordinates[0][0];a.setLngLat(i).setDOMContent(s).addTo(e)}else if(o){let s=document.createElement("div");new Ie({target:s,props:{intersection:o}});let i=o.geometry.coordinates[0][0];a.setLngLat(i).setDOMContent(s).addTo(e)}else a.remove()},[e,o,n]}class De extends J{constructor(t){super(),N(this,t,Te,null,T,{})}}function Ee(l){let t,r,e,o,n,a,s,i,p,m;o=new fe({});function g(u){l[1](u)}let c={};return l[0]!==void 0&&(c.imported=l[0]),i=new ue({props:c}),P.push(()=>A(i,"imported",g)),{c(){t=w("div"),r=w("h1"),r.textContent="osm2streets Street Explorer",e=k(),v(o.$$.fragment),n=k(),a=w("hr"),s=k(),v(i.$$.fragment),O(t,"slot","left")},m(u,f){d(u,t,f),b(t,r),b(t,e),C(o,t,null),b(t,n),b(t,a),b(t,s),C(i,t,null),m=!0},p(u,f){const S={};!p&&f&1&&(p=!0,S.imported=u[0],R(()=>p=!1)),i.$set(S)},i(u){m||(_(o.$$.fragment,u),_(i.$$.fragment,u),m=!0)},o(u){h(o.$$.fragment,u),h(i.$$.fragment,u),m=!1},d(u){u&&$(t),L(o),L(i)}}}function Ge(l){let t,r,e,o,n,a;return t=new de({}),n=new Se({}),{c(){v(t.$$.fragment),r=k(),e=w("hr"),o=k(),v(n.$$.fragment)},m(s,i){C(t,s,i),d(s,r,i),d(s,e,i),d(s,o,i),C(n,s,i),a=!0},p:M,i(s){a||(_(t.$$.fragment,s),_(n.$$.fragment,s),a=!0)},o(s){h(t.$$.fragment,s),h(n.$$.fragment,s),a=!1},d(s){s&&($(r),$(e),$(o)),L(t,s),L(n,s)}}}function Pe(l){let t,r,e,o;return t=new $e({props:{$$slots:{default:[Ge]},$$scope:{ctx:l}}}),e=new De({}),{c(){v(t.$$.fragment),r=k(),v(e.$$.fragment)},m(n,a){C(t,n,a),d(n,r,a),C(e,n,a),o=!0},p(n,a){const s={};a&4&&(s.$$scope={dirty:a,ctx:n}),t.$set(s)},i(n){o||(_(t.$$.fragment,n),_(e.$$.fragment,n),o=!0)},o(n){h(t.$$.fragment,n),h(e.$$.fragment,n),o=!1},d(n){n&&$(r),L(t,n),L(e,n)}}}function Ae(l){let t,r,e;return r=new ce({props:{$$slots:{default:[Pe]},$$scope:{ctx:l}}}),{c(){t=w("div"),v(r.$$.fragment),O(t,"slot","main")},m(o,n){d(o,t,n),C(r,t,null),e=!0},p(o,n){const a={};n&4&&(a.$$scope={dirty:n,ctx:o}),r.$set(a)},i(o){e||(_(r.$$.fragment,o),e=!0)},o(o){h(r.$$.fragment,o),e=!1},d(o){o&&$(t),L(r)}}}function Re(l){let t,r;return t=new oe({props:{$$slots:{main:[Ae],left:[Ee]},$$scope:{ctx:l}}}),{c(){v(t.$$.fragment)},m(e,o){C(t,e,o),r=!0},p(e,[o]){const n={};o&5&&(n.$$scope={dirty:o,ctx:e}),t.$set(n)},i(e){r||(_(t.$$.fragment,e),r=!0)},o(e){h(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function Be(l,t,r){let e={kind:"nothing"};se(async()=>{await me()});function o(n){e=n,r(0,e)}return l.$$.update=()=>{l.$$.dirty&1&&e.kind=="done"&&(I.set(e.network),pe.set(e.boundaryGJ))},[e,o]}class ze extends J{constructor(t){super(),N(this,t,Be,Re,T,{})}}new ze({target:document.getElementById("app")});
