import{S as F,i as N,s as D,l as g,m as j,n as $,p as v,a as k,r as y,w as O,x as K,E as L,d as h,F as T,f as A,J as V,K as Y,B as R,M as Z,C as I,o as W,e as X,v as C,g as P,b as w,c as Q,t as b,z as E,j as U,L as x,I as ee,k as te,y as ne}from"./BuiltInSelector-389d765d.js";import{n as M,f as le,a as re,g as oe,b as B,A as se,I as ae,M as ie,i as ue,L as fe,d as pe}from"./ImportControls-c14e762d.js";function ce(o){let e,n=o[0].size+"",t,l,s,r,i,_;return{c(){e=g("div"),t=j(n),l=j(" ways edited"),s=$(),r=g("button"),r.textContent="Download .osc",v(r,"type","button")},m(c,m){k(c,e,m),y(e,t),y(e,l),k(c,s,m),k(c,r,m),i||(_=O(r,"click",o[1]),i=!0)},p(c,[m]){m&1&&n!==(n=c[0].size+"")&&K(t,n)},i:L,o:L,d(c){c&&(h(e),h(s),h(r)),i=!1,_()}}}function de(o,e,n){let t;T(o,M,i=>n(3,t=i));let l=new Set;function s(i){l.add(i.detail),n(0,l)}function r(){let i=`<osmChange version="0.6" generator="osm2streets">
`;i+=`<create/>
`,i+=`<modify>
`;for(let _ of l)i+=t.wayToXml(_),i+=`
`;i+=`</modify>
`,i+="</osmChange>",le("lane_edits.osc",i)}return[l,r,s]}class _e extends F{constructor(e){super(),N(this,e,de,ce,D,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function z(o,e,n){const t=o.slice();return t[11]=e[n],t[12]=e,t[13]=n,t}function q(o,e){let n,t,l,s,r,i,_,c,m,a,f,p;function u(){e[5].call(l,e[12],e[13])}function d(){e[6].call(i,e[12],e[13])}function J(){return e[7](e[11])}return{key:o,first:null,c(){n=g("tr"),t=g("td"),l=g("input"),s=$(),r=g("td"),i=g("input"),_=$(),c=g("td"),m=g("button"),m.textContent="Delete",a=$(),v(l,"type","text"),v(i,"type","text"),v(m,"type","button"),this.first=n},m(S,G){k(S,n,G),y(n,t),y(t,l),I(l,e[11].key),y(n,s),y(n,r),y(r,i),I(i,e[11].value),y(n,_),y(n,c),y(c,m),y(n,a),f||(p=[O(l,"input",u),O(i,"input",d),O(m,"click",J)],f=!0)},p(S,G){e=S,G&1&&l.value!==e[11].key&&I(l,e[11].key),G&1&&i.value!==e[11].value&&I(i,e[11].value)},d(S){S&&h(n),f=!1,R(p)}}}function me(o){let e,n,t=[],l=new Map,s,r,i,_,c,m,a=A(o[0]);const f=p=>p[11].id;for(let p=0;p<a.length;p+=1){let u=z(o,a,p),d=f(u);l.set(d,t[p]=q(d,u))}return{c(){e=g("table"),n=g("tbody");for(let p=0;p<t.length;p+=1)t[p].c();s=$(),r=g("button"),r.textContent="Add new tag",i=$(),_=g("button"),_.textContent="Recalculate",v(r,"type","button"),v(_,"type","button")},m(p,u){k(p,e,u),y(e,n);for(let d=0;d<t.length;d+=1)t[d]&&t[d].m(n,null);k(p,s,u),k(p,r,u),k(p,i,u),k(p,_,u),c||(m=[O(r,"click",o[2]),O(_,"click",o[3])],c=!0)},p(p,[u]){u&3&&(a=A(p[0]),t=V(t,u,f,1,p,a,l,n,Y,q,null,z))},i:L,o:L,d(p){p&&(h(e),h(s),h(r),h(i),h(_));for(let u=0;u<t.length;u+=1)t[u].d();c=!1,R(m)}}}function ye(o,e,n){let t;T(o,M,u=>n(9,t=u));let l=Z(),{way:s}=e,r=[],i=0;for(let[u,d]of Object.entries(JSON.parse(t.getOsmTagsForWay(s))))r.push({id:i++,key:u,value:d});function _(u){n(0,r=r.filter(d=>d.id!=u))}function c(){r.push({id:i++,key:"",value:""}),n(0,r)}function m(){let u={};for(let d of r)d.key&&d.value&&(u[d.key]=d.value);t.overwriteOsmTagsForWay(s,JSON.stringify(u)),M.set(t),l("editedWay",s)}function a(u,d){u[d].key=this.value,n(0,r)}function f(u,d){u[d].value=this.value,n(0,r)}const p=u=>_(u.id);return o.$$set=u=>{"way"in u&&n(4,s=u.way)},[r,_,c,m,s,a,f,p]}class ge extends F{constructor(e){super(),N(this,e,ye,me,D,{way:4})}}function ke(o){let e;return{c(){e=j("Click a road to edit")},m(n,t){k(n,e,t)},p:L,i:L,o:L,d(n){n&&h(e)}}}function he(o){let e,n,t,l,s,r,i,_=o[0],c,m;r=new oe({props:{source:"current-way",gj:o[2],layerStyle:o[3]}});let a=H(o);return{c(){e=g("a"),n=j("Way "),t=j(o[0]),s=$(),W(r.$$.fragment),i=$(),a.c(),c=X(),v(e,"href",l="http://openstreetmap.org/way/"+o[0]),v(e,"target","_blank")},m(f,p){k(f,e,p),y(e,n),y(e,t),k(f,s,p),C(r,f,p),k(f,i,p),a.m(f,p),k(f,c,p),m=!0},p(f,p){(!m||p&1)&&K(t,f[0]),(!m||p&1&&l!==(l="http://openstreetmap.org/way/"+f[0]))&&v(e,"href",l);const u={};p&4&&(u.gj=f[2]),r.$set(u),p&1&&D(_,_=f[0])?(P(),w(a,1,1,L),Q(),a=H(f),a.c(),b(a,1),a.m(c.parentNode,c)):a.p(f,p)},i(f){m||(b(r.$$.fragment,f),b(a),m=!0)},o(f){w(r.$$.fragment,f),w(a),m=!1},d(f){f&&(h(e),h(s),h(i),h(c)),E(r,f),a.d(f)}}}function H(o){let e,n;return e=new ge({props:{way:o[0]}}),e.$on("editedWay",o[7]),{c(){W(e.$$.fragment)},m(t,l){C(e,t,l),n=!0},p(t,l){const s={};l&1&&(s.way=t[0]),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function $e(o){let e,n,t,l,s,r,i={};e=new _e({props:i}),o[6](e);const _=[he,ke],c=[];function m(a,f){return a[0]?0:1}return t=m(o),l=c[t]=_[t](o),{c(){W(e.$$.fragment),n=$(),l.c(),s=X()},m(a,f){C(e,a,f),k(a,n,f),c[t].m(a,f),k(a,s,f),r=!0},p(a,[f]){const p={};e.$set(p);let u=t;t=m(a),t===u?c[t].p(a,f):(P(),w(c[u],1,1,()=>{c[u]=null}),Q(),l=c[t],l?l.p(a,f):(l=c[t]=_[t](a),l.c()),b(l,1),l.m(s.parentNode,s))},i(a){r||(b(e.$$.fragment,a),b(l),r=!0)},o(a){w(e.$$.fragment,a),w(l),r=!1},d(a){a&&(h(n),h(s)),o[6](null),E(e,a),c[t].d(a)}}}function we(o,e,n){let t,l;T(o,M,a=>n(4,t=a)),T(o,re,a=>n(5,l=a));let s,r,i,_={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function c(a){U[a?"unshift":"push"](()=>{s=a,n(1,s)})}const m=a=>s.handleEditedWay(a);return o.$$.update=()=>{o.$$.dirty&49&&(n(0,r=null),n(2,i=null),l?l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(n(0,r=BigInt(l.properties.osm_way_ids[0])),n(2,i=JSON.parse(t.getGeometryForWay(r)))):(n(0,r=null),n(2,i=null)))},[r,s,i,_,t,l,c,m]}class be extends F{constructor(e){super(),N(this,e,we,$e,D,{})}}function ve(o){let e,n,t,l,s,r,i,_,c,m,a,f;l=new se({});function p(d){o[4](d)}let u={};return o[0]!==void 0&&(u.imported=o[0]),r=new ae({props:u}),U.push(()=>te(r,"imported",p)),c=new be({}),{c(){e=g("div"),n=g("h1"),n.textContent="osm2streets lane editor",t=$(),W(l.$$.fragment),s=$(),W(r.$$.fragment),_=$(),W(c.$$.fragment),m=$(),a=g("div"),a.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",v(e,"slot","left")},m(d,J){k(d,e,J),y(e,n),y(e,t),C(l,e,null),y(e,s),C(r,e,null),y(e,_),C(c,e,null),y(e,m),y(e,a),f=!0},p(d,J){const S={};!i&&J&1&&(i=!0,S.imported=d[0],ne(()=>i=!1)),r.$set(S)},i(d){f||(b(l.$$.fragment,d),b(r.$$.fragment,d),b(c.$$.fragment,d),f=!0)},o(d){w(l.$$.fragment,d),w(r.$$.fragment,d),w(c.$$.fragment,d),f=!1},d(d){d&&h(e),E(l),E(r),E(c)}}}function We(o){let e,n;return e=new fe({props:{layers:o[1],showControls:!1}}),{c(){W(e.$$.fragment)},m(t,l){C(e,t,l),n=!0},p(t,l){const s={};l&2&&(s.layers=t[1]),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ce(o){let e,n,t;return n=new ie({props:{$$slots:{default:[We]},$$scope:{ctx:o}}}),{c(){e=g("div"),W(n.$$.fragment),v(e,"slot","main")},m(l,s){k(l,e,s),C(n,e,null),t=!0},p(l,s){const r={};s&34&&(r.$$scope={dirty:s,ctx:l}),n.$set(r)},i(l){t||(b(n.$$.fragment,l),t=!0)},o(l){w(n.$$.fragment,l),t=!1},d(l){l&&h(e),E(n)}}}function Ee(o){let e,n;return e=new x({props:{$$slots:{main:[Ce],left:[ve]},$$scope:{ctx:o}}}),{c(){W(e.$$.fragment)},m(t,l){C(e,t,l),n=!0},p(t,[l]){const s={};l&35&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){w(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Se(o,e,n){let t,l;T(o,B,_=>n(2,t=_)),T(o,M,_=>n(3,l=_));let s={kind:"nothing"},r=[];ee(async()=>{await ue()});function i(_){s=_,n(0,s)}return o.$$.update=()=>{o.$$.dirty&1&&s.kind=="done"&&(M.set(s.network),B.set(s.boundaryGJ)),o.$$.dirty&12&&l&&t&&n(1,r=pe(l,t))},[s,r,t,l,i]}class Le extends F{constructor(e){super(),N(this,e,Se,Ee,D,{})}}new Le({target:document.getElementById("app")});
