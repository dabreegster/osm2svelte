import{S as N,i as B,s as j,l as g,n as D,d as k,o as W,e as $,p as y,q as M,x as H,r as E,h,k as A,v as q,B as U,y as R,C as V,D as I,E as Y,c as L,F as X,m as O,G as K,g as b,H as P,t as v,j as T,b as Z,L as x,A as ee,I as te}from"./OverpassSelector-5e168ca4.js";import{n as F,f as ne,d as le,L as re,A as se,I as ae,M as oe,i as ie,e as ue}from"./MainLayers-0bd72852.js";function fe(i){let e,t=i[0].size+"",n,l,a,s,u,d;return{c(){e=g("div"),n=D(t),l=D(" ways edited"),a=k(),s=g("button"),s.textContent="Download .osc",W(s,"type","button")},m(_,p){$(_,e,p),y(e,n),y(e,l),$(_,a,p),$(_,s,p),u||(d=M(s,"click",i[1]),u=!0)},p(_,[p]){p&1&&t!==(t=_[0].size+"")&&H(n,t)},i:E,o:E,d(_){_&&(h(e),h(a),h(s)),u=!1,d()}}}function ce(i,e,t){let n;A(i,F,u=>t(3,n=u));let l=new Set;function a(u){l.add(u.detail),t(0,l)}function s(){let u=`<osmChange version="0.6" generator="osm2streets">
`;u+=`<create/>
`,u+=`<modify>
`;for(let d of l)u+=n.wayToXml(d),u+=`
`;u+=`</modify>
`,u+="</osmChange>",ne("lane_edits.osc",u)}return[l,s,a]}class de extends N{constructor(e){super(),B(this,e,ce,fe,j,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function G(i,e,t){const n=i.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function J(i,e){let t,n,l,a,s,u,d,_,p,f,c,r;function o(){e[5].call(l,e[12],e[13])}function m(){e[6].call(u,e[12],e[13])}function S(){return e[7](e[11])}return{key:i,first:null,c(){t=g("tr"),n=g("td"),l=g("input"),a=k(),s=g("td"),u=g("input"),d=k(),_=g("td"),p=g("button"),p.textContent="Delete",f=k(),W(l,"type","text"),W(u,"type","text"),W(p,"type","button"),this.first=t},m(C,w){$(C,t,w),y(t,n),y(n,l),I(l,e[11].key),y(t,a),y(t,s),y(s,u),I(u,e[11].value),y(t,d),y(t,_),y(_,p),y(t,f),c||(r=[M(l,"input",o),M(u,"input",m),M(p,"click",S)],c=!0)},p(C,w){e=C,w&1&&l.value!==e[11].key&&I(l,e[11].key),w&1&&u.value!==e[11].value&&I(u,e[11].value)},d(C){C&&h(t),c=!1,R(r)}}}function pe(i){let e,t,n=[],l=new Map,a,s,u,d,_,p,f=q(i[0]);const c=r=>r[11].id;for(let r=0;r<f.length;r+=1){let o=G(i,f,r),m=c(o);l.set(m,n[r]=J(m,o))}return{c(){e=g("table"),t=g("tbody");for(let r=0;r<n.length;r+=1)n[r].c();a=k(),s=g("button"),s.textContent="Add new tag",u=k(),d=g("button"),d.textContent="Recalculate",W(s,"type","button"),W(d,"type","button")},m(r,o){$(r,e,o),y(e,t);for(let m=0;m<n.length;m+=1)n[m]&&n[m].m(t,null);$(r,a,o),$(r,s,o),$(r,u,o),$(r,d,o),_||(p=[M(s,"click",i[2]),M(d,"click",i[3])],_=!0)},p(r,[o]){o&3&&(f=q(r[0]),n=U(n,o,c,1,r,f,l,t,Y,J,null,G))},i:E,o:E,d(r){r&&(h(e),h(a),h(s),h(u),h(d));for(let o=0;o<n.length;o+=1)n[o].d();_=!1,R(p)}}}function _e(i,e,t){let n;A(i,F,o=>t(9,n=o));const l=V();let{way:a}=e,s=[],u=0;for(let[o,m]of Object.entries(JSON.parse(n.getOsmTagsForWay(a))))s.push({id:u++,key:o,value:m});function d(o){t(0,s=s.filter(m=>m.id!=o))}function _(){s.push({id:u++,key:"",value:""}),t(0,s)}function p(){let o={};for(let m of s)m.key&&m.value&&(o[m.key]=m.value);n.overwriteOsmTagsForWay(a,JSON.stringify(o)),F.set(n),l("editedWay",a)}function f(o,m){o[m].key=this.value,t(0,s)}function c(o,m){o[m].value=this.value,t(0,s)}const r=o=>d(o.id);return i.$$set=o=>{"way"in o&&t(4,a=o.way)},[s,d,_,p,a,f,c,r]}class me extends N{constructor(e){super(),B(this,e,_e,pe,j,{way:4})}}function ye(i){let e;return{c(){e=D("Click a road to edit")},m(t,n){$(t,e,n)},p:E,i:E,o:E,d(t){t&&h(e)}}}function ge(i){let e,t,n,l,a,s,u,d=i[0],_,p;s=new re({props:{source:"current-way",gj:i[2],layerStyle:i[3]}});let f=z(i);return{c(){e=g("a"),t=D("Way "),n=D(i[0]),a=k(),L(s.$$.fragment),u=k(),f.c(),_=X(),W(e,"href",l="http://openstreetmap.org/way/"+i[0]),W(e,"target","_blank")},m(c,r){$(c,e,r),y(e,t),y(e,n),$(c,a,r),O(s,c,r),$(c,u,r),f.m(c,r),$(c,_,r),p=!0},p(c,r){(!p||r&1)&&H(n,c[0]),(!p||r&1&&l!==(l="http://openstreetmap.org/way/"+c[0]))&&W(e,"href",l);const o={};r&4&&(o.gj=c[2]),s.$set(o),r&1&&j(d,d=c[0])?(K(),b(f,1,1,E),P(),f=z(c),f.c(),v(f,1),f.m(_.parentNode,_)):f.p(c,r)},i(c){p||(v(s.$$.fragment,c),v(f),p=!0)},o(c){b(s.$$.fragment,c),b(f),p=!1},d(c){c&&(h(e),h(a),h(u),h(_)),T(s,c),f.d(c)}}}function z(i){let e,t;return e=new me({props:{way:i[0]}}),e.$on("editedWay",i[7]),{c(){L(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.way=n[0]),e.$set(a)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function $e(i){let e,t,n,l,a,s,u,d,_={};e=new de({props:_}),i[6](e);const p=[ge,ye],f=[];function c(r,o){return r[0]?0:1}return a=c(i),s=f[a]=p[a](i),{c(){L(e.$$.fragment),t=k(),n=g("hr"),l=k(),s.c(),u=X()},m(r,o){O(e,r,o),$(r,t,o),$(r,n,o),$(r,l,o),f[a].m(r,o),$(r,u,o),d=!0},p(r,[o]){const m={};e.$set(m);let S=a;a=c(r),a===S?f[a].p(r,o):(K(),b(f[S],1,1,()=>{f[S]=null}),P(),s=f[a],s?s.p(r,o):(s=f[a]=p[a](r),s.c()),v(s,1),s.m(u.parentNode,u))},i(r){d||(v(e.$$.fragment,r),v(s),d=!0)},o(r){b(e.$$.fragment,r),b(s),d=!1},d(r){r&&(h(t),h(n),h(l),h(u)),i[6](null),T(e,r),f[a].d(r)}}}function he(i,e,t){let n,l;A(i,F,f=>t(4,n=f)),A(i,le,f=>t(5,l=f));let a,s=null,u=null,d={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function _(f){Z[f?"unshift":"push"](()=>{a=f,t(1,a)})}const p=f=>a.handleEditedWay(f);return i.$$.update=()=>{i.$$.dirty&49&&(t(0,s=null),t(2,u=null),l&&(l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(t(0,s=BigInt(l.properties.osm_way_ids[0])),t(2,u=JSON.parse(n.getGeometryForWay(s))))))},[s,a,u,d,n,l,_,p]}class ke extends N{constructor(e){super(),B(this,e,he,$e,j,{})}}function we(i){let e,t,n,l,a,s,u,d,_,p,f,c,r,o,m,S,C;return l=new se({}),d=new ae({}),c=new ke({}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",n=k(),L(l.$$.fragment),a=k(),s=g("hr"),u=k(),L(d.$$.fragment),_=k(),p=g("hr"),f=k(),L(c.$$.fragment),r=k(),o=g("hr"),m=k(),S=g("div"),S.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m(w,Q){$(w,e,Q),y(e,t),y(e,n),O(l,e,null),y(e,a),y(e,s),y(e,u),O(d,e,null),y(e,_),y(e,p),y(e,f),O(c,e,null),y(e,r),y(e,o),y(e,m),y(e,S),C=!0},p:E,i(w){C||(v(l.$$.fragment,w),v(d.$$.fragment,w),v(c.$$.fragment,w),C=!0)},o(w){b(l.$$.fragment,w),b(d.$$.fragment,w),b(c.$$.fragment,w),C=!1},d(w){w&&h(e),T(l),T(d),T(c)}}}function be(i){let e,t,n;return t=new ue({}),{c(){e=g("div"),L(t.$$.fragment),te(e,"display","none")},m(l,a){$(l,e,a),O(t,e,null),n=!0},p:E,i(l){n||(v(t.$$.fragment,l),n=!0)},o(l){b(t.$$.fragment,l),n=!1},d(l){l&&h(e),T(t)}}}function ve(i){let e,t,n;return t=new oe({props:{$$slots:{default:[be]},$$scope:{ctx:i}}}),{c(){e=g("div"),L(t.$$.fragment),W(e,"slot","main")},m(l,a){$(l,e,a),O(t,e,null),n=!0},p(l,a){const s={};a&1&&(s.$$scope={dirty:a,ctx:l}),t.$set(s)},i(l){n||(v(t.$$.fragment,l),n=!0)},o(l){b(t.$$.fragment,l),n=!1},d(l){l&&h(e),T(t)}}}function We(i){let e,t;return e=new x({props:{$$slots:{main:[ve],left:[we]},$$scope:{ctx:i}}}),{c(){L(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,[l]){const a={};l&1&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Ce(i){return ee(async()=>{await ie()}),[]}class Ee extends N{constructor(e){super(),B(this,e,Ce,We,j,{})}}new Ee({target:document.getElementById("app")});
