import{S as J,i as N,s as M,k as w,l as D,m as b,o as E,a as $,q as g,v as O,w as P,C as L,d as k,D as I,E as A,Y as V,Z as Y,_ as Z,A as R,$ as x,a0 as G,n as W,e as X,u as C,g as K,b as h,c as Q,t as v,y as S,H as ee,h as U,a1 as te,L as ne,K as le,M as re,N as se,P as oe,Q as ie,j as ae,R as ue,x as fe,T as pe,U as de,V as ce,W as me,X as _e}from"./SelectImportArea-202112ca.js";function ye(i){let e,l=i[0].size+"",t,n,s,r,a,c;return{c(){e=w("div"),t=D(l),n=D(" ways edited"),s=b(),r=w("button"),r.textContent="Download .osc",E(r,"type","button")},m(d,m){$(d,e,m),g(e,t),g(e,n),$(d,s,m),$(d,r,m),a||(c=O(r,"click",i[1]),a=!0)},p(d,[m]){m&1&&l!==(l=d[0].size+"")&&P(t,l)},i:L,o:L,d(d){d&&k(e),d&&k(s),d&&k(r),a=!1,c()}}}function ge(i,e,l){let t;I(i,A,a=>l(3,t=a));let n=new Set;function s(a){n.add(a.detail),l(0,n)}function r(){let a=`<osmChange version="0.6" generator="osm2streets">
`;a+=`<create/>
`,a+=`<modify>
`;for(let c of n)a+=t.wayToXml(c),a+=`
`;a+=`</modify>
`,a+="</osmChange>",V("lane_edits.osc",a)}return[n,r,s]}class $e extends J{constructor(e){super(),N(this,e,ge,ye,M,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function q(i,e,l){const t=i.slice();return t[11]=e[l],t[12]=e,t[13]=l,t}function z(i,e){let l,t,n,s,r,a,c,d,m,o,p,u;function f(){e[5].call(n,e[12],e[13])}function _(){e[6].call(a,e[12],e[13])}function j(){return e[7](e[11])}return{key:i,first:null,c(){l=w("tr"),t=w("td"),n=w("input"),s=b(),r=w("td"),a=w("input"),c=b(),d=w("td"),m=w("button"),m.textContent="Delete",o=b(),E(n,"type","text"),E(a,"type","text"),E(m,"type","button"),this.first=l},m(y,T){$(y,l,T),g(l,t),g(t,n),G(n,e[11].key),g(l,s),g(l,r),g(r,a),G(a,e[11].value),g(l,c),g(l,d),g(d,m),g(l,o),p||(u=[O(n,"input",f),O(a,"input",_),O(m,"click",j)],p=!0)},p(y,T){e=y,T&1&&n.value!==e[11].key&&G(n,e[11].key),T&1&&a.value!==e[11].value&&G(a,e[11].value)},d(y){y&&k(l),p=!1,R(u)}}}function ke(i){let e,l,t=[],n=new Map,s,r,a,c,d,m,o=i[0];const p=u=>u[11].id;for(let u=0;u<o.length;u+=1){let f=q(i,o,u),_=p(f);n.set(_,t[u]=z(_,f))}return{c(){e=w("table"),l=w("tbody");for(let u=0;u<t.length;u+=1)t[u].c();s=b(),r=w("button"),r.textContent="Add new tag",a=b(),c=w("button"),c.textContent="Recalculate",E(r,"type","button"),E(c,"type","button")},m(u,f){$(u,e,f),g(e,l);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(l,null);$(u,s,f),$(u,r,f),$(u,a,f),$(u,c,f),d||(m=[O(r,"click",i[2]),O(c,"click",i[3])],d=!0)},p(u,[f]){f&3&&(o=u[0],t=Y(t,f,p,1,u,o,n,l,Z,z,null,q))},i:L,o:L,d(u){u&&k(e);for(let f=0;f<t.length;f+=1)t[f].d();u&&k(s),u&&k(r),u&&k(a),u&&k(c),d=!1,R(m)}}}function we(i,e,l){let t;I(i,A,f=>l(9,t=f));let n=x(),{way:s}=e,r=[],a=0;for(let[f,_]of Object.entries(JSON.parse(t.getOsmTagsForWay(s))))r.push({id:a++,key:f,value:_});function c(f){l(0,r=r.filter(_=>_.id!=f))}function d(){r.push({id:a++,key:"",value:""}),l(0,r)}function m(){let f={};for(let _ of r)_.key&&_.value&&(f[_.key]=_.value);t.overwriteOsmTagsForWay(s,JSON.stringify(f)),n("editedWay",s)}function o(f,_){f[_].key=this.value,l(0,r)}function p(f,_){f[_].value=this.value,l(0,r)}const u=f=>c(f.id);return i.$$set=f=>{"way"in f&&l(4,s=f.way)},[r,c,d,m,s,o,p,u]}class be extends J{constructor(e){super(),N(this,e,we,ke,M,{way:4})}}function he(i){let e;return{c(){e=D("Click a road to edit")},m(l,t){$(l,e,t)},p:L,i:L,o:L,d(l){l&&k(e)}}}function ve(i){let e,l,t,n,s,r,a,c=i[0],d,m;r=new te({props:{source:"current-way",gj:i[2],layerStyle:i[3]}});let o=H(i);return{c(){e=w("a"),l=D("Way "),t=D(i[0]),s=b(),W(r.$$.fragment),a=b(),o.c(),d=X(),E(e,"href",n="http://openstreetmap.org/way/"+i[0]),E(e,"target","_blank")},m(p,u){$(p,e,u),g(e,l),g(e,t),$(p,s,u),C(r,p,u),$(p,a,u),o.m(p,u),$(p,d,u),m=!0},p(p,u){(!m||u&1)&&P(t,p[0]),(!m||u&1&&n!==(n="http://openstreetmap.org/way/"+p[0]))&&E(e,"href",n);const f={};u&4&&(f.gj=p[2]),r.$set(f),u&1&&M(c,c=p[0])?(K(),h(o,1,1,L),Q(),o=H(p),o.c(),v(o,1),o.m(d.parentNode,d)):o.p(p,u)},i(p){m||(v(r.$$.fragment,p),v(o),m=!0)},o(p){h(r.$$.fragment,p),h(o),m=!1},d(p){p&&k(e),p&&k(s),S(r,p),p&&k(a),p&&k(d),o.d(p)}}}function H(i){let e,l;return e=new be({props:{way:i[0]}}),e.$on("editedWay",i[7]),{c(){W(e.$$.fragment)},m(t,n){C(e,t,n),l=!0},p(t,n){const s={};n&1&&(s.way=t[0]),e.$set(s)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){h(e.$$.fragment,t),l=!1},d(t){S(e,t)}}}function We(i){let e,l,t,n,s,r,a={};e=new $e({props:a}),i[6](e);const c=[ve,he],d=[];function m(o,p){return o[0]?0:1}return t=m(i),n=d[t]=c[t](i),{c(){W(e.$$.fragment),l=b(),n.c(),s=X()},m(o,p){C(e,o,p),$(o,l,p),d[t].m(o,p),$(o,s,p),r=!0},p(o,[p]){const u={};e.$set(u);let f=t;t=m(o),t===f?d[t].p(o,p):(K(),h(d[f],1,1,()=>{d[f]=null}),Q(),n=d[t],n?n.p(o,p):(n=d[t]=c[t](o),n.c()),v(n,1),n.m(s.parentNode,s))},i(o){r||(v(e.$$.fragment,o),v(n),r=!0)},o(o){h(e.$$.fragment,o),h(n),r=!1},d(o){i[6](null),S(e,o),o&&k(l),d[t].d(o),o&&k(s)}}}function Ce(i,e,l){let t,n;I(i,A,o=>l(4,t=o)),I(i,ee,o=>l(5,n=o));let s,r,a,c={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function d(o){U[o?"unshift":"push"](()=>{s=o,l(1,s)})}const m=o=>s.handleEditedWay(o);return i.$$.update=()=>{i.$$.dirty&49&&(l(0,r=null),l(2,a=null),n?n.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(l(0,r=BigInt(n.properties.osm_way_ids[0])),l(2,a=JSON.parse(t.getGeometryForWay(r)))):(l(0,r=null),l(2,a=null)))},[r,s,a,c,t,n,d,m]}class Se extends J{constructor(e){super(),N(this,e,Ce,We,M,{})}}function Ee(i){let e,l,t,n,s,r,a,c,d,m,o,p,u,f;n=new oe({});function _(y){i[4](y)}let j={settings:i[2]};return i[0]!==void 0&&(j.imported=i[0]),r=new ie({props:j}),U.push(()=>ae(r,"imported",_)),d=new ue({props:{imported:i[0]}}),o=new Se({}),{c(){e=w("div"),l=w("h1"),l.textContent="osm2streets lane editor",t=b(),W(n.$$.fragment),s=b(),W(r.$$.fragment),c=b(),W(d.$$.fragment),m=b(),W(o.$$.fragment),p=b(),u=w("div"),u.innerHTML=`<strong>Warnings:</strong> 
      <ul><li><strong>This tool is an early experiment</strong></li> 
        <li>Don&#39;t use this tool without understanding OSM tagging</li> 
        <li>Be careful around sidepaths, footways, and dual carriageways</li> 
        <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>`,E(e,"slot","left")},m(y,T){$(y,e,T),g(e,l),g(e,t),C(n,e,null),g(e,s),C(r,e,null),g(e,c),C(d,e,null),g(e,m),C(o,e,null),g(e,p),g(e,u),f=!0},p(y,T){const B={};!a&&T&1&&(a=!0,B.imported=y[0],fe(()=>a=!1)),r.$set(B);const F={};T&1&&(F.imported=y[0]),d.$set(F)},i(y){f||(v(n.$$.fragment,y),v(r.$$.fragment,y),v(d.$$.fragment,y),v(o.$$.fragment,y),f=!0)},o(y){h(n.$$.fragment,y),h(r.$$.fragment,y),h(d.$$.fragment,y),h(o.$$.fragment,y),f=!1},d(y){y&&k(e),S(n),S(r),S(d),S(o)}}}function Te(i){let e,l,t,n;return e=new me({}),e.$on("polygon",i[3]),t=new _e({props:{layers:i[1],showControls:!1}}),{c(){W(e.$$.fragment),l=b(),W(t.$$.fragment)},m(s,r){C(e,s,r),$(s,l,r),C(t,s,r),n=!0},p(s,r){const a={};r&2&&(a.layers=s[1]),t.$set(a)},i(s){n||(v(e.$$.fragment,s),v(t.$$.fragment,s),n=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),n=!1},d(s){S(e,s),s&&k(l),S(t,s)}}}function Le(i){let e,l,t;return l=new pe({props:{$$slots:{default:[Te]},$$scope:{ctx:i}}}),{c(){e=w("div"),W(l.$$.fragment),E(e,"slot","main")},m(n,s){$(n,e,s),C(l,e,null),t=!0},p(n,s){const r={};s&35&&(r.$$scope={dirty:s,ctx:n}),l.$set(r)},i(n){t||(v(l.$$.fragment,n),t=!0)},o(n){h(l.$$.fragment,n),t=!1},d(n){n&&k(e),S(l)}}}function Oe(i){let e,l;return e=new ne({props:{$$slots:{main:[Le],left:[Ee]},$$scope:{ctx:i}}}),{c(){W(e.$$.fragment)},m(t,n){C(e,t,n),l=!0},p(t,[n]){const s={};n&35&&(s.$$scope={dirty:n,ctx:t}),e.$set(s)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){h(e.$$.fragment,t),l=!1},d(t){S(e,t)}}}function De(i,e,l){let t={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1,osm2lanes:!1},n={kind:"nothing"},s=[];le(async()=>{await de()});const r=c=>ce(c,n,t);function a(c){n=c,l(0,n)}return i.$$.update=()=>{i.$$.dirty&1&&n.kind=="done"&&(A.set(n.network),re.set(n.boundaryGJ),l(1,s=se(n.network,n.boundaryGJ)))},[n,s,t,r,a]}class Me extends J{constructor(e){super(),N(this,e,De,Oe,M,{})}}new Me({target:document.getElementById("app")});
