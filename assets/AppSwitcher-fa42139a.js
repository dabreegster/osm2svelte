import{A as ne,B as et,S as W,i as z,s as J,C as tt,n as m,d as M,p as N,q as L,D as ce,f as O,r as b,y as U,o as Y,j as $,z as Pe,O as nt,E as rt,b as B,a as H,c as R,m as E,g as V,t as F,h as G,k as D,l as Z,u as Ae,v as ze,F as Je,w as ot,x as st,G as je,H as qe,I as Xe,J as Ze,K as He,M as it,N as Ie,P as lt}from"./maplibre-gl-a16e463a.js";let u;const Q=new Array(128).fill(void 0);Q.push(void 0,null,!0,!1);function v(r){return Q[r]}let fe=Q.length;function at(r){r<132||(Q[r]=fe,fe=r)}function he(r){const e=v(r);return at(r),e}const Ve=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ve.decode();let le=null;function we(){return(le===null||le.byteLength===0)&&(le=new Uint8Array(u.memory.buffer)),le}function P(r,e){return Ve.decode(we().subarray(r,r+e))}function A(r){fe===Q.length&&Q.push(Q.length+1);const e=fe;return fe=Q[e],Q[e]=r,e}function Se(r){return r==null}let ae=null;function _t(){return(ae===null||ae.byteLength===0)&&(ae=new Float64Array(u.memory.buffer)),ae}let _e=null;function y(){return(_e===null||_e.byteLength===0)&&(_e=new Int32Array(u.memory.buffer)),_e}let ee=0;const ye=new TextEncoder("utf-8"),ut=typeof ye.encodeInto=="function"?function(r,e){return ye.encodeInto(r,e)}:function(r,e){const n=ye.encode(r);return e.set(n),{read:r.length,written:n.length}};function oe(r,e,n){if(n===void 0){const _=ye.encode(r),i=e(_.length);return we().subarray(i,i+_.length).set(_),ee=_.length,i}let t=r.length,o=e(t);const s=we();let l=0;for(;l<t;l++){const _=r.charCodeAt(l);if(_>127)break;s[o+l]=_}if(l!==t){l!==0&&(r=r.slice(l)),o=n(o,t,t=l+r.length*3);const _=we().subarray(o+l,o+t),i=ut(r,_);l+=i.written}return ee=l,o}function Ce(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let s="[";o>0&&(s+=Ce(r[0]));for(let l=1;l<o;l++)s+=", "+Ce(r[l]);return s+="]",s}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}let ue=null;function ct(){return(ue===null||ue.byteLength===0)&&(ue=new Uint32Array(u.memory.buffer)),ue}function ft(r,e){const t=ct().subarray(r/4,r/4+e),o=[];for(let s=0;s<t.length;s++)o.push(he(t[s]));return o}function re(r,e){try{return r.apply(this,e)}catch(n){u.__wbindgen_exn_store(A(n))}}class Re{static __wrap(e){const n=Object.create(Re.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();u.__wbg_jsdebugstreets_free(e)}getLabel(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsdebugstreets_getLabel(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}getNetwork(){const e=u.jsdebugstreets_getNetwork(this.ptr);return he(e)}toDebugGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsdebugstreets_toDebugGeojson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];let o;return e!==0&&(o=P(e,n).slice(),u.__wbindgen_free(e,n*1)),o}finally{u.__wbindgen_add_to_stack_pointer(16)}}}class de{static __wrap(e){const n=Object.create(de.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();u.__wbg_jsstreetnetwork_free(e)}constructor(e,n,t){try{const _=u.__wbindgen_add_to_stack_pointer(-16),i=oe(e,u.__wbindgen_malloc,u.__wbindgen_realloc),a=ee,g=oe(n,u.__wbindgen_malloc,u.__wbindgen_realloc),c=ee;u.jsstreetnetwork_new(_,i,a,g,c,A(t));var o=y()[_/4+0],s=y()[_/4+1],l=y()[_/4+2];if(l)throw he(s);return de.__wrap(o)}finally{u.__wbindgen_add_to_stack_pointer(16)}}toGeojsonPlain(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toGeojsonPlain(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}toLanePolygonsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toLanePolygonsGeojson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}toLaneMarkingsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toLaneMarkingsGeojson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}toIntersectionMarkingsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toIntersectionMarkingsGeojson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}toGraphviz(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toGraphviz(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}getDebugSteps(){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getDebugSteps(o,this.ptr);var e=y()[o/4+0],n=y()[o/4+1],t=ft(e,n).slice();return u.__wbindgen_free(e,n*4),t}finally{u.__wbindgen_add_to_stack_pointer(16)}}debugClockwiseOrderingGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugClockwiseOrderingGeojson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}debugClockwiseOrderingForIntersectionGeojson(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugClockwiseOrderingForIntersectionGeojson(o,this.ptr,e);var n=y()[o/4+0],t=y()[o/4+1];return P(n,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,t)}}debugMovementsFromLaneGeojson(e,n){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugMovementsFromLaneGeojson(s,this.ptr,e,n);var t=y()[s/4+0],o=y()[s/4+1];return P(t,o)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(t,o)}}debugRoadsConnectedToIntersectionGeojson(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugRoadsConnectedToIntersectionGeojson(o,this.ptr,e);var n=y()[o/4+0],t=y()[o/4+1];return P(n,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,t)}}getOsmTagsForWay(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getOsmTagsForWay(o,this.ptr,e);var n=y()[o/4+0],t=y()[o/4+1];return P(n,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,t)}}toJson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toJson(t,this.ptr);var e=y()[t/4+0],n=y()[t/4+1];return P(e,n)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,n)}}getGeometryForWay(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getGeometryForWay(o,this.ptr,e);var n=y()[o/4+0],t=y()[o/4+1];return P(n,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,t)}}wayToXml(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_wayToXml(o,this.ptr,e);var n=y()[o/4+0],t=y()[o/4+1];return P(n,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(n,t)}}overwriteOsmTagsForWay(e,n){const t=oe(n,u.__wbindgen_malloc,u.__wbindgen_realloc),o=ee;u.jsstreetnetwork_overwriteOsmTagsForWay(this.ptr,e,t,o)}collapseShortRoad(e){u.jsstreetnetwork_collapseShortRoad(this.ptr,e)}collapseIntersection(e){u.jsstreetnetwork_collapseIntersection(this.ptr,e)}zipSidepath(e){u.jsstreetnetwork_zipSidepath(this.ptr,e)}}async function dt(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function gt(){const r={};return r.wbg={},r.wbg.__wbg_jsdebugstreets_new=function(e){const n=Re.__wrap(e);return A(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=v(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_object_drop_ref=function(e){he(e)},r.wbg.__wbindgen_is_object=function(e){const n=v(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return v(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return v(e)in v(n)},r.wbg.__wbg_jsstreetnetwork_new=function(e){const n=de.__wrap(e);return A(n)},r.wbg.__wbindgen_string_new=function(e,n){const t=P(e,n);return A(t)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(P(e,n));return A(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return v(e)==v(n)},r.wbg.__wbindgen_number_get=function(e,n){const t=v(n),o=typeof t=="number"?t:void 0;_t()[e/8+1]=Se(o)?0:o,y()[e/4+0]=!Se(o)},r.wbg.__wbindgen_string_get=function(e,n){const t=v(n),o=typeof t=="string"?t:void 0;var s=Se(o)?0:oe(o,u.__wbindgen_malloc,u.__wbindgen_realloc),l=ee;y()[e/4+1]=l,y()[e/4+0]=s},r.wbg.__wbindgen_object_clone_ref=function(e){const n=v(e);return A(n)},r.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,n){const t=v(e)[v(n)];return A(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return A(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=v(n).stack,o=oe(t,u.__wbindgen_malloc,u.__wbindgen_realloc),s=ee;y()[e/4+1]=s,y()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){try{console.error(P(e,n))}finally{u.__wbindgen_free(e,n)}},r.wbg.__wbg_now_c644db5194be8437=function(e){return v(e).now()},r.wbg.__wbg_debug_8db2eed1bf6c1e2a=function(e){console.debug(v(e))},r.wbg.__wbg_error_fe807da27c4a4ced=function(e){console.error(v(e))},r.wbg.__wbg_info_9e6db45ac337c3b5=function(e){console.info(v(e))},r.wbg.__wbg_log_7bb108d119bafbc1=function(e){console.log(v(e))},r.wbg.__wbg_warn_e57696dbb3977030=function(e){console.warn(v(e))},r.wbg.__wbg_newnoargs_2b8b6bd7753c76ba=function(e,n){const t=new Function(P(e,n));return A(t)},r.wbg.__wbg_get_baf4855f9a986186=function(){return re(function(e,n){const t=Reflect.get(v(e),v(n));return A(t)},arguments)},r.wbg.__wbg_call_95d1ea488d03e4e8=function(){return re(function(e,n){const t=v(e).call(v(n));return A(t)},arguments)},r.wbg.__wbg_self_e7c1f827057f6584=function(){return re(function(){const e=self.self;return A(e)},arguments)},r.wbg.__wbg_window_a09ec664e14b1b81=function(){return re(function(){const e=window.window;return A(e)},arguments)},r.wbg.__wbg_globalThis_87cbb8506fecf3a9=function(){return re(function(){const e=globalThis.globalThis;return A(e)},arguments)},r.wbg.__wbg_global_c85a9259e621f3db=function(){return re(function(){const e=global.global;return A(e)},arguments)},r.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(e){let n;try{n=v(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_cf65c07de34b9a08=function(e){const n=v(e).buffer;return A(n)},r.wbg.__wbg_new_537b7341ce90bb31=function(e){const n=new Uint8Array(v(e));return A(n)},r.wbg.__wbg_set_17499e8aa4003ebd=function(e,n,t){v(e).set(v(n),t>>>0)},r.wbg.__wbg_length_27a2afe8ab42b09f=function(e){return v(e).length},r.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(e){let n;try{n=v(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=Ce(v(n)),o=oe(t,u.__wbindgen_malloc,u.__wbindgen_realloc),s=ee;y()[e/4+1]=s,y()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,n){throw new Error(P(e,n))},r.wbg.__wbindgen_memory=function(){const e=u.memory;return A(e)},r}function pt(r,e){return u=r.exports,bt.__wbindgen_wasm_module=e,ae=null,_e=null,ue=null,le=null,u}async function bt(r){typeof r>"u"&&(r="/osm2svelte/assets/osm2streets_js_bg.wasm");const e=gt();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await dt(await r,e);return pt(n,t)}const ge=ne(null),te=ne(null),Fe=ne(null),Le=ne(null),Me=ne(null),Ge=ne(null),Oe=ne(null);te.subscribe(r=>{Le.set(null),Me.set(null),Ge.set(null),Oe.set(null)});function Ke(r,e,n){if(r!==null)for(var t,o,s,l,_,i,a,g=0,c=0,p,d=r.type,h=d==="FeatureCollection",C=d==="Feature",S=h?r.features.length:1,k=0;k<S;k++){a=h?r.features[k].geometry:C?r.geometry:r,p=a?a.type==="GeometryCollection":!1,_=p?a.geometries.length:1;for(var I=0;I<_;I++){var w=0,f=0;if(l=p?a.geometries[I]:a,l!==null){i=l.coordinates;var j=l.type;switch(g=n&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(e(i,c,k,w,f)===!1)return!1;c++,w++;break;case"LineString":case"MultiPoint":for(t=0;t<i.length;t++){if(e(i[t],c,k,w,f)===!1)return!1;c++,j==="MultiPoint"&&w++}j==="LineString"&&w++;break;case"Polygon":case"MultiLineString":for(t=0;t<i.length;t++){for(o=0;o<i[t].length-g;o++){if(e(i[t][o],c,k,w,f)===!1)return!1;c++}j==="MultiLineString"&&w++,j==="Polygon"&&f++}j==="Polygon"&&w++;break;case"MultiPolygon":for(t=0;t<i.length;t++){for(f=0,o=0;o<i[t].length;o++){for(s=0;s<i[t][o].length-g;s++){if(e(i[t][o][s],c,k,w,f)===!1)return!1;c++}f++}w++}break;case"GeometryCollection":for(t=0;t<l.geometries.length;t++)if(Ke(l.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $e(r){var e=[1/0,1/0,-1/0,-1/0];return Ke(r,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}$e.default=$e;function Qe(r,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function me(r,e,n){let t=["case"];for(let[o,s]of Object.entries(e))t.push(["==",["get",r],o]),t.push(s);return t.push(n),t}function Ye(r,e,n){return["case",["boolean",["feature-state",r],!1],n,e]}function Ne(){return{type:"FeatureCollection",features:[]}}function xe(r){return $e(r)}function wt(r){let e=et(ge),n,t=!1;for(let o=Ue.length-1;o>=0;o--){let s=Ue[o];if(s==r){t=!0;break}e.getLayer(s)&&(n=s)}if(!t)throw new Error(`Layer ID ${r} not defined in layerZorder`);return n}const Ue=["boundary-layer","lane-polygons-layer","intersection-polygons-layer","lane-markings-layer","intersection-markings-layer","movements-layer","connected-roads-layer","current-way-layer","road_label"];function yt(r){let e,n,t,o,s,l,_,i,a,g,c,p,d,h,C,S,k,I,w,f,j,q,T,se,Ee,ie,X,De,ke,ve,Te;return ke=tt(r[6][0]),{c(){e=m("details"),n=m("summary"),n.textContent="Processing Options",t=M(),o=m("label"),s=m("input"),l=N(`
    Debug each transformation step`),_=M(),i=m("label"),a=m("input"),g=N(`
    Enable dual carriageway experiment`),c=M(),p=m("label"),d=m("input"),h=N(`
    Enable sidepath zipping experiment`),C=M(),S=m("label"),k=m("input"),I=N(`
    Enable osm2lanes experiment`),w=M(),f=m("div"),j=N(`Sidewalks:
    `),q=m("label"),T=m("input"),se=N(`
      use mapped footways`),Ee=M(),ie=m("label"),X=m("input"),De=N(`
      infer on roads`),L(n,"class","svelte-fio7ln"),L(s,"type","checkbox"),L(o,"class","svelte-fio7ln"),L(a,"type","checkbox"),L(i,"class","svelte-fio7ln"),L(d,"type","checkbox"),L(p,"class","svelte-fio7ln"),L(k,"type","checkbox"),L(S,"class","svelte-fio7ln"),L(T,"type","radio"),T.__value=!1,ce(T,T.__value),L(q,"class","svelte-fio7ln"),L(X,"type","radio"),X.__value=!0,ce(X,X.__value),L(ie,"class","svelte-fio7ln"),L(f,"class","svelte-fio7ln"),L(e,"class","svelte-fio7ln"),ke.p(T,X)},m(K,x){O(K,e,x),b(e,n),b(e,t),b(e,o),b(o,s),s.checked=r[0].debug_each_step,b(o,l),b(e,_),b(e,i),b(i,a),a.checked=r[0].dual_carriageway_experiment,b(i,g),b(e,c),b(e,p),b(p,d),d.checked=r[0].sidepath_zipping_experiment,b(p,h),b(e,C),b(e,S),b(S,k),k.checked=r[0].osm2lanes,b(S,I),b(e,w),b(e,f),b(f,j),b(f,q),b(q,T),T.checked=T.__value===r[0].inferred_sidewalks,b(q,se),b(f,Ee),b(f,ie),b(ie,X),X.checked=X.__value===r[0].inferred_sidewalks,b(ie,De),ve||(Te=[U(s,"change",r[1]),U(a,"change",r[2]),U(d,"change",r[3]),U(k,"change",r[4]),U(T,"change",r[5]),U(X,"change",r[7])],ve=!0)},p(K,[x]){x&1&&(s.checked=K[0].debug_each_step),x&1&&(a.checked=K[0].dual_carriageway_experiment),x&1&&(d.checked=K[0].sidepath_zipping_experiment),x&1&&(k.checked=K[0].osm2lanes),x&1&&(T.checked=T.__value===K[0].inferred_sidewalks),x&1&&(X.checked=X.__value===K[0].inferred_sidewalks)},i:Y,o:Y,d(K){K&&$(e),ke.r(),ve=!1,Pe(Te)}}}function ht(r,e,n){let{settings:t={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1,osm2lanes:!1}}=e;const o=[[]];function s(){t.debug_each_step=this.checked,n(0,t)}function l(){t.dual_carriageway_experiment=this.checked,n(0,t)}function _(){t.sidepath_zipping_experiment=this.checked,n(0,t)}function i(){t.osm2lanes=this.checked,n(0,t)}function a(){t.inferred_sidewalks=this.__value,n(0,t)}function g(){t.inferred_sidewalks=this.__value,n(0,t)}return r.$$set=c=>{"settings"in c&&n(0,t=c.settings)},[t,s,l,_,i,a,o,g]}class mt extends W{constructor(e){super(),z(this,e,ht,yt,J,{settings:0})}}function kt(r){let e,n,t,o,s,l,_,i;return{c(){e=m("div"),n=m("button"),n.textContent="Update OSM data",t=M(),o=m("button"),o.textContent="Download osm.xml",s=M(),l=m("button"),l.textContent="Reset view",L(n,"type","button"),L(o,"type","button"),L(l,"type","button")},m(a,g){O(a,e,g),b(e,n),b(e,t),b(e,o),b(e,s),b(e,l),_||(i=[U(n,"click",r[6]),U(o,"click",r[5]),U(l,"click",r[7])],_=!0)},p:Y,d(a){a&&$(e),_=!1,Pe(i)}}}function vt(r){let e,n,t=r[2].msg+"",o;return{c(){e=m("p"),n=N("Error: "),o=N(t)},m(s,l){O(s,e,l),b(e,n),b(e,o)},p(s,l){l&4&&t!==(t=s[2].msg+"")&&Ae(o,t)},d(s){s&&$(e)}}}function jt(r){let e,n=r[2].msg+"",t;return{c(){e=m("p"),t=N(n)},m(o,s){O(o,e,s),b(e,t)},p(o,s){s&4&&n!==(n=o[2].msg+"")&&Ae(t,n)},d(o){o&&$(e)}}}function St(r){let e;return{c(){e=m("p"),e.textContent="Use the polygon tool to select an area to import"},m(n,t){O(n,e,t)},p:Y,d(n){n&&$(e)}}}function Ct(r){let e,n,t,o,s,l,_,i,a,g,c,p={map:r[4]};e=new nt({props:p}),r[12](e),e.$on("loading",r[11]),e.$on("load",r[8]),e.$on("resetToNone",r[9]),e.$on("error",r[10]);function d(f){r[13](f)}let h={};r[1]!==void 0&&(h.testCase=r[1]),s=new rt({props:h}),B.push(()=>H(s,"testCase",d)),s.$on("loading",r[11]),s.$on("load",r[8]),s.$on("resetToNone",r[9]),s.$on("error",r[10]);function C(f,j){if(f[2].kind==="nothing")return St;if(f[2].kind==="loading")return jt;if(f[2].kind==="error")return vt;if(f[2].kind==="done")return kt}let S=C(r),k=S&&S(r);function I(f){r[14](f)}let w={};return r[0]!==void 0&&(w.settings=r[0]),a=new mt({props:w}),B.push(()=>H(a,"settings",I)),{c(){R(e.$$.fragment),n=M(),t=m("fieldset"),o=m("legend"),R(s.$$.fragment),_=M(),k&&k.c(),i=M(),R(a.$$.fragment)},m(f,j){E(e,f,j),O(f,n,j),O(f,t,j),b(t,o),E(s,o,null),b(t,_),k&&k.m(t,null),O(f,i,j),E(a,f,j),c=!0},p(f,[j]){const q={};j&16&&(q.map=f[4]),e.$set(q);const T={};!l&&j&2&&(l=!0,T.testCase=f[1],V(()=>l=!1)),s.$set(T),S===(S=C(f))&&k?k.p(f,j):(k&&k.d(1),k=S&&S(f),k&&(k.c(),k.m(t,null)));const se={};!g&&j&1&&(g=!0,se.settings=f[0],V(()=>g=!1)),a.$set(se)},i(f){c||(F(e.$$.fragment,f),F(s.$$.fragment,f),F(a.$$.fragment,f),c=!0)},o(f){G(e.$$.fragment,f),G(s.$$.fragment,f),G(a.$$.fragment,f),c=!1},d(f){f&&($(n),$(t),$(i)),r[12](null),D(e,f),D(s),k&&k.d(),D(a,f)}}}function Ft(r,e,n){let t;Z(r,ge,f=>n(4,t=f));let o={kind:"nothing"},s,l,_=new URLSearchParams(window.location.search).get("test")||"none";function i(f){o.kind=="done"&&f&&(console.log("Settings changed, re-importing"),a(o.osmXml,o.boundaryGj))}function a(f,j){try{n(2,o={kind:"loading",msg:"Running osm2streets"});let q=new de(f,JSON.stringify(j),s);n(2,o={kind:"done",boundaryGj:j,osmXml:f,network:q}),te.set(o.network),Fe.set(o.boundaryGj)}catch(q){n(2,o={kind:"error",msg:q.toString()})}}function g(){o.kind==="done"&&Qe("osm.xml",o.osmXml)}function c(){o.kind==="done"&&l.importPolygon(o.boundaryGj)}function p(){o.kind==="done"&&t.fitBounds(xe(o.boundaryGj),{animate:!1,padding:10})}function d(f){a(f.detail.osmXml,f.detail.boundaryGj),n(1,_=f.detail.testCase)}function h(f){n(2,o={kind:"nothing"}),te.set(null),Fe.set(null)}function C(f){n(2,o={kind:"error",msg:f.detail})}function S(f){n(2,o={kind:"loading",msg:f.detail})}function k(f){B[f?"unshift":"push"](()=>{l=f,n(3,l)})}function I(f){_=f,n(1,_)}function w(f){s=f,n(0,s)}return r.$$.update=()=>{if(r.$$.dirty&1&&i(s),r.$$.dirty&2){let f=new URL(window.location.href);_!="none"?f.searchParams.set("test",_):f.searchParams.delete("test"),window.history.pushState({},"",f)}},[s,_,o,l,t,g,c,p,d,h,C,S,k,I,w]}class xt extends W{constructor(e){super(),z(this,e,Ft,Ct,J,{})}}function Lt(r,e,n){let t;Z(r,ge,w=>n(7,t=w));let{source:o}=e,{show:s=!0}=e,{gj:l}=e,{layerStyle:_}=e,{interactive:i=!1}=e,{hoveredFeature:a=null}=e,{clickedFeature:g=null}=e,c,p,d=`${o}-layer`;ze(()=>{h(),t.addSource(o,{type:"geojson",data:l??Ne()}),t.addLayer({id:d,source:o,..._},wt(d)),s||t.setLayoutProperty(d,"visibility","none"),i&&(t.on("mousemove",d,C),t.on("mouseleave",d,S),t.on("click",k))}),Je(()=>{i&&(t.off("mousemove",C),t.off("mouseleave",S),t.off("click",k),I()),t.getLayer(d)&&t.removeLayer(d),t.removeSource(o)});function h(){if(l&&"features"in l)for(let[w,f]of l.features.entries())f.id=w+1}function C(w){w.features.length>0&&c!=w.features[0].id&&(I(),c=w.features[0].id,t.setFeatureState({source:o,id:c},{hover:!0}),"features"in l&&n(0,a=l.features.find(f=>f.id==c)))}function S(){I(),n(0,a=null),c=void 0}function k(w){g!==null&&t.setFeatureState({source:o,id:p},{clicked:!1});let f=t.queryRenderedFeatures(w.point,{layers:[d]});f.length==1?(p=f[0].id,t.setFeatureState({source:o,id:p},{clicked:!0}),"features"in l&&n(1,g=l.features.find(j=>j.id==p))):(n(1,g=null),p=void 0)}function I(){c!==void 0&&t.setFeatureState({source:o,id:c},{hover:!1})}return r.$$set=w=>{"source"in w&&n(2,o=w.source),"show"in w&&n(3,s=w.show),"gj"in w&&n(4,l=w.gj),"layerStyle"in w&&n(5,_=w.layerStyle),"interactive"in w&&n(6,i=w.interactive),"hoveredFeature"in w&&n(0,a=w.hoveredFeature),"clickedFeature"in w&&n(1,g=w.clickedFeature)},r.$$.update=()=>{if(r.$$.dirty&148){let w=t.getSource(o);w&&(console.log(`GeoJSON data for ${o} changed, updating`),h(),w.setData(l??Ne()),n(0,a=null),c=void 0,n(1,g=null),p=void 0)}r.$$.dirty&136&&t.getLayer(d)&&t.setLayoutProperty(d,"visibility",s?"visible":"none")},[a,g,o,s,l,_,i,t]}class pe extends W{constructor(e){super(),z(this,e,Lt,null,J,{source:2,show:3,gj:4,layerStyle:5,interactive:6,hoveredFeature:0,clickedFeature:1})}}function Be(r){let e,n,t,o,s;return{c(){e=m("button"),n=N("Download"),L(e,"type","button"),e.disabled=t=!r[1]},m(l,_){O(l,e,_),b(e,n),o||(s=U(e,"click",r[4]),o=!0)},p(l,_){_&2&&t!==(t=!l[1])&&(e.disabled=t)},d(l){l&&$(e),o=!1,s()}}}function Mt(r){let e,n,t,o,s,l,_,i,a=r[3]&&Be(r);return{c(){e=m("div"),n=m("label"),t=m("input"),o=M(),s=N(r[2]),l=M(),a&&a.c(),L(t,"type","checkbox")},m(g,c){O(g,e,c),b(e,n),b(n,t),t.checked=r[0],b(n,o),b(n,s),b(e,l),a&&a.m(e,null),_||(i=U(t,"change",r[5]),_=!0)},p(g,[c]){c&1&&(t.checked=g[0]),c&4&&Ae(s,g[2]),g[3]?a?a.p(g,c):(a=Be(g),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:Y,o:Y,d(g){g&&$(e),a&&a.d(),_=!1,i()}}}function Gt(r,e,n){let{gj:t}=e,{name:o}=e,{show:s}=e,{downloadable:l=!0}=e;function _(){Qe(`${o}.geojson`,JSON.stringify(t))}function i(){s=this.checked,n(0,s)}return r.$$set=a=>{"gj"in a&&n(1,t=a.gj),"name"in a&&n(2,o=a.name),"show"in a&&n(0,s=a.show),"downloadable"in a&&n(3,l=a.downloadable)},[s,t,o,l,_,i]}class be extends W{constructor(e){super(),z(this,e,Gt,Mt,J,{gj:1,name:2,show:0,downloadable:3})}}function Ot(r){let e,n,t,o,s;e=new pe({props:{source:"boundary",gj:r[0],layerStyle:r[2],show:r[1]}});function l(i){r[5](i)}let _={gj:r[0],name:"Boundary"};return r[1]!==void 0&&(_.show=r[1]),t=new be({props:_}),B.push(()=>H(t,"show",l)),{c(){R(e.$$.fragment),n=M(),R(t.$$.fragment)},m(i,a){E(e,i,a),O(i,n,a),E(t,i,a),s=!0},p(i,[a]){const g={};a&1&&(g.gj=i[0]),a&2&&(g.show=i[1]),e.$set(g);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],V(()=>o=!1)),t.$set(c)},i(i){s||(F(e.$$.fragment,i),F(t.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),G(t.$$.fragment,i),s=!1},d(i){i&&$(n),D(e,i),D(t,i)}}}function $t(r,e,n){let t,o;Z(r,ge,a=>n(3,t=a)),Z(r,Fe,a=>n(4,o=a));let s,l=!0,_={type:"line",paint:{"line-color":"blue","line-width":4}};function i(a){l=a,n(1,l)}return r.$$.update=()=>{r.$$.dirty&25&&(o?(n(0,s=structuredClone(o)),t.fitBounds(xe(s),{animate:!1,padding:10})):n(0,s=void 0))},[s,l,_,t,o,i]}class Pt extends W{constructor(e){super(),z(this,e,$t,Ot,J,{})}}function At(r){let e,n,t,o,s;e=new pe({props:{source:"intersection-markings",gj:r[0],layerStyle:r[2],show:r[1]}});function l(i){r[4](i)}let _={gj:r[0],name:"Intersection markings"};return r[1]!==void 0&&(_.show=r[1]),t=new be({props:_}),B.push(()=>H(t,"show",l)),{c(){R(e.$$.fragment),n=M(),R(t.$$.fragment)},m(i,a){E(e,i,a),O(i,n,a),E(t,i,a),s=!0},p(i,[a]){const g={};a&1&&(g.gj=i[0]),a&2&&(g.show=i[1]),e.$set(g);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],V(()=>o=!1)),t.$set(c)},i(i){s||(F(e.$$.fragment,i),F(t.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),G(t.$$.fragment,i),s=!1},d(i){i&&$(n),D(e,i),D(t,i)}}}function Rt(r,e,n){let t;Z(r,te,i=>n(3,t=i));let o,s=!0,l={type:"fill",paint:{"fill-color":me("type",{"sidewalk corner":"#CCCCCC"},"red"),"fill-opacity":.9}};function _(i){s=i,n(1,s)}return r.$$.update=()=>{r.$$.dirty&8&&(t?n(0,o=JSON.parse(t.toIntersectionMarkingsGeojson())):n(0,o=void 0))},[o,s,l,t,_]}class Et extends W{constructor(e){super(),z(this,e,Rt,At,J,{})}}function Dt(r){let e,n,t,o,s,l,_;function i(d){r[6](d)}function a(d){r[7](d)}let g={source:"intersection-polygons",gj:r[0],layerStyle:r[4],interactive:!0,show:r[1]};r[2]!==void 0&&(g.hoveredFeature=r[2]),r[3]!==void 0&&(g.clickedFeature=r[3]),e=new pe({props:g}),B.push(()=>H(e,"hoveredFeature",i)),B.push(()=>H(e,"clickedFeature",a));function c(d){r[8](d)}let p={gj:r[0],name:"Intersection polygons"};return r[1]!==void 0&&(p.show=r[1]),s=new be({props:p}),B.push(()=>H(s,"show",c)),{c(){R(e.$$.fragment),o=M(),R(s.$$.fragment)},m(d,h){E(e,d,h),O(d,o,h),E(s,d,h),_=!0},p(d,[h]){const C={};h&1&&(C.gj=d[0]),h&2&&(C.show=d[1]),!n&&h&4&&(n=!0,C.hoveredFeature=d[2],V(()=>n=!1)),!t&&h&8&&(t=!0,C.clickedFeature=d[3],V(()=>t=!1)),e.$set(C);const S={};h&1&&(S.gj=d[0]),!l&&h&2&&(l=!0,S.show=d[1],V(()=>l=!1)),s.$set(S)},i(d){_||(F(e.$$.fragment,d),F(s.$$.fragment,d),_=!0)},o(d){G(e.$$.fragment,d),G(s.$$.fragment,d),_=!1},d(d){d&&$(o),D(e,d),D(s,d)}}}function Tt(r,e,n){let t,o,s;Z(r,te,p=>n(5,t=p)),Z(r,Ge,p=>n(2,o=p)),Z(r,Oe,p=>n(3,s=p));let l,_=!0,i={type:"fill",filter:["==",["get","type"],"intersection"],paint:{"fill-color":me("intersection_kind",{Connection:"#666",Intersection:"#966",Terminus:"#999",MapEdge:"#696"},"#666"),"fill-opacity":Ye("hover",.9,.4)}};function a(p){o=p,Ge.set(o)}function g(p){s=p,Oe.set(s)}function c(p){_=p,n(1,_)}return r.$$.update=()=>{r.$$.dirty&32&&(t?n(0,l=JSON.parse(t.toGeojsonPlain())):n(0,l=void 0))},[l,_,o,s,i,t,a,g,c]}class It extends W{constructor(e){super(),z(this,e,Tt,Dt,J,{})}}function Nt(r){let e,n,t,o,s;e=new pe({props:{source:"lane-markings",gj:r[0],layerStyle:r[2],show:r[1]}});function l(i){r[4](i)}let _={gj:r[0],name:"Lane markings "};return r[1]!==void 0&&(_.show=r[1]),t=new be({props:_}),B.push(()=>H(t,"show",l)),{c(){R(e.$$.fragment),n=M(),R(t.$$.fragment)},m(i,a){E(e,i,a),O(i,n,a),E(t,i,a),s=!0},p(i,[a]){const g={};a&1&&(g.gj=i[0]),a&2&&(g.show=i[1]),e.$set(g);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],V(()=>o=!1)),t.$set(c)},i(i){s||(F(e.$$.fragment,i),F(t.$$.fragment,i),s=!0)},o(i){G(e.$$.fragment,i),G(t.$$.fragment,i),s=!1},d(i){i&&$(n),D(e,i),D(t,i)}}}function Ut(r,e,n){let t;Z(r,te,i=>n(3,t=i));let o,s=!0,l={type:"fill",paint:{"fill-color":me("type",{"center line":"yellow","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};function _(i){s=i,n(1,s)}return r.$$.update=()=>{r.$$.dirty&8&&(t?n(0,o=JSON.parse(t.toLaneMarkingsGeojson())):n(0,o=void 0))},[o,s,l,t,_]}class Bt extends W{constructor(e){super(),z(this,e,Ut,Nt,J,{})}}function Wt(r){let e,n,t,o,s,l,_;function i(d){r[6](d)}function a(d){r[7](d)}let g={source:"lane-polygons",gj:r[0],layerStyle:r[4],interactive:!0,show:r[1]};r[2]!==void 0&&(g.clickedFeature=r[2]),r[3]!==void 0&&(g.hoveredFeature=r[3]),e=new pe({props:g}),B.push(()=>H(e,"clickedFeature",i)),B.push(()=>H(e,"hoveredFeature",a));function c(d){r[8](d)}let p={gj:r[0],name:"Lane polygons"};return r[1]!==void 0&&(p.show=r[1]),s=new be({props:p}),B.push(()=>H(s,"show",c)),{c(){R(e.$$.fragment),o=M(),R(s.$$.fragment)},m(d,h){E(e,d,h),O(d,o,h),E(s,d,h),_=!0},p(d,[h]){const C={};h&1&&(C.gj=d[0]),h&2&&(C.show=d[1]),!n&&h&4&&(n=!0,C.clickedFeature=d[2],V(()=>n=!1)),!t&&h&8&&(t=!0,C.hoveredFeature=d[3],V(()=>t=!1)),e.$set(C);const S={};h&1&&(S.gj=d[0]),!l&&h&2&&(l=!0,S.show=d[1],V(()=>l=!1)),s.$set(S)},i(d){_||(F(e.$$.fragment,d),F(s.$$.fragment,d),_=!0)},o(d){G(e.$$.fragment,d),G(s.$$.fragment,d),_=!1},d(d){d&&$(o),D(e,d),D(s,d)}}}function zt(r,e,n){let t,o,s;Z(r,te,p=>n(5,t=p)),Z(r,Le,p=>n(2,o=p)),Z(r,Me,p=>n(3,s=p));let l,_=!0,i={type:"fill",paint:{"fill-color":me("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":Ye("hover",.9,.4)}};function a(p){o=p,Le.set(o)}function g(p){s=p,Me.set(s)}function c(p){_=p,n(1,_)}return r.$$.update=()=>{r.$$.dirty&32&&(t?n(0,l=JSON.parse(t.toLanePolygonsGeojson())):n(0,l=void 0))},[l,_,o,s,i,t,a,g,c]}class Jt extends W{constructor(e){super(),z(this,e,zt,Wt,J,{})}}function qt(r){let e,n,t,o,s,l,_,i,a,g;return e=new Pt({}),t=new It({}),s=new Et({}),_=new Jt({}),a=new Bt({}),{c(){R(e.$$.fragment),n=M(),R(t.$$.fragment),o=M(),R(s.$$.fragment),l=M(),R(_.$$.fragment),i=M(),R(a.$$.fragment)},m(c,p){E(e,c,p),O(c,n,p),E(t,c,p),O(c,o,p),E(s,c,p),O(c,l,p),E(_,c,p),O(c,i,p),E(a,c,p),g=!0},p:Y,i(c){g||(F(e.$$.fragment,c),F(t.$$.fragment,c),F(s.$$.fragment,c),F(_.$$.fragment,c),F(a.$$.fragment,c),g=!0)},o(c){G(e.$$.fragment,c),G(t.$$.fragment,c),G(s.$$.fragment,c),G(_.$$.fragment,c),G(a.$$.fragment,c),g=!1},d(c){c&&($(n),$(o),$(l),$(i)),D(e,c),D(t,c),D(s,c),D(_,c),D(a,c)}}}class en extends W{constructor(e){super(),z(this,e,null,qt,J,{})}}function We(r){let e;const n=r[3].default,t=qe(n,r,r[2],null);return{c(){t&&t.c()},m(o,s){t&&t.m(o,s),e=!0},p(o,s){t&&t.p&&(!e||s&4)&&Xe(t,n,o,o[2],e?He(n,o[2],s,null):Ze(o[2]),null)},i(o){e||(F(t,o),e=!0)},o(o){G(t,o),e=!1},d(o){t&&t.d(o)}}}function Xt(r){let e,n,t=r[1]&&We(r);return{c(){e=m("div"),t&&t.c(),L(e,"class","map svelte-12dpf1u")},m(o,s){O(o,e,s),t&&t.m(e,null),r[4](e),n=!0},p(o,[s]){o[1]?t?(t.p(o,s),s&2&&F(t,1)):(t=We(o),t.c(),F(t,1),t.m(e,null)):t&&(ot(),G(t,1,1,()=>{t=null}),st())},i(o){n||(F(t),n=!0)},o(o){G(t),n=!1},d(o){o&&$(e),t&&t.d(),r[4](null)}}}function Zt(r,e,n){let{$$slots:t={},$$scope:o}=e,s,l,_=!1;ze(()=>{s=new je.Map({container:l,style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo",hash:!0}),s.addControl(new je.ScaleControl({})),s.addControl(new je.NavigationControl({}),"bottom-right"),s.on("load",()=>{n(1,_=!0),ge.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(l)}),Je(()=>{s.remove()});function i(a){B[a?"unshift":"push"](()=>{l=a,n(0,l)})}return r.$$set=a=>{"$$scope"in a&&n(2,o=a.$$scope)},[l,_,o,t,i]}class tn extends W{constructor(e){super(),z(this,e,Zt,Xt,J,{})}}function Ht(r){let e,n;const t=r[1].default,o=qe(t,r,r[0],null);return{c(){e=m("div"),o&&o.c(),L(e,"class","svelte-eycl9h")},m(s,l){O(s,e,l),o&&o.m(e,null),n=!0},p(s,[l]){o&&o.p&&(!n||l&1)&&Xe(o,t,s,s[0],n?He(t,s[0],l,null):Ze(s[0]),null)},i(s){n||(F(o,s),n=!0)},o(s){G(o,s),n=!1},d(s){s&&$(e),o&&o.d(s)}}}function Vt(r,e,n){let{$$slots:t={},$$scope:o}=e;return r.$$set=s=>{"$$scope"in s&&n(0,o=s.$$scope)},[o,t]}class nn extends W{constructor(e){super(),z(this,e,Vt,Ht,J,{})}}function Kt(r){let e,n,t,o,s,l,_,i;return{c(){e=m("div"),n=N(`App:
  `),t=m("select"),o=m("option"),o.textContent="Route profile tool",s=m("option"),s.textContent="Road width tool",l=m("option"),l.textContent="Maps for Cats",o.__value="index.html",ce(o,o.__value),s.__value="thicken_roads.html",ce(s,s.__value),l.__value="cats.html",ce(l,l.__value),r[0]===void 0&&it(()=>r[2].call(t))},m(a,g){O(a,e,g),b(e,n),b(e,t),b(t,o),b(t,s),b(t,l),Ie(t,r[0],!0),_||(i=[U(t,"change",r[2]),U(t,"change",r[1])],_=!0)},p(a,[g]){g&1&&Ie(t,a[0])},i:Y,o:Y,d(a){a&&$(e),_=!1,Pe(i)}}}function Qt(r,e,n){let t=window.location.pathname.split("/").pop()||"index.html",o=t;function s(){o!=t&&(window.location.href=o)}function l(){o=lt(this),n(0,o)}return[o,s,l]}class rn extends W{constructor(e){super(),z(this,e,Qt,Kt,J,{})}}export{rn as A,xt as I,pe as L,tn as M,nn as T,en as a,Le as c,Ne as e,Ye as f,bt as i,ge as m,te as n};
