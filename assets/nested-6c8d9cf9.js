import{S as D,i as A,s as j,k as g,m as h,o as L,a as $,q as y,v as J,U,V,C as I,d as k,A as R,D as G,G as B,W as N,e as z,g as K,b,c as Q,t as w,E as X,l as W,X as Y,n as S,u as C,w as Z,y as O,L as x,F as ee,H as te,I as ne,K as re,M as le,h as oe,j as se,N as ae,x as ie,O as ue,P as fe,Q as pe,R as ce,T as me}from"./SelectImportArea-8e38bc2e.js";function q(a,e,t){const r=a.slice();return r[10]=e[t],r[11]=e,r[12]=t,r}function H(a,e){let t,r,n,l,s,p,i,c,_,m,f,o;function u(){e[5].call(n,e[11],e[12])}function v(){e[6].call(p,e[11],e[12])}function M(){return e[7](e[10])}return{key:a,first:null,c(){t=g("tr"),r=g("td"),n=g("input"),l=h(),s=g("td"),p=g("input"),i=h(),c=g("td"),_=g("button"),_.textContent="Delete",m=h(),L(n,"type","text"),L(p,"type","text"),L(_,"type","button"),this.first=t},m(d,T){$(d,t,T),y(t,r),y(r,n),N(n,e[10].key),y(t,l),y(t,s),y(s,p),N(p,e[10].value),y(t,i),y(t,c),y(c,_),y(t,m),f||(o=[J(n,"input",u),J(p,"input",v),J(_,"click",M)],f=!0)},p(d,T){e=d,T&1&&n.value!==e[10].key&&N(n,e[10].key),T&1&&p.value!==e[10].value&&N(p,e[10].value)},d(d){d&&k(t),f=!1,R(o)}}}function _e(a){let e,t,r=[],n=new Map,l,s,p,i,c,_,m=a[0];const f=o=>o[10].id;for(let o=0;o<m.length;o+=1){let u=q(a,m,o),v=f(u);n.set(v,r[o]=H(v,u))}return{c(){e=g("table"),t=g("tbody");for(let o=0;o<r.length;o+=1)r[o].c();l=h(),s=g("button"),s.textContent="Add new tag",p=h(),i=g("button"),i.textContent="Recalculate",L(s,"type","button"),L(i,"type","button")},m(o,u){$(o,e,u),y(e,t);for(let v=0;v<r.length;v+=1)r[v]&&r[v].m(t,null);$(o,l,u),$(o,s,u),$(o,p,u),$(o,i,u),c||(_=[J(s,"click",a[2]),J(i,"click",a[3])],c=!0)},p(o,[u]){u&3&&(m=o[0],r=U(r,u,f,1,o,m,n,t,V,H,null,q))},i:I,o:I,d(o){o&&k(e);for(let u=0;u<r.length;u+=1)r[u].d();o&&k(l),o&&k(s),o&&k(p),o&&k(i),c=!1,R(_)}}}function de(a,e,t){let r;G(a,B,o=>t(9,r=o));let{way:n}=e,l=[],s=0;for(let[o,u]of Object.entries(JSON.parse(r.getOsmTagsForWay(n))))l.push({id:s++,key:o,value:u});function p(o){t(0,l=l.filter(u=>u.id!=o))}function i(){l.push({id:s++,key:"",value:""}),t(0,l)}function c(){let o={};for(let u of l)u.key&&u.value&&(o[u.key]=u.value);console.log(`set to ${JSON.stringify(o)}`),r.overwriteOsmTagsForWay(n,JSON.stringify(o))}function _(o,u){o[u].key=this.value,t(0,l)}function m(o,u){o[u].value=this.value,t(0,l)}const f=o=>p(o.id);return a.$$set=o=>{"way"in o&&t(4,n=o.way)},[l,p,i,c,n,_,m,f]}class ye extends D{constructor(e){super(),A(this,e,de,_e,j,{way:4})}}function ge(a){let e;return{c(){e=W("Click a road to edit")},m(t,r){$(t,e,r)},p:I,i:I,o:I,d(t){t&&k(e)}}}function $e(a){let e,t,r,n,l,s,p,i=a[0],c,_;s=new Y({props:{source:"current-way",gj:a[1],layerStyle:a[2]}});let m=P(a);return{c(){e=g("a"),t=W("Way "),r=W(a[0]),l=h(),S(s.$$.fragment),p=h(),m.c(),c=z(),L(e,"href",n="http://openstreetmap.org/way/"+a[0]),L(e,"target","_blank")},m(f,o){$(f,e,o),y(e,t),y(e,r),$(f,l,o),C(s,f,o),$(f,p,o),m.m(f,o),$(f,c,o),_=!0},p(f,o){(!_||o&1)&&Z(r,f[0]),(!_||o&1&&n!==(n="http://openstreetmap.org/way/"+f[0]))&&L(e,"href",n);const u={};o&2&&(u.gj=f[1]),s.$set(u),o&1&&j(i,i=f[0])?(K(),b(m,1,1,I),Q(),m=P(f),m.c(),w(m,1),m.m(c.parentNode,c)):m.p(f,o)},i(f){_||(w(s.$$.fragment,f),w(m),_=!0)},o(f){b(s.$$.fragment,f),b(m),_=!1},d(f){f&&k(e),f&&k(l),O(s,f),f&&k(p),f&&k(c),m.d(f)}}}function P(a){let e,t,r;return t=new ye({props:{way:a[0]}}),{c(){e=W(`>
    `),S(t.$$.fragment)},m(n,l){$(n,e,l),C(t,n,l),r=!0},p(n,l){const s={};l&1&&(s.way=n[0]),t.$set(s)},i(n){r||(w(t.$$.fragment,n),r=!0)},o(n){b(t.$$.fragment,n),r=!1},d(n){n&&k(e),O(t,n)}}}function ke(a){let e,t,r,n;const l=[$e,ge],s=[];function p(i,c){return i[0]?0:1}return e=p(a),t=s[e]=l[e](a),{c(){t.c(),r=z()},m(i,c){s[e].m(i,c),$(i,r,c),n=!0},p(i,[c]){let _=e;e=p(i),e===_?s[e].p(i,c):(K(),b(s[_],1,1,()=>{s[_]=null}),Q(),t=s[e],t?t.p(i,c):(t=s[e]=l[e](i),t.c()),w(t,1),t.m(r.parentNode,r))},i(i){n||(w(t),n=!0)},o(i){b(t),n=!1},d(i){s[e].d(i),i&&k(r)}}}function be(a,e,t){let r,n;G(a,B,i=>t(3,r=i)),G(a,X,i=>t(4,n=i));let l,s,p={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};return a.$$.update=()=>{a.$$.dirty&25&&(t(0,l=null),t(1,s=null),n?n.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(t(0,l=BigInt(n.properties.osm_way_ids[0])),t(1,s=JSON.parse(r.getGeometryForWay(l)))):(t(0,l=null),t(1,s=null)))},[l,s,p,r,n]}class we extends D{constructor(e){super(),A(this,e,be,ke,j,{})}}function he(a){let e,t,r,n,l,s,p,i,c,_,m,f,o,u;n=new re({});function v(d){a[4](d)}let M={settings:a[2]};return a[0]!==void 0&&(M.imported=a[0]),s=new le({props:M}),oe.push(()=>se(s,"imported",v)),c=new ae({props:{imported:a[0]}}),m=new we({}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",r=h(),S(n.$$.fragment),l=h(),S(s.$$.fragment),i=h(),S(c.$$.fragment),_=h(),S(m.$$.fragment),f=h(),o=g("div"),o.innerHTML=`<strong>Warnings:</strong> 
      <ul><li><strong>This tool is an early experiment</strong></li> 
        <li>Don&#39;t use this tool without understanding OSM tagging</li> 
        <li>Be careful around sidepaths, footways, and dual carriageways</li> 
        <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>`,L(e,"slot","left")},m(d,T){$(d,e,T),y(e,t),y(e,r),C(n,e,null),y(e,l),C(s,e,null),y(e,i),C(c,e,null),y(e,_),C(m,e,null),y(e,f),y(e,o),u=!0},p(d,T){const E={};!p&&T&1&&(p=!0,E.imported=d[0],ie(()=>p=!1)),s.$set(E);const F={};T&1&&(F.imported=d[0]),c.$set(F)},i(d){u||(w(n.$$.fragment,d),w(s.$$.fragment,d),w(c.$$.fragment,d),w(m.$$.fragment,d),u=!0)},o(d){b(n.$$.fragment,d),b(s.$$.fragment,d),b(c.$$.fragment,d),b(m.$$.fragment,d),u=!1},d(d){d&&k(e),O(n),O(s),O(c),O(m)}}}function ve(a){let e,t,r,n;return e=new ce({}),e.$on("polygon",a[3]),r=new me({props:{layers:a[1],showControls:!1}}),{c(){S(e.$$.fragment),t=h(),S(r.$$.fragment)},m(l,s){C(e,l,s),$(l,t,s),C(r,l,s),n=!0},p(l,s){const p={};s&2&&(p.layers=l[1]),r.$set(p)},i(l){n||(w(e.$$.fragment,l),w(r.$$.fragment,l),n=!0)},o(l){b(e.$$.fragment,l),b(r.$$.fragment,l),n=!1},d(l){O(e,l),l&&k(t),O(r,l)}}}function Se(a){let e,t,r;return t=new ue({props:{$$slots:{default:[ve]},$$scope:{ctx:a}}}),{c(){e=g("div"),S(t.$$.fragment),L(e,"slot","main")},m(n,l){$(n,e,l),C(t,e,null),r=!0},p(n,l){const s={};l&35&&(s.$$scope={dirty:l,ctx:n}),t.$set(s)},i(n){r||(w(t.$$.fragment,n),r=!0)},o(n){b(t.$$.fragment,n),r=!1},d(n){n&&k(e),O(t)}}}function Ce(a){let e,t;return e=new x({props:{$$slots:{main:[Se],left:[he]},$$scope:{ctx:a}}}),{c(){S(e.$$.fragment)},m(r,n){C(e,r,n),t=!0},p(r,[n]){const l={};n&35&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(w(e.$$.fragment,r),t=!0)},o(r){b(e.$$.fragment,r),t=!1},d(r){O(e,r)}}}function Oe(a,e,t){let r={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1,osm2lanes:!1},n={kind:"nothing"},l=[];ee(async()=>{await fe()});const s=i=>pe(i,n,r);function p(i){n=i,t(0,n)}return a.$$.update=()=>{a.$$.dirty&1&&n.kind=="done"&&(B.set(n.network),te.set(n.boundaryGJ),t(1,l=ne(n.network,n.boundaryGJ)))},[n,l,r,s,p]}class Le extends D{constructor(e){super(),A(this,e,Oe,Ce,j,{})}}new Le({target:document.getElementById("app")});
