import{S as J,i as N,s as A,o as g,p as j,c as w,q as W,e as $,r as y,u as D,z as K,v as C,k as h,n as G,x as B,D as Z,A as P,E as x,F,G as ee,d as E,H as Q,m as S,g as U,f as b,h as V,t as v,l as O,b as Y,L as te,C as ne,a as le,j as re,I as oe}from"./OverpassSelector-c7abaf02.js";import{n as I,g as se,d as ae,a as ie,e as ue,A as fe,I as ce,M as de,i as pe,f as _e}from"./MainLayers-49047439.js";function me(o){let e,n=o[0].size+"",t,l,a,r,u,p;return{c(){e=g("div"),t=j(n),l=j(" ways edited"),a=w(),r=g("button"),r.textContent="Download .osc",W(r,"type","button")},m(d,_){$(d,e,_),y(e,t),y(e,l),$(d,a,_),$(d,r,_),u||(p=D(r,"click",o[1]),u=!0)},p(d,[_]){_&1&&n!==(n=d[0].size+"")&&K(t,n)},i:C,o:C,d(d){d&&(h(e),h(a),h(r)),u=!1,p()}}}function ye(o,e,n){let t;G(o,I,u=>n(3,t=u));let l=new Set;function a(u){l.add(u.detail),n(0,l)}function r(){let u=`<osmChange version="0.6" generator="osm2streets">
`;u+=`<create/>
`,u+=`<modify>
`;for(let p of l)u+=t.wayToXml(p),u+=`
`;u+=`</modify>
`,u+="</osmChange>",se("lane_edits.osc",u)}return[l,r,a]}class ge extends J{constructor(e){super(),N(this,e,ye,me,A,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function H(o,e,n){const t=o.slice();return t[11]=e[n],t[12]=e,t[13]=n,t}function R(o,e){let n,t,l,a,r,u,p,d,_,s,c,i;function f(){e[5].call(l,e[12],e[13])}function m(){e[6].call(u,e[12],e[13])}function M(){return e[7](e[11])}return{key:o,first:null,c(){n=g("tr"),t=g("td"),l=g("input"),a=w(),r=g("td"),u=g("input"),p=w(),d=g("td"),_=g("button"),_.textContent="Delete",s=w(),W(l,"type","text"),W(u,"type","text"),W(_,"type","button"),this.first=n},m(T,L){$(T,n,L),y(n,t),y(t,l),F(l,e[11].key),y(n,a),y(n,r),y(r,u),F(u,e[11].value),y(n,p),y(n,d),y(d,_),y(n,s),c||(i=[D(l,"input",f),D(u,"input",m),D(_,"click",M)],c=!0)},p(T,L){e=T,L&1&&l.value!==e[11].key&&F(l,e[11].key),L&1&&u.value!==e[11].value&&F(u,e[11].value)},d(T){T&&h(n),c=!1,P(i)}}}function $e(o){let e,n,t=[],l=new Map,a,r,u,p,d,_,s=B(o[0]);const c=i=>i[11].id;for(let i=0;i<s.length;i+=1){let f=H(o,s,i),m=c(f);l.set(m,t[i]=R(m,f))}return{c(){e=g("table"),n=g("tbody");for(let i=0;i<t.length;i+=1)t[i].c();a=w(),r=g("button"),r.textContent="Add new tag",u=w(),p=g("button"),p.textContent="Recalculate",W(r,"type","button"),W(p,"type","button")},m(i,f){$(i,e,f),y(e,n);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(n,null);$(i,a,f),$(i,r,f),$(i,u,f),$(i,p,f),d||(_=[D(r,"click",o[2]),D(p,"click",o[3])],d=!0)},p(i,[f]){f&3&&(s=B(i[0]),t=Z(t,f,c,1,i,s,l,n,ee,R,null,H))},i:C,o:C,d(i){i&&(h(e),h(a),h(r),h(u),h(p));for(let f=0;f<t.length;f+=1)t[f].d();d=!1,P(_)}}}function he(o,e,n){let t;G(o,I,f=>n(9,t=f));let l=x(),{way:a}=e,r=[],u=0;for(let[f,m]of Object.entries(JSON.parse(t.getOsmTagsForWay(a))))r.push({id:u++,key:f,value:m});function p(f){n(0,r=r.filter(m=>m.id!=f))}function d(){r.push({id:u++,key:"",value:""}),n(0,r)}function _(){let f={};for(let m of r)m.key&&m.value&&(f[m.key]=m.value);t.overwriteOsmTagsForWay(a,JSON.stringify(f)),I.set(t),l("editedWay",a)}function s(f,m){f[m].key=this.value,n(0,r)}function c(f,m){f[m].value=this.value,n(0,r)}const i=f=>p(f.id);return o.$$set=f=>{"way"in f&&n(4,a=f.way)},[r,p,d,_,a,s,c,i]}class ke extends J{constructor(e){super(),N(this,e,he,$e,A,{way:4})}}function we(o){let e;return{c(){e=j("Click a road to edit")},m(n,t){$(n,e,t)},p:C,i:C,o:C,d(n){n&&h(e)}}}function be(o){let e,n,t,l,a,r,u,p=o[0],d,_;r=new ie({props:{source:"current-way",gj:o[2],layerStyle:o[3]}});let s=X(o);return{c(){e=g("a"),n=j("Way "),t=j(o[0]),a=w(),E(r.$$.fragment),u=w(),s.c(),d=Q(),W(e,"href",l="http://openstreetmap.org/way/"+o[0]),W(e,"target","_blank")},m(c,i){$(c,e,i),y(e,n),y(e,t),$(c,a,i),S(r,c,i),$(c,u,i),s.m(c,i),$(c,d,i),_=!0},p(c,i){(!_||i&1)&&K(t,c[0]),(!_||i&1&&l!==(l="http://openstreetmap.org/way/"+c[0]))&&W(e,"href",l);const f={};i&4&&(f.gj=c[2]),r.$set(f),i&1&&A(p,p=c[0])?(U(),b(s,1,1,C),V(),s=X(c),s.c(),v(s,1),s.m(d.parentNode,d)):s.p(c,i)},i(c){_||(v(r.$$.fragment,c),v(s),_=!0)},o(c){b(r.$$.fragment,c),b(s),_=!1},d(c){c&&(h(e),h(a),h(u),h(d)),O(r,c),s.d(c)}}}function X(o){let e,n;return e=new ke({props:{way:o[0]}}),e.$on("editedWay",o[7]),{c(){E(e.$$.fragment)},m(t,l){S(e,t,l),n=!0},p(t,l){const a={};l&1&&(a.way=t[0]),e.$set(a)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function ve(o){let e,n,t,l,a,r,u={};e=new ge({props:u}),o[6](e);const p=[be,we],d=[];function _(s,c){return s[0]?0:1}return t=_(o),l=d[t]=p[t](o),{c(){E(e.$$.fragment),n=w(),l.c(),a=Q()},m(s,c){S(e,s,c),$(s,n,c),d[t].m(s,c),$(s,a,c),r=!0},p(s,[c]){const i={};e.$set(i);let f=t;t=_(s),t===f?d[t].p(s,c):(U(),b(d[f],1,1,()=>{d[f]=null}),V(),l=d[t],l?l.p(s,c):(l=d[t]=p[t](s),l.c()),v(l,1),l.m(a.parentNode,a))},i(s){r||(v(e.$$.fragment,s),v(l),r=!0)},o(s){b(e.$$.fragment,s),b(l),r=!1},d(s){s&&(h(n),h(a)),o[6](null),O(e,s),d[t].d(s)}}}function We(o,e,n){let t,l;G(o,I,s=>n(4,t=s)),G(o,ae,s=>n(5,l=s));let a,r,u,p={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function d(s){Y[s?"unshift":"push"](()=>{a=s,n(1,a)})}const _=s=>a.handleEditedWay(s);return o.$$.update=()=>{o.$$.dirty&49&&(n(0,r=null),n(2,u=null),l?l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(n(0,r=BigInt(l.properties.osm_way_ids[0])),n(2,u=JSON.parse(t.getGeometryForWay(r)))):(n(0,r=null),n(2,u=null)))},[r,a,u,p,t,l,d,_]}class Ce extends J{constructor(e){super(),N(this,e,We,ve,A,{})}}function Ee(o){let e,n,t,l,a,r,u,p,d,_,s,c,i,f,m,M;l=new fe({});function T(k){o[1](k)}let L={};return o[0]!==void 0&&(L.imported=o[0]),p=new ce({props:L}),Y.push(()=>le(p,"imported",T)),i=new Ce({}),{c(){e=g("div"),n=g("h1"),n.textContent="osm2streets lane editor",t=w(),E(l.$$.fragment),a=w(),r=g("hr"),u=w(),E(p.$$.fragment),_=w(),s=g("hr"),c=w(),E(i.$$.fragment),f=w(),m=g("div"),m.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m(k,q){$(k,e,q),y(e,n),y(e,t),S(l,e,null),y(e,a),y(e,r),y(e,u),S(p,e,null),y(e,_),y(e,s),y(e,c),S(i,e,null),y(e,f),y(e,m),M=!0},p(k,q){const z={};!d&&q&1&&(d=!0,z.imported=k[0],re(()=>d=!1)),p.$set(z)},i(k){M||(v(l.$$.fragment,k),v(p.$$.fragment,k),v(i.$$.fragment,k),M=!0)},o(k){b(l.$$.fragment,k),b(p.$$.fragment,k),b(i.$$.fragment,k),M=!1},d(k){k&&h(e),O(l),O(p),O(i)}}}function Se(o){let e,n,t;return n=new _e({}),{c(){e=g("div"),E(n.$$.fragment),oe(e,"display","none")},m(l,a){$(l,e,a),S(n,e,null),t=!0},p:C,i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){b(n.$$.fragment,l),t=!1},d(l){l&&h(e),O(n)}}}function Oe(o){let e,n,t;return n=new de({props:{$$slots:{default:[Se]},$$scope:{ctx:o}}}),{c(){e=g("div"),E(n.$$.fragment),W(e,"slot","main")},m(l,a){$(l,e,a),S(n,e,null),t=!0},p(l,a){const r={};a&4&&(r.$$scope={dirty:a,ctx:l}),n.$set(r)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){b(n.$$.fragment,l),t=!1},d(l){l&&h(e),O(n)}}}function Te(o){let e,n;return e=new te({props:{$$slots:{main:[Oe],left:[Ee]},$$scope:{ctx:o}}}),{c(){E(e.$$.fragment)},m(t,l){S(e,t,l),n=!0},p(t,[l]){const a={};l&5&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function Le(o,e,n){let t={kind:"nothing"};ne(async()=>{await pe()});function l(a){t=a,n(0,t)}return o.$$.update=()=>{o.$$.dirty&1&&t.kind=="done"&&(I.set(t.network),ue.set(t.boundaryGJ))},[t,l]}class Me extends J{constructor(e){super(),N(this,e,Le,Te,A,{})}}new Me({target:document.getElementById("app")});
