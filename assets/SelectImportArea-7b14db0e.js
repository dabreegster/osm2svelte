import{A as Un,b as ge,t as oe,K as bt,M as Ri,S as Ce,i as Se,s as Te,e as Gn,a as pe,D as Me,d as he,E as Ee,H as Bn,G as mo,k as $,o as At,v as at,g as $t,c as en,h as Ie,j as Le,n as Xe,u as Ze,x as xe,y as Ke,F as An,l as Pt,B as yt,p as Tr,q as re,r as xn,C as Or,N as Ir,m as Ft,O as dr,P as kr,Q as Lr,R as Mr,f as pr,w as bo,z as Di,T as qt,U as Ui,I as Gi}from"./maplibre-gl-d0269db5.js";function Rn(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function Xa(i,n){i.d(1),n.delete(i.key)}function Bi(i,n){ge(i,1,1,()=>{n.delete(i.key)})}function Vi(i,n,r,o,s,l,f,b,g,m,w,O){let y=i.length,N=l.length,S=y;const x={};for(;S--;)x[i[S].key]=S;const H=[],X=new Map,J=new Map,P=[];for(S=N;S--;){const ee=O(s,l,S),Fe=r(ee);let ke=f.get(Fe);ke?o&&P.push(()=>ke.p(ee,n)):(ke=m(Fe,ee),ke.c()),X.set(Fe,H[S]=ke),Fe in x&&J.set(Fe,Math.abs(S-x[Fe]))}const q=new Set,j=new Set;function me(ee){oe(ee,1),ee.m(b,w),f.set(ee.key,ee),w=ee.first,N--}for(;y&&N;){const ee=H[N-1],Fe=i[y-1],ke=ee.key,st=Fe.key;ee===Fe?(w=ee.first,y--,N--):X.has(st)?!f.has(ke)||q.has(ke)?me(ee):j.has(st)?y--:J.get(ke)>J.get(st)?(j.add(ke),me(ee)):(q.add(st),y--):(g(Fe,f),y--)}for(;y--;){const ee=i[y];X.has(ee.key)||g(ee,f)}for(;N;)me(H[N-1]);return Un(P),H}let C;const He=new Array(128).fill(void 0);He.push(void 0,null,!0,!1);function V(i){return He[i]}let Kt=He.length;function Ji(i){i<132||(He[i]=Kt,Kt=i)}function Vn(i){const n=V(i);return Ji(i),n}const Fr=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Fr.decode();let Yt=null;function Pn(){return(Yt===null||Yt.byteLength===0)&&(Yt=new Uint8Array(C.memory.buffer)),Yt}function ue(i,n){return Fr.decode(Pn().subarray(i,i+n))}function de(i){Kt===He.length&&He.push(He.length+1);const n=Kt;return Kt=He[n],He[n]=i,n}function po(i){return i==null}let Ht=null;function zi(){return(Ht===null||Ht.byteLength===0)&&(Ht=new Float64Array(C.memory.buffer)),Ht}let Xt=null;function U(){return(Xt===null||Xt.byteLength===0)&&(Xt=new Int32Array(C.memory.buffer)),Xt}let it=0;const jn=new TextEncoder("utf-8"),Wi=typeof jn.encodeInto=="function"?function(i,n){return jn.encodeInto(i,n)}:function(i,n){const r=jn.encode(i);return n.set(r),{read:i.length,written:r.length}};function Nt(i,n,r){if(r===void 0){const b=jn.encode(i),g=n(b.length);return Pn().subarray(g,g+b.length).set(b),it=b.length,g}let o=i.length,s=n(o);const l=Pn();let f=0;for(;f<o;f++){const b=i.charCodeAt(f);if(b>127)break;l[s+f]=b}if(f!==o){f!==0&&(i=i.slice(f)),s=r(s,o,o=f+i.length*3);const b=Pn().subarray(s+f,s+o),g=Wi(i,b);f+=g.written}return it=f,s}function ho(i){const n=typeof i;if(n=="number"||n=="boolean"||i==null)return`${i}`;if(n=="string")return`"${i}"`;if(n=="symbol"){const s=i.description;return s==null?"Symbol":`Symbol(${s})`}if(n=="function"){const s=i.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(i)){const s=i.length;let l="[";s>0&&(l+=ho(i[0]));for(let f=1;f<s;f++)l+=", "+ho(i[f]);return l+="]",l}const r=/\[object ([^\]]+)\]/.exec(toString.call(i));let o;if(r.length>1)o=r[1];else return toString.call(i);if(o=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:o}let Zt=null;function qi(){return(Zt===null||Zt.byteLength===0)&&(Zt=new Uint32Array(C.memory.buffer)),Zt}function Yi(i,n){const o=qi().subarray(i/4,i/4+n),s=[];for(let l=0;l<o.length;l++)s.push(Vn(o[l]));return s}function Mt(i,n){try{return i.apply(this,n)}catch(r){C.__wbindgen_exn_store(de(r))}}class vo{static __wrap(n){const r=Object.create(vo.prototype);return r.ptr=n,r}__destroy_into_raw(){const n=this.ptr;return this.ptr=0,n}free(){const n=this.__destroy_into_raw();C.__wbg_jsdebugstreets_free(n)}getLabel(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsdebugstreets_getLabel(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}getNetwork(){const n=C.jsdebugstreets_getNetwork(this.ptr);return Vn(n)}toDebugGeojson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsdebugstreets_toDebugGeojson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];let s;return n!==0&&(s=ue(n,r).slice(),C.__wbindgen_free(n,r*1)),s}finally{C.__wbindgen_add_to_stack_pointer(16)}}}class jt{static __wrap(n){const r=Object.create(jt.prototype);return r.ptr=n,r}__destroy_into_raw(){const n=this.ptr;return this.ptr=0,n}free(){const n=this.__destroy_into_raw();C.__wbg_jsstreetnetwork_free(n)}constructor(n,r,o){try{const b=C.__wbindgen_add_to_stack_pointer(-16),g=Nt(n,C.__wbindgen_malloc,C.__wbindgen_realloc),m=it,w=Nt(r,C.__wbindgen_malloc,C.__wbindgen_realloc),O=it;C.jsstreetnetwork_new(b,g,m,w,O,de(o));var s=U()[b/4+0],l=U()[b/4+1],f=U()[b/4+2];if(f)throw Vn(l);return jt.__wrap(s)}finally{C.__wbindgen_add_to_stack_pointer(16)}}toGeojsonPlain(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toGeojsonPlain(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}toLanePolygonsGeojson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toLanePolygonsGeojson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}toLaneMarkingsGeojson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toLaneMarkingsGeojson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}toIntersectionMarkingsGeojson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toIntersectionMarkingsGeojson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}toGraphviz(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toGraphviz(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}getDebugSteps(){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_getDebugSteps(s,this.ptr);var n=U()[s/4+0],r=U()[s/4+1],o=Yi(n,r).slice();return C.__wbindgen_free(n,r*4),o}finally{C.__wbindgen_add_to_stack_pointer(16)}}debugClockwiseOrderingGeojson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_debugClockwiseOrderingGeojson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}debugClockwiseOrderingForIntersectionGeojson(n){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_debugClockwiseOrderingForIntersectionGeojson(s,this.ptr,n);var r=U()[s/4+0],o=U()[s/4+1];return ue(r,o)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(r,o)}}debugMovementsFromLaneGeojson(n,r){try{const l=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_debugMovementsFromLaneGeojson(l,this.ptr,n,r);var o=U()[l/4+0],s=U()[l/4+1];return ue(o,s)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(o,s)}}debugRoadsConnectedToIntersectionGeojson(n){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_debugRoadsConnectedToIntersectionGeojson(s,this.ptr,n);var r=U()[s/4+0],o=U()[s/4+1];return ue(r,o)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(r,o)}}getOsmTagsForWay(n){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_getOsmTagsForWay(s,this.ptr,n);var r=U()[s/4+0],o=U()[s/4+1];return ue(r,o)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(r,o)}}toJson(){try{const o=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_toJson(o,this.ptr);var n=U()[o/4+0],r=U()[o/4+1];return ue(n,r)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(n,r)}}getGeometryForWay(n){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_getGeometryForWay(s,this.ptr,n);var r=U()[s/4+0],o=U()[s/4+1];return ue(r,o)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(r,o)}}wayToXml(n){try{const s=C.__wbindgen_add_to_stack_pointer(-16);C.jsstreetnetwork_wayToXml(s,this.ptr,n);var r=U()[s/4+0],o=U()[s/4+1];return ue(r,o)}finally{C.__wbindgen_add_to_stack_pointer(16),C.__wbindgen_free(r,o)}}overwriteOsmTagsForWay(n,r){const o=Nt(r,C.__wbindgen_malloc,C.__wbindgen_realloc),s=it;C.jsstreetnetwork_overwriteOsmTagsForWay(this.ptr,n,o,s)}collapseShortRoad(n){C.jsstreetnetwork_collapseShortRoad(this.ptr,n)}collapseIntersection(n){C.jsstreetnetwork_collapseIntersection(this.ptr,n)}zipSidepath(n){C.jsstreetnetwork_zipSidepath(this.ptr,n)}}async function Hi(i,n){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,n)}catch(o){if(i.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const r=await i.arrayBuffer();return await WebAssembly.instantiate(r,n)}else{const r=await WebAssembly.instantiate(i,n);return r instanceof WebAssembly.Instance?{instance:r,module:i}:r}}function Xi(){const i={};return i.wbg={},i.wbg.__wbg_jsdebugstreets_new=function(n){const r=vo.__wrap(n);return de(r)},i.wbg.__wbindgen_boolean_get=function(n){const r=V(n);return typeof r=="boolean"?r?1:0:2},i.wbg.__wbindgen_object_drop_ref=function(n){Vn(n)},i.wbg.__wbindgen_is_object=function(n){const r=V(n);return typeof r=="object"&&r!==null},i.wbg.__wbindgen_is_undefined=function(n){return V(n)===void 0},i.wbg.__wbindgen_in=function(n,r){return V(n)in V(r)},i.wbg.__wbg_jsstreetnetwork_new=function(n){const r=jt.__wrap(n);return de(r)},i.wbg.__wbindgen_string_new=function(n,r){const o=ue(n,r);return de(o)},i.wbg.__wbindgen_error_new=function(n,r){const o=new Error(ue(n,r));return de(o)},i.wbg.__wbindgen_jsval_loose_eq=function(n,r){return V(n)==V(r)},i.wbg.__wbindgen_number_get=function(n,r){const o=V(r),s=typeof o=="number"?o:void 0;zi()[n/8+1]=po(s)?0:s,U()[n/4+0]=!po(s)},i.wbg.__wbindgen_string_get=function(n,r){const o=V(r),s=typeof o=="string"?o:void 0;var l=po(s)?0:Nt(s,C.__wbindgen_malloc,C.__wbindgen_realloc),f=it;U()[n/4+1]=f,U()[n/4+0]=l},i.wbg.__wbindgen_object_clone_ref=function(n){const r=V(n);return de(r)},i.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(n,r){const o=V(n)[V(r)];return de(o)},i.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return de(n)},i.wbg.__wbg_stack_658279fe44541cf6=function(n,r){const o=V(r).stack,s=Nt(o,C.__wbindgen_malloc,C.__wbindgen_realloc),l=it;U()[n/4+1]=l,U()[n/4+0]=s},i.wbg.__wbg_error_f851667af71bcfc6=function(n,r){try{console.error(ue(n,r))}finally{C.__wbindgen_free(n,r)}},i.wbg.__wbg_now_c644db5194be8437=function(n){return V(n).now()},i.wbg.__wbg_debug_8db2eed1bf6c1e2a=function(n){console.debug(V(n))},i.wbg.__wbg_error_fe807da27c4a4ced=function(n){console.error(V(n))},i.wbg.__wbg_info_9e6db45ac337c3b5=function(n){console.info(V(n))},i.wbg.__wbg_log_7bb108d119bafbc1=function(n){console.log(V(n))},i.wbg.__wbg_warn_e57696dbb3977030=function(n){console.warn(V(n))},i.wbg.__wbg_newnoargs_2b8b6bd7753c76ba=function(n,r){const o=new Function(ue(n,r));return de(o)},i.wbg.__wbg_get_baf4855f9a986186=function(){return Mt(function(n,r){const o=Reflect.get(V(n),V(r));return de(o)},arguments)},i.wbg.__wbg_call_95d1ea488d03e4e8=function(){return Mt(function(n,r){const o=V(n).call(V(r));return de(o)},arguments)},i.wbg.__wbg_self_e7c1f827057f6584=function(){return Mt(function(){const n=self.self;return de(n)},arguments)},i.wbg.__wbg_window_a09ec664e14b1b81=function(){return Mt(function(){const n=window.window;return de(n)},arguments)},i.wbg.__wbg_globalThis_87cbb8506fecf3a9=function(){return Mt(function(){const n=globalThis.globalThis;return de(n)},arguments)},i.wbg.__wbg_global_c85a9259e621f3db=function(){return Mt(function(){const n=global.global;return de(n)},arguments)},i.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(n){let r;try{r=V(n)instanceof ArrayBuffer}catch{r=!1}return r},i.wbg.__wbg_buffer_cf65c07de34b9a08=function(n){const r=V(n).buffer;return de(r)},i.wbg.__wbg_new_537b7341ce90bb31=function(n){const r=new Uint8Array(V(n));return de(r)},i.wbg.__wbg_set_17499e8aa4003ebd=function(n,r,o){V(n).set(V(r),o>>>0)},i.wbg.__wbg_length_27a2afe8ab42b09f=function(n){return V(n).length},i.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(n){let r;try{r=V(n)instanceof Uint8Array}catch{r=!1}return r},i.wbg.__wbindgen_debug_string=function(n,r){const o=ho(V(r)),s=Nt(o,C.__wbindgen_malloc,C.__wbindgen_realloc),l=it;U()[n/4+1]=l,U()[n/4+0]=s},i.wbg.__wbindgen_throw=function(n,r){throw new Error(ue(n,r))},i.wbg.__wbindgen_memory=function(){const n=C.memory;return de(n)},i}function Zi(i,n){return C=i.exports,Ki.__wbindgen_wasm_module=n,Ht=null,Xt=null,Zt=null,Yt=null,C}async function Ki(i){typeof i>"u"&&(i="/osm2svelte/assets/osm2streets_js_bg.wasm");const n=Xi();(typeof i=="string"||typeof Request=="function"&&i instanceof Request||typeof URL=="function"&&i instanceof URL)&&(i=fetch(i));const{instance:r,module:o}=await Hi(await i,n);return Zi(r,o)}let Nn;const Qi=new Uint8Array(16);function $i(){if(!Nn&&(Nn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Nn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Nn(Qi)}const ye=[];for(let i=0;i<256;++i)ye.push((i+256).toString(16).slice(1));function ea(i,n=0){return(ye[i[n+0]]+ye[i[n+1]]+ye[i[n+2]]+ye[i[n+3]]+"-"+ye[i[n+4]]+ye[i[n+5]]+"-"+ye[i[n+6]]+ye[i[n+7]]+"-"+ye[i[n+8]]+ye[i[n+9]]+"-"+ye[i[n+10]]+ye[i[n+11]]+ye[i[n+12]]+ye[i[n+13]]+ye[i[n+14]]+ye[i[n+15]]).toLowerCase()}const ta=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hr={randomUUID:ta};function rt(i,n,r){if(hr.randomUUID&&!n&&!i)return hr.randomUUID();i=i||{};const o=i.random||(i.rng||$i)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,n){r=r||0;for(let s=0;s<16;++s)n[r+s]=o[s];return n}return ea(o)}const vt=bt(null),Jn=bt(null),Za=bt(null),go=bt(null),Dn=bt(null),Qt=bt(null),_o=bt(null);Jn.subscribe(i=>{go.set(null),Dn.set(null),Qt.set(null),_o.set(null)});function Nr(i,n,r){if(i!==null)for(var o,s,l,f,b,g,m,w=0,O=0,y,N=i.type,S=N==="FeatureCollection",x=N==="Feature",H=S?i.features.length:1,X=0;X<H;X++){m=S?i.features[X].geometry:x?i.geometry:i,y=m?m.type==="GeometryCollection":!1,b=y?m.geometries.length:1;for(var J=0;J<b;J++){var P=0,q=0;if(f=y?m.geometries[J]:m,f!==null){g=f.coordinates;var j=f.type;switch(w=r&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(n(g,O,X,P,q)===!1)return!1;O++,P++;break;case"LineString":case"MultiPoint":for(o=0;o<g.length;o++){if(n(g[o],O,X,P,q)===!1)return!1;O++,j==="MultiPoint"&&P++}j==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(o=0;o<g.length;o++){for(s=0;s<g[o].length-w;s++){if(n(g[o][s],O,X,P,q)===!1)return!1;O++}j==="MultiLineString"&&P++,j==="Polygon"&&q++}j==="Polygon"&&P++;break;case"MultiPolygon":for(o=0;o<g.length;o++){for(q=0,s=0;s<g[o].length;s++){for(l=0;l<g[o][s].length-w;l++){if(n(g[o][s][l],O,X,P,q)===!1)return!1;O++}q++}P++}break;case"GeometryCollection":for(o=0;o<f.geometries.length;o++)if(Nr(f.geometries[o],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yo(i){var n=[1/0,1/0,-1/0,-1/0];return Nr(i,function(r){n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}yo.default=yo;function zn(i,n,r){let o=["case"];for(let[s,l]of Object.entries(n))o.push(["==",["get",i],s]),o.push(l);return o.push(r),o}function Ar(i,n,r){return["case",["boolean",["feature-state",i],!1],r,n]}function mt(){return{type:"FeatureCollection",features:[]}}function Pr(i){return yo(i)}function na(i){let n=Ri(vt),r,o=!1;for(let s=gr.length-1;s>=0;s--){let l=gr[s];if(l==i){o=!0;break}n.getLayer(l)&&(r=l)}if(!o)throw new Error(`Layer ID ${i} not defined in layerZorder`);return r}const gr=["boundary-layer","lane-polygons-layer","intersection-polygons-layer","lane-markings-layer","intersection-markings-layer","movements-layer","connected-roads-layer","road-weights-layer","current-way-layer","building-hitboxes-layer","road_label"];function jr(i,n){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(n)),r.setAttribute("download",i),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function _r(i){let n,r,o;return{c(){n=$("button"),n.textContent="Download",At(n,"type","button")},m(s,l){pe(s,n,l),r||(o=at(n,"click",i[1]),r=!0)},p:Me,d(s){s&&he(n),r=!1,o()}}}function oa(i){let n,r=i[0]&&_r(i);return{c(){r&&r.c(),n=Gn()},m(o,s){r&&r.m(o,s),pe(o,n,s)},p(o,[s]){o[0]?r?r.p(o,s):(r=_r(o),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:Me,o:Me,d(o){o&&he(n),r&&r.d(o)}}}function ra(i,n,r){let o;Ee(i,vt,j=>r(9,o=j));let{source:s}=n,{show:l=!0}=n,{gj:f}=n,{layerStyle:b}=n,{downloadable:g=!1}=n,{interactive:m=!1}=n,{hoveredFeature:w=null}=n,{clickedFeature:O=null}=n,y,N,S=`${s}-layer`;Bn(()=>{x(),o.addSource(s,{type:"geojson",data:f}),o.addLayer({id:S,source:s,...b},na(S)),l||o.setLayoutProperty(S,"visibility","none"),m&&(o.on("mousemove",S,H),o.on("mouseleave",S,X),o.on("click",J))}),mo(()=>{m&&(o.off("mousemove",H),o.off("mouseleave",X),o.off("click",J),P()),o.getLayer(S)&&o.removeLayer(S),o.removeSource(s)});function x(){if("features"in f)for(let[j,me]of f.features.entries())me.id=j+1}function H(j){j.features.length>0&&y!=j.features[0].id&&(P(),y=j.features[0].id,o.setFeatureState({source:s,id:y},{hover:!0}),"features"in f&&r(2,w=f.features.find(me=>me.id==y)))}function X(){P(),r(2,w=null),y=void 0}function J(j){O!==null&&o.setFeatureState({source:s,id:N},{clicked:!1});let me=o.queryRenderedFeatures(j.point,{layers:[S]});me.length==1?(N=me[0].id,o.setFeatureState({source:s,id:N},{clicked:!0}),"features"in f&&r(3,O=f.features.find(ee=>ee.id==N))):(r(3,O=null),N=void 0)}function P(){y!==void 0&&o.setFeatureState({source:s,id:y},{hover:!1})}function q(){jr("layer.geojson",JSON.stringify(f))}return i.$$set=j=>{"source"in j&&r(4,s=j.source),"show"in j&&r(5,l=j.show),"gj"in j&&r(6,f=j.gj),"layerStyle"in j&&r(7,b=j.layerStyle),"downloadable"in j&&r(0,g=j.downloadable),"interactive"in j&&r(8,m=j.interactive),"hoveredFeature"in j&&r(2,w=j.hoveredFeature),"clickedFeature"in j&&r(3,O=j.clickedFeature)},i.$$.update=()=>{if(i.$$.dirty&592){let j=o.getSource(s);j&&(console.log(`GeoJSON data for ${s} changed, updating`),j.setData(f))}i.$$.dirty&544&&o.getLayer(S)&&o.setLayoutProperty(S,"visibility",l?"visible":"none")},[g,q,w,O,s,l,f,b,m,o]}class wt extends Ce{constructor(n){super(),Se(this,n,ra,oa,Te,{source:4,show:5,gj:6,layerStyle:7,downloadable:0,interactive:8,hoveredFeature:2,clickedFeature:3})}}function yr(i){let n,r,o;function s(f){i[5](f)}let l={source:"connected-roads",gj:i[1],layerStyle:i[2]};return i[0]!==void 0&&(l.show=i[0]),n=new wt({props:l}),Ie.push(()=>Le(n,"show",s)),{c(){Xe(n.$$.fragment)},m(f,b){Ze(n,f,b),o=!0},p(f,b){const g={};b&2&&(g.gj=f[1]),!r&&b&1&&(r=!0,g.show=f[0],xe(()=>r=!1)),n.$set(g)},i(f){o||(oe(n.$$.fragment,f),o=!0)},o(f){ge(n.$$.fragment,f),o=!1},d(f){Ke(n,f)}}}function ia(i){let n,r,o=i[1].features.length&&yr(i);return{c(){o&&o.c(),n=Gn()},m(s,l){o&&o.m(s,l),pe(s,n,l),r=!0},p(s,[l]){s[1].features.length?o?(o.p(s,l),l&2&&oe(o,1)):(o=yr(s),o.c(),oe(o,1),o.m(n.parentNode,n)):o&&($t(),ge(o,1,1,()=>{o=null}),en())},i(s){r||(oe(o),r=!0)},o(s){ge(o),r=!1},d(s){s&&he(n),o&&o.d(s)}}}function aa(i,n,r){let o,s;Ee(i,Qt,m=>r(3,o=m)),Ee(i,Jn,m=>r(4,s=m));let{show:l}=n,f={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}},b=mt();function g(m){l=m,r(0,l)}return i.$$set=m=>{"show"in m&&r(0,l=m.show)},i.$$.update=()=>{i.$$.dirty&24&&(r(1,b=mt()),o&&r(1,b=JSON.parse(s.debugRoadsConnectedToIntersectionGeojson(o.properties.id))))},[l,b,f,o,s,g]}class sa extends Ce{constructor(n){super(),Se(this,n,aa,ia,Te,{show:0})}}function mr(i){let n,r,o;function s(f){i[5](f)}let l={source:"movements",gj:i[1],layerStyle:i[2]};return i[0]!==void 0&&(l.show=i[0]),n=new wt({props:l}),Ie.push(()=>Le(n,"show",s)),{c(){Xe(n.$$.fragment)},m(f,b){Ze(n,f,b),o=!0},p(f,b){const g={};b&2&&(g.gj=f[1]),!r&&b&1&&(r=!0,g.show=f[0],xe(()=>r=!1)),n.$set(g)},i(f){o||(oe(n.$$.fragment,f),o=!0)},o(f){ge(n.$$.fragment,f),o=!1},d(f){Ke(n,f)}}}function ua(i){let n,r,o=i[1].features.length&&mr(i);return{c(){o&&o.c(),n=Gn()},m(s,l){o&&o.m(s,l),pe(s,n,l),r=!0},p(s,[l]){s[1].features.length?o?(o.p(s,l),l&2&&oe(o,1)):(o=mr(s),o.c(),oe(o,1),o.m(n.parentNode,n)):o&&($t(),ge(o,1,1,()=>{o=null}),en())},i(s){r||(oe(o),r=!0)},o(s){ge(o),r=!1},d(s){s&&he(n),o&&o.d(s)}}}function ca(i,n,r){let o,s;Ee(i,Jn,m=>r(3,o=m)),Ee(i,Dn,m=>r(4,s=m));let{show:l}=n,f={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}},b=mt();function g(m){l=m,r(0,l)}return i.$$set=m=>{"show"in m&&r(0,l=m.show)},i.$$.update=()=>{if(i.$$.dirty&24&&(r(1,b=mt()),s)){let m=s.properties;r(1,b=JSON.parse(o.debugMovementsFromLaneGeojson(m.road,m.index)))}},[l,b,f,o,s,g]}class la extends Ce{constructor(n){super(),Se(this,n,ca,ua,Te,{show:0})}}function fa(i,n,r){let o,s,l;Ee(i,vt,g=>r(2,o=g)),Ee(i,Qt,g=>r(3,s=g)),Ee(i,Jn,g=>r(4,l=g));let{show:f}=n,b=[];return i.$$set=g=>{"show"in g&&r(0,f=g.show)},i.$$.update=()=>{if(i.$$.dirty&31){for(let g of b)g.remove();if(r(1,b=[]),f&&s){let g=JSON.parse(l.debugClockwiseOrderingForIntersectionGeojson(s.properties.id));for(let m of g.features)b.push(new An.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1}).setLngLat(m.geometry.coordinates).setHTML(m.properties.label).addTo(o))}}},[f,b,o,s,l]}class da extends Ce{constructor(n){super(),Se(this,n,fa,null,Te,{show:0})}}function pa(i){let n,r,o;function s(f){i[4](f)}let l={source:"boundary",gj:i[1],layerStyle:i[3],downloadable:i[2]};return i[0]!==void 0&&(l.show=i[0]),n=new wt({props:l}),Ie.push(()=>Le(n,"show",s)),{c(){Xe(n.$$.fragment)},m(f,b){Ze(n,f,b),o=!0},p(f,[b]){const g={};b&2&&(g.gj=f[1]),b&4&&(g.downloadable=f[2]),!r&&b&1&&(r=!0,g.show=f[0],xe(()=>r=!1)),n.$set(g)},i(f){o||(oe(n.$$.fragment,f),o=!0)},o(f){ge(n.$$.fragment,f),o=!1},d(f){Ke(n,f)}}}function ha(i,n,r){let o;Ee(i,vt,m=>r(5,o=m));let{gj:s}=n,{show:l}=n,{downloadable:f}=n,b={type:"line",paint:{"line-color":"blue","line-width":4}};o.fitBounds(Pr(s),{animate:!1,padding:10});function g(m){l=m,r(0,l)}return i.$$set=m=>{"gj"in m&&r(1,s=m.gj),"show"in m&&r(0,l=m.show),"downloadable"in m&&r(2,f=m.downloadable)},[l,s,f,b,g]}class ga extends Ce{constructor(n){super(),Se(this,n,ha,pa,Te,{gj:1,show:0,downloadable:2})}}function _a(i){let n,r,o;function s(f){i[4](f)}let l={source:"intersection-markings",gj:i[1],layerStyle:i[3],downloadable:i[2]};return i[0]!==void 0&&(l.show=i[0]),n=new wt({props:l}),Ie.push(()=>Le(n,"show",s)),{c(){Xe(n.$$.fragment)},m(f,b){Ze(n,f,b),o=!0},p(f,[b]){const g={};b&2&&(g.gj=f[1]),b&4&&(g.downloadable=f[2]),!r&&b&1&&(r=!0,g.show=f[0],xe(()=>r=!1)),n.$set(g)},i(f){o||(oe(n.$$.fragment,f),o=!0)},o(f){ge(n.$$.fragment,f),o=!1},d(f){Ke(n,f)}}}function ya(i,n,r){let{gj:o}=n,{show:s}=n,{downloadable:l}=n,f={type:"fill",paint:{"fill-color":zn("type",{"sidewalk corner":"#CCCCCC"},"red"),"fill-opacity":.9}};function b(g){s=g,r(0,s)}return i.$$set=g=>{"gj"in g&&r(1,o=g.gj),"show"in g&&r(0,s=g.show),"downloadable"in g&&r(2,l=g.downloadable)},[s,o,l,f,b]}class ma extends Ce{constructor(n){super(),Se(this,n,ya,_a,Te,{gj:1,show:0,downloadable:2})}}function ba(i){let n,r,o,s,l;function f(w){i[6](w)}function b(w){i[7](w)}function g(w){i[8](w)}let m={source:"intersection-polygons",gj:i[1],layerStyle:i[5],interactive:!0,downloadable:i[2]};return i[3]!==void 0&&(m.hoveredFeature=i[3]),i[4]!==void 0&&(m.clickedFeature=i[4]),i[0]!==void 0&&(m.show=i[0]),n=new wt({props:m}),Ie.push(()=>Le(n,"hoveredFeature",f)),Ie.push(()=>Le(n,"clickedFeature",b)),Ie.push(()=>Le(n,"show",g)),{c(){Xe(n.$$.fragment)},m(w,O){Ze(n,w,O),l=!0},p(w,[O]){const y={};O&2&&(y.gj=w[1]),O&4&&(y.downloadable=w[2]),!r&&O&8&&(r=!0,y.hoveredFeature=w[3],xe(()=>r=!1)),!o&&O&16&&(o=!0,y.clickedFeature=w[4],xe(()=>o=!1)),!s&&O&1&&(s=!0,y.show=w[0],xe(()=>s=!1)),n.$set(y)},i(w){l||(oe(n.$$.fragment,w),l=!0)},o(w){ge(n.$$.fragment,w),l=!1},d(w){Ke(n,w)}}}function va(i,n,r){let o,s;Ee(i,Qt,y=>r(3,o=y)),Ee(i,_o,y=>r(4,s=y));let{gj:l}=n,{show:f}=n,{downloadable:b}=n,g={type:"fill",filter:["==",["get","type"],"intersection"],paint:{"fill-color":zn("intersection_kind",{Connection:"#666",Intersection:"#966",Terminus:"#999",MapEdge:"#696"},"#666"),"fill-opacity":Ar("hover",.9,.4)}};function m(y){o=y,Qt.set(o)}function w(y){s=y,_o.set(s)}function O(y){f=y,r(0,f)}return i.$$set=y=>{"gj"in y&&r(1,l=y.gj),"show"in y&&r(0,f=y.show),"downloadable"in y&&r(2,b=y.downloadable)},[f,l,b,o,s,g,m,w,O]}class wa extends Ce{constructor(n){super(),Se(this,n,va,ba,Te,{gj:1,show:0,downloadable:2})}}function Ea(i){let n,r,o;function s(f){i[4](f)}let l={source:"lane-markings",gj:i[1],layerStyle:i[3],downloadable:i[2]};return i[0]!==void 0&&(l.show=i[0]),n=new wt({props:l}),Ie.push(()=>Le(n,"show",s)),{c(){Xe(n.$$.fragment)},m(f,b){Ze(n,f,b),o=!0},p(f,[b]){const g={};b&2&&(g.gj=f[1]),b&4&&(g.downloadable=f[2]),!r&&b&1&&(r=!0,g.show=f[0],xe(()=>r=!1)),n.$set(g)},i(f){o||(oe(n.$$.fragment,f),o=!0)},o(f){ge(n.$$.fragment,f),o=!1},d(f){Ke(n,f)}}}function Ca(i,n,r){let{gj:o}=n,{show:s}=n,{downloadable:l}=n,f={type:"fill",paint:{"fill-color":zn("type",{"center line":"yellow","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};function b(g){s=g,r(0,s)}return i.$$set=g=>{"gj"in g&&r(1,o=g.gj),"show"in g&&r(0,s=g.show),"downloadable"in g&&r(2,l=g.downloadable)},[s,o,l,f,b]}class Sa extends Ce{constructor(n){super(),Se(this,n,Ca,Ea,Te,{gj:1,show:0,downloadable:2})}}function Ta(i){let n,r,o,s,l;function f(w){i[6](w)}function b(w){i[7](w)}function g(w){i[8](w)}let m={source:"lane-polygons",gj:i[1],layerStyle:i[5],interactive:!0,downloadable:i[2]};return i[3]!==void 0&&(m.clickedFeature=i[3]),i[4]!==void 0&&(m.hoveredFeature=i[4]),i[0]!==void 0&&(m.show=i[0]),n=new wt({props:m}),Ie.push(()=>Le(n,"clickedFeature",f)),Ie.push(()=>Le(n,"hoveredFeature",b)),Ie.push(()=>Le(n,"show",g)),{c(){Xe(n.$$.fragment)},m(w,O){Ze(n,w,O),l=!0},p(w,[O]){const y={};O&2&&(y.gj=w[1]),O&4&&(y.downloadable=w[2]),!r&&O&8&&(r=!0,y.clickedFeature=w[3],xe(()=>r=!1)),!o&&O&16&&(o=!0,y.hoveredFeature=w[4],xe(()=>o=!1)),!s&&O&1&&(s=!0,y.show=w[0],xe(()=>s=!1)),n.$set(y)},i(w){l||(oe(n.$$.fragment,w),l=!0)},o(w){ge(n.$$.fragment,w),l=!1},d(w){Ke(n,w)}}}function Oa(i,n,r){let o,s;Ee(i,go,y=>r(3,o=y)),Ee(i,Dn,y=>r(4,s=y));let{gj:l}=n,{show:f}=n,{downloadable:b}=n,g={type:"fill",paint:{"fill-color":zn("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":Ar("hover",.9,.4)}};function m(y){o=y,go.set(o)}function w(y){s=y,Dn.set(s)}function O(y){f=y,r(0,f)}return i.$$set=y=>{"gj"in y&&r(1,l=y.gj),"show"in y&&r(0,f=y.show),"downloadable"in y&&r(2,b=y.downloadable)},[f,l,b,o,s,g,m,w,O]}class Ia extends Ce{constructor(n){super(),Se(this,n,Oa,Ta,Te,{gj:1,show:0,downloadable:2})}}function Ka(i,n){return[{uuid:rt(),label:"Boundary",show:!0,content:ga,gj:n},{uuid:rt(),label:"Intersection polygons",show:!0,content:wa,gj:JSON.parse(i.toGeojsonPlain())},{uuid:rt(),label:"Intersection markings",show:!0,content:ma,gj:JSON.parse(i.toIntersectionMarkingsGeojson())},{uuid:rt(),label:"Lane polygons",show:!0,content:Ia,gj:JSON.parse(i.toLanePolygonsGeojson())},{uuid:rt(),label:"Lane markings",show:!0,content:Sa,gj:JSON.parse(i.toLaneMarkingsGeojson())}]}function Qa(i){return[{uuid:rt(),label:"Movement arrows",show:!0,content:la,gj:mt()},{uuid:rt(),label:"Roads connected to intersection",show:!0,content:sa,gj:mt()},{uuid:rt(),label:"Clockwise ordering of roads",show:!1,content:da,gj:mt()}]}async function $a(i,n,r){let o=i.detail;n={kind:"LoadingOverpass",polygon:o};try{let l=await(await fetch(La(o))).text();n={kind:"osm2streets import",boundaryPolygon:o,osmInput:l};let[f,b]=ka(o,l,r);n={kind:"done",boundaryGJ:b,network:f,osmInput:l}}catch(s){n={kind:"error",msg:s.toString()}}}function ka(i,n,r){let o={type:"Feature",geometry:i,properties:{}};return[new jt(n,JSON.stringify(o),r),o]}function La(i){let n='poly:"';for(let[o,s]of i.coordinates[0])n+=`${s} ${o} `;return n=n.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${n}); node(w)->.x; <;); out meta;`}`}function Ma(i){let n,r,o,s,l,f,b,g,m;return{c(){n=$("div"),r=Pt(`App:
  `),o=$("select"),s=$("option"),s.textContent="Street Explorer",l=$("option"),l.textContent="Lane editor",f=$("option"),f.textContent="Route profile tool",b=$("option"),b.textContent="Road width tool",s.__value="index.html",yt(s,s.__value),l.__value="lane_editor.html",yt(l,l.__value),f.__value="route_profile.html",yt(f,f.__value),b.__value="thicken_roads.html",yt(b,b.__value),i[0]===void 0&&Tr(()=>i[2].call(o))},m(w,O){pe(w,n,O),re(n,r),re(n,o),re(o,s),re(o,l),re(o,f),re(o,b),xn(o,i[0],!0),g||(m=[at(o,"change",i[2]),at(o,"change",i[1])],g=!0)},p(w,[O]){O&1&&xn(o,w[0])},i:Me,o:Me,d(w){w&&he(n),g=!1,Un(m)}}}function Fa(i,n,r){let o=window.location.pathname.split("/").pop()||"index.html",s=o;function l(){s!=o&&(window.location.href=s)}function f(){s=Or(this),r(0,s)}return[s,l,f]}class es extends Ce{constructor(n){super(),Se(this,n,Fa,Ma,Te,{})}}function br(i,n,r){const o=i.slice();return o[6]=n[r],o[7]=n,o[8]=r,o}function vr(i,n){let r,o,s,l=n[6].label+"",f,b,g,m,w,O,y,N,S;function x(){n[4].call(o,n[7],n[8])}function H(P){n[5](P,n[6])}var X=n[6].content;function J(P){let q={gj:P[6].gj,downloadable:!0};return P[6].show!==void 0&&(q.show=P[6].show),{props:q}}return X&&(g=pr(X,J(n)),Ie.push(()=>Le(g,"show",H))),{key:i,first:null,c(){r=$("label"),o=$("input"),s=Ft(),f=Pt(l),b=Ft(),g&&Xe(g.$$.fragment),w=Ft(),O=$("br"),At(o,"type","checkbox"),this.first=r},m(P,q){pe(P,r,q),re(r,o),o.checked=n[6].show,re(r,s),re(r,f),re(r,b),g&&Ze(g,r,null),pe(P,w,q),pe(P,O,q),y=!0,N||(S=at(o,"change",x),N=!0)},p(P,q){n=P,q&1&&(o.checked=n[6].show),(!y||q&1)&&l!==(l=n[6].label+"")&&bo(f,l);const j={};if(q&1&&(j.gj=n[6].gj),!m&&q&1&&(m=!0,j.show=n[6].show,xe(()=>m=!1)),q&1&&X!==(X=n[6].content)){if(g){$t();const me=g;ge(me.$$.fragment,1,0,()=>{Ke(me,1)}),en()}X?(g=pr(X,J(n)),Ie.push(()=>Le(g,"show",H)),Xe(g.$$.fragment),oe(g.$$.fragment,1),Ze(g,r,null)):g=null}else X&&g.$set(j)},i(P){y||(g&&oe(g.$$.fragment,P),y=!0)},o(P){g&&ge(g.$$.fragment,P),y=!1},d(P){P&&(he(r),he(w),he(O)),g&&Ke(g),N=!1,S()}}}function wr(i){let n;return{c(){n=$("hr")},m(r,o){pe(r,n,o)},d(r){r&&he(n)}}}function Na(i){let n,r=[],o=new Map,s,l,f,b=Rn(i[0]);const g=y=>y[6].uuid;for(let y=0;y<b.length;y+=1){let N=br(i,b,y),S=g(N);o.set(S,r[y]=vr(S,N))}let m=i[0].length&&wr();const w=i[3].default,O=Ir(w,i,i[2],null);return{c(){n=$("div");for(let y=0;y<r.length;y+=1)r[y].c();s=Ft(),m&&m.c(),l=Ft(),O&&O.c(),At(n,"class","svelte-eycl9h"),dr(n,"display",i[1]?"block":"none")},m(y,N){pe(y,n,N);for(let S=0;S<r.length;S+=1)r[S]&&r[S].m(n,null);re(n,s),m&&m.m(n,null),re(n,l),O&&O.m(n,null),f=!0},p(y,[N]){N&1&&(b=Rn(y[0]),$t(),r=Vi(r,N,g,1,y,b,o,n,Bi,vr,s,br),en()),y[0].length?m||(m=wr(),m.c(),m.m(n,l)):m&&(m.d(1),m=null),O&&O.p&&(!f||N&4)&&kr(O,w,y,y[2],f?Mr(w,y[2],N,null):Lr(y[2]),null),N&2&&dr(n,"display",y[1]?"block":"none")},i(y){if(!f){for(let N=0;N<b.length;N+=1)oe(r[N]);oe(O,y),f=!0}},o(y){for(let N=0;N<r.length;N+=1)ge(r[N]);ge(O,y),f=!1},d(y){y&&he(n);for(let N=0;N<r.length;N+=1)r[N].d();m&&m.d(),O&&O.d(y)}}}function Aa(i,n,r){let{$$slots:o={},$$scope:s}=n,{layers:l}=n,{showControls:f=!0}=n;function b(m,w){m[w].show=this.checked,r(0,l)}function g(m,w){i.$$.not_equal(w.show,m)&&(w.show=m,r(0,l))}return i.$$set=m=>{"layers"in m&&r(0,l=m.layers),"showControls"in m&&r(1,f=m.showControls),"$$scope"in m&&r(2,s=m.$$scope)},[l,f,s,o,b,g]}class ts extends Ce{constructor(n){super(),Se(this,n,Aa,Na,Te,{layers:0,showControls:1})}}function Er(i){let n;const r=i[3].default,o=Ir(r,i,i[2],null);return{c(){o&&o.c()},m(s,l){o&&o.m(s,l),n=!0},p(s,l){o&&o.p&&(!n||l&4)&&kr(o,r,s,s[2],n?Mr(r,s[2],l,null):Lr(s[2]),null)},i(s){n||(oe(o,s),n=!0)},o(s){ge(o,s),n=!1},d(s){o&&o.d(s)}}}function Pa(i){let n,r,o=i[1]&&Er(i);return{c(){n=$("div"),o&&o.c(),At(n,"class","map svelte-12dpf1u")},m(s,l){pe(s,n,l),o&&o.m(n,null),i[4](n),r=!0},p(s,[l]){s[1]?o?(o.p(s,l),l&2&&oe(o,1)):(o=Er(s),o.c(),oe(o,1),o.m(n,null)):o&&($t(),ge(o,1,1,()=>{o=null}),en())},i(s){r||(oe(o),r=!0)},o(s){ge(o),r=!1},d(s){s&&he(n),o&&o.d(),i[4](null)}}}function ja(i,n,r){let{$$slots:o={},$$scope:s}=n,l,f,b=!1;Bn(()=>{l=new An.Map({container:f,style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo",hash:!0}),l.addControl(new An.ScaleControl({})),l.addControl(new An.NavigationControl({}),"bottom-right"),l.on("load",()=>{r(1,b=!0),vt.set(l)}),new ResizeObserver(()=>{l.resize()}).observe(f)}),mo(()=>{l.remove()});function g(m){Ie[m?"unshift":"push"](()=>{f=m,r(0,f)})}return i.$$set=m=>{"$$scope"in m&&r(2,s=m.$$scope)},[f,b,s,o,g]}class ns extends Ce{constructor(n){super(),Se(this,n,ja,Pa,Te,{})}}function Cr(i,n,r){const o=i.slice();return o[7]=n[r],o}function Sr(i){let n,r=i[7]+"",o,s;return{c(){n=$("option"),o=Pt(r),n.__value=s=i[7],yt(n,n.__value)},m(l,f){pe(l,n,f),re(n,o)},p(l,f){f&2&&r!==(r=l[7]+"")&&bo(o,r),f&2&&s!==(s=l[7])&&(n.__value=s,yt(n,n.__value))},d(l){l&&he(n)}}}function xa(i){let n,r,o,s,l,f,b=Rn(i[1]),g=[];for(let m=0;m<b.length;m+=1)g[m]=Sr(Cr(i,b,m));return{c(){n=$("div"),r=Pt(`Test case:
  `),o=$("select"),s=$("option"),s.textContent="None";for(let m=0;m<g.length;m+=1)g[m].c();s.__value="none",yt(s,s.__value),i[0]===void 0&&Tr(()=>i[5].call(o))},m(m,w){pe(m,n,w),re(n,r),re(n,o),re(o,s);for(let O=0;O<g.length;O+=1)g[O]&&g[O].m(o,null);xn(o,i[0],!0),l||(f=[at(o,"change",i[5]),at(o,"change",i[2])],l=!0)},p(m,[w]){if(w&2){b=Rn(m[1]);let O;for(O=0;O<b.length;O+=1){const y=Cr(m,b,O);g[O]?g[O].p(y,w):(g[O]=Sr(y),g[O].c(),g[O].m(o,null))}for(;O<g.length;O+=1)g[O].d(1);g.length=b.length}w&3&&xn(o,m[0])},i:Me,o:Me,d(m){m&&he(n),Di(g,m),l=!1,Un(f)}}}function Ra(i,n,r){let{imported:o}=n,{settings:s}=n,l="none",f=[];Bn(async()=>{let w=await fetch("/osm2svelte/tests.json");r(1,f=await w.json())});async function b(){if(l!="none")try{let y=(await(await fetch(`/osm2svelte/tests/${l}/boundary.json`)).json()).features[0],S=await(await fetch(`/osm2svelte/tests/${l}/input.osm`)).text(),x=g(y,S);r(3,o={kind:"done",boundaryGJ:y,network:x,osmInput:S})}catch(w){r(3,o={kind:"error",msg:w.toString()})}}function g(w,O){return new jt(O,JSON.stringify(w),s)}function m(){l=Or(this),r(0,l),r(1,f)}return i.$$set=w=>{"imported"in w&&r(3,o=w.imported),"settings"in w&&r(4,s=w.settings)},[l,f,b,o,s,m]}class os extends Ce{constructor(n){super(),Se(this,n,Ra,xa,Te,{imported:3,settings:4})}}function Da(i){let n,r,o,s,l,f;return{c(){n=$("div"),r=$("button"),r.textContent="Download osm.xml",o=Ft(),s=$("button"),s.textContent="Reset view",At(r,"type","button"),At(s,"type","button")},m(b,g){pe(b,n,g),re(n,r),re(n,o),re(n,s),l||(f=[at(r,"click",i[1]),at(s,"click",i[2])],l=!0)},p:Me,d(b){b&&he(n),l=!1,Un(f)}}}function Ua(i){let n;return{c(){n=$("p"),n.textContent="Importing with osm2streets..."},m(r,o){pe(r,n,o)},p:Me,d(r){r&&he(n)}}}function Ga(i){let n,r,o=i[0].msg+"",s;return{c(){n=$("p"),r=Pt("Error: "),s=Pt(o)},m(l,f){pe(l,n,f),re(n,r),re(n,s)},p(l,f){f&1&&o!==(o=l[0].msg+"")&&bo(s,o)},d(l){l&&he(n)}}}function Ba(i){let n;return{c(){n=$("p"),n.textContent="Loading from Overpass..."},m(r,o){pe(r,n,o)},p:Me,d(r){r&&he(n)}}}function Va(i){let n;return{c(){n=$("p"),n.textContent="Use the polygon tool to select an area to import"},m(r,o){pe(r,n,o)},p:Me,d(r){r&&he(n)}}}function Ja(i){let n;function r(l,f){if(l[0].kind==="nothing")return Va;if(l[0].kind==="LoadingOverpass")return Ba;if(l[0].kind==="error")return Ga;if(l[0].kind==="osm2streets import")return Ua;if(l[0].kind==="done")return Da}let o=r(i),s=o&&o(i);return{c(){s&&s.c(),n=Gn()},m(l,f){s&&s.m(l,f),pe(l,n,f)},p(l,[f]){o===(o=r(l))&&s?s.p(l,f):(s&&s.d(1),s=o&&o(l),s&&(s.c(),s.m(n.parentNode,n)))},i:Me,o:Me,d(l){l&&he(n),s&&s.d(l)}}}function za(i,n,r){let o;Ee(i,vt,b=>r(3,o=b));let{imported:s}=n;function l(){s.kind==="done"&&jr("osm.xml",s.osmInput)}function f(){s.kind==="done"&&o.fitBounds(Pr(s.boundaryGJ),{animate:!1,padding:10})}return i.$$set=b=>{"imported"in b&&r(0,s=b.imported)},[s,l,f]}class rs extends Ce{constructor(n){super(),Se(this,n,za,Ja,Te,{imported:0})}}var xr={exports:{}};(function(i,n){(function(r,o){i.exports=o()})(qt,function(){var r=function(e,t){var a={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},u={on:function(d,p,E){if(a[d]===void 0)throw new Error("Invalid event type: "+d);a[d].push({selector:p,fn:E})},render:function(d){t.store.featureChanged(d)}},c=function(d,p){for(var E=a[d],T=E.length;T--;){var M=E[T];if(M.selector(p)){M.fn.call(u,p)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(u),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(d){c("drag",d)},click:function(d){c("click",d)},mousemove:function(d){c("mousemove",d)},mousedown:function(d){c("mousedown",d)},mouseup:function(d){c("mouseup",d)},mouseout:function(d){c("mouseout",d)},keydown:function(d){c("keydown",d)},keyup:function(d){c("keyup",d)},touchstart:function(d){c("touchstart",d)},touchmove:function(d){c("touchmove",d)},touchend:function(d){c("touchend",d)},tap:function(d){c("tap",d)}}};function o(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var a=function u(){if(this instanceof u){var c=[null];c.push.apply(c,arguments);var d=Function.bind.apply(t,c);return new d}return t.apply(this,arguments)};a.prototype=t.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(e).forEach(function(u){var c=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(a,u,c.get?c:{enumerable:!0,get:function(){return e[u]}})}),a}var s={},l={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},f=l;function b(e){var t=0;if(e&&e.length>0){t+=Math.abs(g(e[0]));for(var a=1;a<e.length;a++)t-=Math.abs(g(e[a]))}return t}function g(e){var t,a,u,c,d,p,E=0,T=e.length;if(T>2){for(p=0;p<T;p++)p===T-2?(u=T-2,c=T-1,d=0):p===T-1?(u=T-1,c=0,d=1):(u=p,c=p+1,d=p+2),t=e[u],a=e[c],E+=(m(e[d][0])-m(t[0]))*Math.sin(m(a[1]));E=E*f.RADIUS*f.RADIUS/2}return E}function m(e){return e*Math.PI/180}s.geometry=function e(t){var a,u=0;switch(t.type){case"Polygon":return b(t.coordinates);case"MultiPolygon":for(a=0;a<t.coordinates.length;a++)u+=b(t.coordinates[a]);return u;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(a=0;a<t.geometries.length;a++)u+=e(t.geometries[a]);return u}},s.ring=g;var w={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},O={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},y={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},N={POLYGON:"polygon",LINE:"line_string",POINT:"point"},S={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},x={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},H={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},X={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},J={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},P={ACTIVE:"true",INACTIVE:"false"},q=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],j=-85,me=Object.freeze({__proto__:null,classes:w,sources:O,cursors:y,types:N,geojsonTypes:S,modes:x,events:H,updateActions:X,meta:J,activeStates:P,interactions:q,LAT_MIN:-90,LAT_RENDERED_MIN:j,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ee={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Fe(e,t){var a=ee[e.geometry.type]-ee[t.geometry.type];return a===0&&e.geometry.type===S.POLYGON?e.area-t.area:a}function ke(e){return e.map(function(t){return t.geometry.type===S.POLYGON&&(t.area=s.geometry({type:S.FEATURE,property:{},geometry:t.geometry})),t}).sort(Fe).map(function(t){return delete t.area,t})}function st(e,t){return t===void 0&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function Ne(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,a=e.length;t<a;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}Ne.prototype.add=function(e){return this.has(e)||(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length),this},Ne.prototype.delete=function(e){return this.has(e)===!1||(this._length--,delete this._items[e],delete this._nums[e]),this},Ne.prototype.has=function(e){return(typeof e=="string"||typeof e=="number")&&(this._items[e]!==void 0||this._nums[e]!==void 0)},Ne.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach(function(a){t.push({k:a,v:e._items[a]})}),Object.keys(this._nums).forEach(function(a){t.push({k:JSON.parse(a),v:e._nums[a]})}),t.sort(function(a,u){return a.v-u.v}).map(function(a){return a.k})},Ne.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Rr=[J.FEATURE,J.MIDPOINT,J.VERTEX],Et={click:function(e,t,a){return wo(e,t,a,a.options.clickBuffer)},touch:function(e,t,a){return wo(e,t,a,a.options.touchBuffer)}};function wo(e,t,a,u){if(a.map===null)return[];var c=e?st(e,u):t,d={};a.options.styles&&(d.layers=a.options.styles.map(function(M){return M.id}));var p=a.map.queryRenderedFeatures(c,d).filter(function(M){return Rr.indexOf(M.properties.meta)!==-1}),E=new Ne,T=[];return p.forEach(function(M){var L=M.properties.id;E.has(L)||(E.add(L),T.push(M))}),ke(T)}function tn(e,t){var a=Et.click(e,null,t),u={mouse:y.NONE};return a[0]&&(u.mouse=a[0].properties.active===P.ACTIVE?y.MOVE:y.POINTER,u.feature=a[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(u.mouse=y.ADD),t.ui.queueMapClasses(u),t.ui.updateMapClasses(),a[0]}function Wn(e,t){var a=e.x-t.x,u=e.y-t.y;return Math.sqrt(a*a+u*u)}function qn(e,t,a){a===void 0&&(a={});var u=a.fineTolerance!=null?a.fineTolerance:4,c=a.grossTolerance!=null?a.grossTolerance:12,d=a.interval!=null?a.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var p=Wn(e.point,t.point);return p<u||p<c&&t.time-e.time<d}function Yn(e,t,a){a===void 0&&(a={});var u=a.tolerance!=null?a.tolerance:25,c=a.interval!=null?a.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,Wn(e.point,t.point)<u&&t.time-e.time<c}var xt={},Hn={get exports(){return xt},set exports(e){xt=e}}.exports=function(e,t){if(t||(t=16),e===void 0&&(e=128),e<=0)return"0";for(var a=Math.log(Math.pow(2,e))/Math.log(t),u=2;a===1/0;u*=2)a=Math.log(Math.pow(2,e/u))/Math.log(t)*u;var c=a-Math.floor(a),d="";for(u=0;u<Math.floor(a);u++)d=Math.floor(Math.random()*t).toString(t)+d;if(c){var p=Math.pow(t,c);d=Math.floor(Math.random()*p).toString(t)+d}var E=parseInt(d,t);return E!==1/0&&E>=Math.pow(2,e)?Hn(e,t):d};Hn.rack=function(e,t,a){var u=function(d){var p=0;do{if(p++>10){if(!a)throw new Error("too many ID collisions, use more bits");e+=a}var E=Hn(e,t)}while(Object.hasOwnProperty.call(c,E));return c[E]=d,E},c=u.hats={};return u.get=function(d){return u.hats[d]},u.set=function(d,p){return u.hats[d]=p,u},u.bits=e||128,u.base=t||16,u};var be=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||xt(),this.type=t.geometry.type};be.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},be.prototype.incomingCoords=function(e){this.setCoordinates(e)},be.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},be.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},be.prototype.setProperty=function(e,t){this.properties[e]=t},be.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:S.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},be.prototype.internal=function(e){var t={id:this.id,meta:J.FEATURE,"meta:type":this.type,active:P.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var a in this.properties)t["user_"+a]=this.properties[a];return{type:S.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var ut=function(e,t){be.call(this,e,t)};(ut.prototype=Object.create(be.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},ut.prototype.updateCoordinate=function(e,t,a){this.coordinates=arguments.length===3?[t,a]:[e,t],this.changed()},ut.prototype.getCoordinate=function(){return this.getCoordinates()};var Ve=function(e,t){be.call(this,e,t)};(Ve.prototype=Object.create(be.prototype)).isValid=function(){return this.coordinates.length>1},Ve.prototype.addCoordinate=function(e,t,a){this.changed();var u=parseInt(e,10);this.coordinates.splice(u,0,[t,a])},Ve.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},Ve.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},Ve.prototype.updateCoordinate=function(e,t,a){var u=parseInt(e,10);this.coordinates[u]=[t,a],this.changed()};var Ae=function(e,t){be.call(this,e,t),this.coordinates=this.coordinates.map(function(a){return a.slice(0,-1)})};(Ae.prototype=Object.create(be.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(e){return e.length>2})},Ae.prototype.incomingCoords=function(e){this.coordinates=e.map(function(t){return t.slice(0,-1)}),this.changed()},Ae.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},Ae.prototype.addCoordinate=function(e,t,a){this.changed();var u=e.split(".").map(function(c){return parseInt(c,10)});this.coordinates[u[0]].splice(u[1],0,[t,a])},Ae.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map(function(u){return parseInt(u,10)}),a=this.coordinates[t[0]];a&&(a.splice(t[1],1),a.length<3&&this.coordinates.splice(t[0],1))},Ae.prototype.getCoordinate=function(e){var t=e.split(".").map(function(u){return parseInt(u,10)}),a=this.coordinates[t[0]];return JSON.parse(JSON.stringify(a[t[1]]))},Ae.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},Ae.prototype.updateCoordinate=function(e,t,a){this.changed();var u=e.split("."),c=parseInt(u[0],10),d=parseInt(u[1],10);this.coordinates[c]===void 0&&(this.coordinates[c]=[]),this.coordinates[c][d]=[t,a]};var Dr={MultiPoint:ut,MultiLineString:Ve,MultiPolygon:Ae},nn=function(e,t,a,u,c){var d=a.split("."),p=parseInt(d[0],10),E=d[1]?d.slice(1).join("."):null;return e[p][t](E,u,c)},Oe=function(e,t){if(be.call(this,e,t),delete this.coordinates,this.model=Dr[t.geometry.type],this.model===void 0)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function G(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(Oe.prototype=Object.create(be.prototype))._coordinatesToFeatures=function(e){var t=this,a=this.model.bind(this);return e.map(function(u){return new a(t.ctx,{id:xt(),type:S.FEATURE,properties:{},geometry:{coordinates:u,type:t.type.replace("Multi","")}})})},Oe.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},Oe.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},Oe.prototype.getCoordinate=function(e){return nn(this.features,"getCoordinate",e)},Oe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===S.POLYGON?e.getCoordinates():e.coordinates})))},Oe.prototype.updateCoordinate=function(e,t,a){nn(this.features,"updateCoordinate",e,t,a),this.changed()},Oe.prototype.addCoordinate=function(e,t,a){nn(this.features,"addCoordinate",e,t,a),this.changed()},Oe.prototype.removeCoordinate=function(e){nn(this.features,"removeCoordinate",e),this.changed()},Oe.prototype.getFeatures=function(){return this.features},G.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},G.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(a,u){return a[u.feature_id]===void 0&&(a[u.feature_id]=!0,t._ctx.store.get(u.feature_id).changed()),a},{})},G.prototype.getSelected=function(){return this._ctx.store.getSelected()},G.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},G.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},G.prototype.getFeature=function(e){return this._ctx.store.get(e)},G.prototype.select=function(e){return this._ctx.store.select(e)},G.prototype.deselect=function(e){return this._ctx.store.deselect(e)},G.prototype.deleteFeature=function(e,t){return t===void 0&&(t={}),this._ctx.store.delete(e,t)},G.prototype.addFeature=function(e){return this._ctx.store.add(e)},G.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},G.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},G.prototype.setActionableState=function(e){e===void 0&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},G.prototype.changeMode=function(e,t,a){return t===void 0&&(t={}),a===void 0&&(a={}),this._ctx.events.changeMode(e,t,a)},G.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},G.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},G.prototype.featuresAt=function(e,t,a){if(a===void 0&&(a="click"),a!=="click"&&a!=="touch")throw new Error("invalid buffer type");return Et[a](e,t,this._ctx)},G.prototype.newFeature=function(e){var t=e.geometry.type;return t===S.POINT?new ut(this._ctx,e):t===S.LINE_STRING?new Ve(this._ctx,e):t===S.POLYGON?new Ae(this._ctx,e):new Oe(this._ctx,e)},G.prototype.isInstanceOf=function(e,t){if(e===S.POINT)return t instanceof ut;if(e===S.LINE_STRING)return t instanceof Ve;if(e===S.POLYGON)return t instanceof Ae;if(e==="MultiFeature")return t instanceof Oe;throw new Error("Unknown feature class: "+e)},G.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},G.prototype.onSetup=function(){},G.prototype.onDrag=function(){},G.prototype.onClick=function(){},G.prototype.onMouseMove=function(){},G.prototype.onMouseDown=function(){},G.prototype.onMouseUp=function(){},G.prototype.onMouseOut=function(){},G.prototype.onKeyUp=function(){},G.prototype.onKeyDown=function(){},G.prototype.onTouchStart=function(){},G.prototype.onTouchMove=function(){},G.prototype.onTouchEnd=function(){},G.prototype.onTap=function(){},G.prototype.onStop=function(){},G.prototype.onTrash=function(){},G.prototype.onCombineFeature=function(){},G.prototype.onUncombineFeature=function(){},G.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Eo={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Ur=Object.keys(Eo);function Gr(e){var t=Object.keys(e);return function(a,u){u===void 0&&(u={});var c={},d=t.reduce(function(p,E){return p[E]=e[E],p},new G(a));return{start:function(){var p=this;c=d.onSetup(u),Ur.forEach(function(E){var T,M=Eo[E],L=function(){return!1};e[M]&&(L=function(){return!0}),p.on(E,L,(T=M,function(I){return d[T](c,I)}))})},stop:function(){d.onStop(c)},trash:function(){d.onTrash(c)},combineFeatures:function(){d.onCombineFeatures(c)},uncombineFeatures:function(){d.onUncombineFeatures(c)},render:function(p,E){d.toDisplayFeatures(c,p,E)}}}}function Rt(e){return[].concat(e).filter(function(t){return t!==void 0})}function Br(){var e=this;if(!(e.ctx.map&&e.ctx.map.getSource(O.HOT)!==void 0))return T();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var a=[],u=[];e.isDirty?u=e.getAllIds():(a=e.getChangedIds().filter(function(M){return e.get(M)!==void 0}),u=e.sources.hot.filter(function(M){return M.properties.id&&a.indexOf(M.properties.id)===-1&&e.get(M.properties.id)!==void 0}).map(function(M){return M.properties.id})),e.sources.hot=[];var c=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(M){var L=M.properties.id||M.properties.parent;return a.indexOf(L)===-1});var d=c!==e.sources.cold.length||u.length>0;function p(M,L){var I=e.get(M).internal(t);e.ctx.events.currentModeRender(I,function(R){e.sources[L].push(R)})}if(a.forEach(function(M){return p(M,"hot")}),u.forEach(function(M){return p(M,"cold")}),d&&e.ctx.map.getSource(O.COLD).setData({type:S.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(O.HOT).setData({type:S.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(H.SELECTION_CHANGE,{features:e.getSelected().map(function(M){return M.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(M){return{type:S.FEATURE,properties:{},geometry:{type:S.POINT,coordinates:M.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var E=e._deletedFeaturesToEmit.map(function(M){return M.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(H.DELETE,{features:E})}function T(){e.isDirty=!1,e.clearChangedIds()}T(),e.ctx.map.fire(H.RENDER,{})}function Z(e){var t,a=this;this._features={},this._featureIds=new Ne,this._selectedFeatureIds=new Ne,this._selectedCoordinates=[],this._changedFeatureIds=new Ne,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame(function(){t=null,Br.call(a)}))},this.isDirty=!1}function Co(e,t){var a=e._selectedCoordinates.filter(function(u){return e._selectedFeatureIds.has(u.feature_id)});e._selectedCoordinates.length===a.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=a}Z.prototype.createRenderBatch=function(){var e=this,t=this.render,a=0;return this.render=function(){a++},function(){e.render=t,a>0&&e.render()}},Z.prototype.setDirty=function(){return this.isDirty=!0,this},Z.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},Z.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Z.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Z.prototype.getAllIds=function(){return this._featureIds.values()},Z.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},Z.prototype.delete=function(e,t){var a=this;return t===void 0&&(t={}),Rt(e).forEach(function(u){a._featureIds.has(u)&&(a._featureIds.delete(u),a._selectedFeatureIds.delete(u),t.silent||a._deletedFeaturesToEmit.indexOf(a._features[u])===-1&&a._deletedFeaturesToEmit.push(a._features[u]),delete a._features[u],a.isDirty=!0)}),Co(this,t),this},Z.prototype.get=function(e){return this._features[e]},Z.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},Z.prototype.select=function(e,t){var a=this;return t===void 0&&(t={}),Rt(e).forEach(function(u){a._selectedFeatureIds.has(u)||(a._selectedFeatureIds.add(u),a._changedFeatureIds.add(u),t.silent||(a._emitSelectionChange=!0))}),this},Z.prototype.deselect=function(e,t){var a=this;return t===void 0&&(t={}),Rt(e).forEach(function(u){a._selectedFeatureIds.has(u)&&(a._selectedFeatureIds.delete(u),a._changedFeatureIds.add(u),t.silent||(a._emitSelectionChange=!0))}),Co(this,t),this},Z.prototype.clearSelected=function(e){return e===void 0&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},Z.prototype.setSelected=function(e,t){var a=this;return t===void 0&&(t={}),e=Rt(e),this.deselect(this._selectedFeatureIds.values().filter(function(u){return e.indexOf(u)===-1}),{silent:t.silent}),this.select(e.filter(function(u){return!a._selectedFeatureIds.has(u)}),{silent:t.silent}),this},Z.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},Z.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Z.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Z.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},Z.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},Z.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},Z.prototype.setFeatureProperty=function(e,t,a){this.get(e).setProperty(t,a),this.featureChanged(e)},Z.prototype.storeMapConfig=function(){var e=this;q.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},Z.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},Z.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]===void 0||this._mapInitialConfig[e]};var Qe=function(){for(var e=arguments,t={},a=0;a<arguments.length;a++){var u=e[a];for(var c in u)Vr.call(u,c)&&(t[c]=u[c])}return t},Vr=Object.prototype.hasOwnProperty,Jr=["mode","feature","mouse"];function zr(e){var t=null,a=null,u={onRemove:function(){return e.map.off("load",u.connect),clearInterval(a),u.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",u.connect),clearInterval(a),u.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(c){var d=c.fire;return c.fire=function(p,E){var T=arguments;return d.length===1&&arguments.length!==1&&(T=[Qe({},{type:p},E)]),d.apply(c,T)},e.map=c,e.events=function(p){var E=Object.keys(p.options.modes).reduce(function(v,F){return v[F]=Gr(p.options.modes[F]),v},{}),T={},M={},L={},I=null,R=null;L.drag=function(v,F){F({point:v.point,time:new Date().getTime()})?(p.ui.queueMapClasses({mouse:y.DRAG}),R.drag(v)):v.originalEvent.stopPropagation()},L.mousedrag=function(v){L.drag(v,function(F){return!qn(T,F)})},L.touchdrag=function(v){L.drag(v,function(F){return!Yn(M,F)})},L.mousemove=function(v){if((v.originalEvent.buttons!==void 0?v.originalEvent.buttons:v.originalEvent.which)===1)return L.mousedrag(v);var F=tn(v,p);v.featureTarget=F,R.mousemove(v)},L.mousedown=function(v){T={time:new Date().getTime(),point:v.point};var F=tn(v,p);v.featureTarget=F,R.mousedown(v)},L.mouseup=function(v){var F=tn(v,p);v.featureTarget=F,qn(T,{point:v.point,time:new Date().getTime()})?R.click(v):R.mouseup(v)},L.mouseout=function(v){R.mouseout(v)},L.touchstart=function(v){if(v.originalEvent.preventDefault(),p.options.touchEnabled){M={time:new Date().getTime(),point:v.point};var F=Et.touch(v,null,p)[0];v.featureTarget=F,R.touchstart(v)}},L.touchmove=function(v){if(v.originalEvent.preventDefault(),p.options.touchEnabled)return R.touchmove(v),L.touchdrag(v)},L.touchend=function(v){if(v.originalEvent.preventDefault(),p.options.touchEnabled){var F=Et.touch(v,null,p)[0];v.featureTarget=F,Yn(M,{time:new Date().getTime(),point:v.point})?R.tap(v):R.touchend(v)}};var te=function(v){return!(v===8||v===46||v>=48&&v<=57)};function D(v,F,z){z===void 0&&(z={}),R.stop();var _e=E[v];if(_e===void 0)throw new Error(v+" is not valid");I=v;var ae=_e(p,F);R=r(ae,p),z.silent||p.map.fire(H.MODE_CHANGE,{mode:v}),p.store.setDirty(),p.store.render()}L.keydown=function(v){(v.srcElement||v.target).classList[0]==="mapboxgl-canvas"&&(v.keyCode!==8&&v.keyCode!==46||!p.options.controls.trash?te(v.keyCode)?R.keydown(v):v.keyCode===49&&p.options.controls.point?D(x.DRAW_POINT):v.keyCode===50&&p.options.controls.line_string?D(x.DRAW_LINE_STRING):v.keyCode===51&&p.options.controls.polygon&&D(x.DRAW_POLYGON):(v.preventDefault(),R.trash()))},L.keyup=function(v){te(v.keyCode)&&R.keyup(v)},L.zoomend=function(){p.store.changeZoom()},L.data=function(v){if(v.dataType==="style"){var F=p.setup,z=p.map,_e=p.options,ae=p.store;_e.styles.some(function(to){return z.getLayer(to.id)})||(F.addLayers(),ae.setDirty(),ae.render())}};var ie={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){I=p.options.defaultMode,R=r(E[I](p),p)},changeMode:D,actionable:function(v){var F=!1;Object.keys(v).forEach(function(z){if(ie[z]===void 0)throw new Error("Invalid action type");ie[z]!==v[z]&&(F=!0),ie[z]=v[z]}),F&&p.map.fire(H.ACTIONABLE,{actions:ie})},currentModeName:function(){return I},currentModeRender:function(v,F){return R.render(v,F)},fire:function(v,F){L[v]&&L[v](F)},addEventListeners:function(){p.map.on("mousemove",L.mousemove),p.map.on("mousedown",L.mousedown),p.map.on("mouseup",L.mouseup),p.map.on("data",L.data),p.map.on("touchmove",L.touchmove),p.map.on("touchstart",L.touchstart),p.map.on("touchend",L.touchend),p.container.addEventListener("mouseout",L.mouseout),p.options.keybindings&&(p.container.addEventListener("keydown",L.keydown),p.container.addEventListener("keyup",L.keyup))},removeEventListeners:function(){p.map.off("mousemove",L.mousemove),p.map.off("mousedown",L.mousedown),p.map.off("mouseup",L.mouseup),p.map.off("data",L.data),p.map.off("touchmove",L.touchmove),p.map.off("touchstart",L.touchstart),p.map.off("touchend",L.touchend),p.container.removeEventListener("mouseout",L.mouseout),p.options.keybindings&&(p.container.removeEventListener("keydown",L.keydown),p.container.removeEventListener("keyup",L.keyup))},trash:function(v){R.trash(v)},combineFeatures:function(){R.combineFeatures()},uncombineFeatures:function(){R.uncombineFeatures()},getMode:function(){return I}}}(e),e.ui=function(p){var E={},T=null,M={mode:null,feature:null,mouse:null},L={mode:null,feature:null,mouse:null};function I(v){L=Qe(L,v)}function R(){var v,F;if(p.container){var z=[],_e=[];Jr.forEach(function(ae){L[ae]!==M[ae]&&(z.push(ae+"-"+M[ae]),L[ae]!==null&&_e.push(ae+"-"+L[ae]))}),z.length>0&&(v=p.container.classList).remove.apply(v,z),_e.length>0&&(F=p.container.classList).add.apply(F,_e),M=Qe(M,L)}}function te(v,F){F===void 0&&(F={});var z=document.createElement("button");return z.className=w.CONTROL_BUTTON+" "+F.className,z.setAttribute("title",F.title),F.container.appendChild(z),z.addEventListener("click",function(_e){if(_e.preventDefault(),_e.stopPropagation(),_e.target===T)return D(),void F.onDeactivate();ie(v),F.onActivate()},!0),z}function D(){T&&(T.classList.remove(w.ACTIVE_BUTTON),T=null)}function ie(v){D();var F=E[v];F&&F&&v!=="trash"&&(F.classList.add(w.ACTIVE_BUTTON),T=F)}return{setActiveButton:ie,queueMapClasses:I,updateMapClasses:R,clearMapClasses:function(){I({mode:null,feature:null,mouse:null}),R()},addButtons:function(){var v=p.options.controls,F=document.createElement("div");return F.className=w.CONTROL_GROUP+" "+w.CONTROL_BASE,v&&(v[N.LINE]&&(E[N.LINE]=te(N.LINE,{container:F,className:w.CONTROL_BUTTON_LINE,title:"LineString tool "+(p.options.keybindings?"(l)":""),onActivate:function(){return p.events.changeMode(x.DRAW_LINE_STRING)},onDeactivate:function(){return p.events.trash()}})),v[N.POLYGON]&&(E[N.POLYGON]=te(N.POLYGON,{container:F,className:w.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(p.options.keybindings?"(p)":""),onActivate:function(){return p.events.changeMode(x.DRAW_POLYGON)},onDeactivate:function(){return p.events.trash()}})),v[N.POINT]&&(E[N.POINT]=te(N.POINT,{container:F,className:w.CONTROL_BUTTON_POINT,title:"Marker tool "+(p.options.keybindings?"(m)":""),onActivate:function(){return p.events.changeMode(x.DRAW_POINT)},onDeactivate:function(){return p.events.trash()}})),v.trash&&(E.trash=te("trash",{container:F,className:w.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){p.events.trash()}})),v.combine_features&&(E.combine_features=te("combineFeatures",{container:F,className:w.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){p.events.combineFeatures()}})),v.uncombine_features&&(E.uncombine_features=te("uncombineFeatures",{container:F,className:w.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){p.events.uncombineFeatures()}}))),F},removeButtons:function(){Object.keys(E).forEach(function(v){var F=E[v];F.parentNode&&F.parentNode.removeChild(F),delete E[v]})}}}(e),e.container=c.getContainer(),e.store=new Z(e),t=e.ui.addButtons(),e.options.boxSelect&&(c.boxZoom.disable(),c.dragPan.disable(),c.dragPan.enable()),c.loaded()?u.connect():(c.on("load",u.connect),a=setInterval(function(){c.loaded()&&u.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(O.COLD,{data:{type:S.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(O.HOT,{data:{type:S.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(function(c){e.map.addLayer(c)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(function(c){e.map.getLayer(c.id)&&e.map.removeLayer(c.id)}),e.map.getSource(O.COLD)&&e.map.removeSource(O.COLD),e.map.getSource(O.HOT)&&e.map.removeSource(O.HOT)}};return e.setup=u,u}var So=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function on(e){return function(t){var a=t.featureTarget;return!!a&&!!a.properties&&a.properties.meta===e}}function To(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&e.originalEvent.button===0}function ct(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===P.ACTIVE&&e.featureTarget.properties.meta===J.FEATURE}function Xn(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===P.INACTIVE&&e.featureTarget.properties.meta===J.FEATURE}function rn(e){return e.featureTarget===void 0}function Oo(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===J.FEATURE}function Dt(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===J.VERTEX}function an(e){return!!e.originalEvent&&e.originalEvent.shiftKey===!0}function sn(e){return e.keyCode===27}function un(e){return e.keyCode===13}var Wr=Object.freeze({__proto__:null,isOfMetaType:on,isShiftMousedown:To,isActiveFeature:ct,isInactiveFeature:Xn,noTarget:rn,isFeature:Oo,isVertex:Dt,isShiftDown:an,isEscapeKey:sn,isEnterKey:un,isTrue:function(){return!0}}),qr=Ct;function Ct(e,t){this.x=e,this.y=t}function Zn(e,t){var a=t.getBoundingClientRect();return new qr(e.clientX-a.left-(t.clientLeft||0),e.clientY-a.top-(t.clientTop||0))}function St(e,t,a,u){return{type:S.FEATURE,properties:{meta:J.VERTEX,parent:e,coord_path:a,active:u?P.ACTIVE:P.INACTIVE},geometry:{type:S.POINT,coordinates:t}}}function Io(e,t,a){var u=t.geometry.coordinates,c=a.geometry.coordinates;if(u[1]>85||u[1]<j||c[1]>85||c[1]<j)return null;var d={lng:(u[0]+c[0])/2,lat:(u[1]+c[1])/2};return{type:S.FEATURE,properties:{meta:J.MIDPOINT,parent:e,lng:d.lng,lat:d.lat,coord_path:a.properties.coord_path},geometry:{type:S.POINT,coordinates:[d.lng,d.lat]}}}function cn(e,t,a){t===void 0&&(t={}),a===void 0&&(a=null);var u,c=e.geometry,d=c.type,p=c.coordinates,E=e.properties&&e.properties.id,T=[];function M(I,R){var te="",D=null;I.forEach(function(ie,v){var F=R!=null?R+"."+v:String(v),z=St(E,ie,F,L(F));if(t.midpoints&&D){var _e=Io(E,D,z);_e&&T.push(_e)}D=z;var ae=JSON.stringify(ie);te!==ae&&T.push(z),v===0&&(te=ae)})}function L(I){return!!t.selectedPaths&&t.selectedPaths.indexOf(I)!==-1}return d===S.POINT?T.push(St(E,p,a,L(a))):d===S.POLYGON?p.forEach(function(I,R){M(I,a!==null?a+"."+R:String(R))}):d===S.LINE_STRING?M(p,a):d.indexOf(S.MULTI_PREFIX)===0&&(u=d.replace(S.MULTI_PREFIX,""),p.forEach(function(I,R){var te={type:S.FEATURE,properties:e.properties,geometry:{type:u,coordinates:I}};T=T.concat(cn(te,t,R))})),T}Ct.prototype={clone:function(){return new Ct(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,a=e.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,a=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=a,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),a=Math.sin(e),u=t*this.x-a*this.y,c=a*this.x+t*this.y;return this.x=u,this.y=c,this},_rotateAround:function(e,t){var a=Math.cos(e),u=Math.sin(e),c=t.x+a*(this.x-t.x)-u*(this.y-t.y),d=t.y+u*(this.x-t.x)+a*(this.y-t.y);return this.x=c,this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ct.convert=function(e){return e instanceof Ct?e:Array.isArray(e)?new Ct(e[0],e[1]):e};var Re={enable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},Ut={},Yr={get exports(){return Ut},set exports(e){Ut=e}},ko=function(e){if(!e||!e.type)return null;var t=Hr[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e},Hr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Xr=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(a,u){return a.concat(e(u))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(a){var u={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:a};return t.id!==void 0&&(u.id=t.id),u}):[t];case"MultiPoint":return t.coordinates.map(function(a){return{type:"Point",coordinates:a}});case"MultiPolygon":return t.coordinates.map(function(a){return{type:"Polygon",coordinates:a}});case"MultiLineString":return t.coordinates.map(function(a){return{type:"LineString",coordinates:a}});case"GeometryCollection":return t.geometries.map(e).reduce(function(a,u){return a.concat(u)},[]);case"Point":case"Polygon":case"LineString":return[t]}}}),Zr=ko,ln=o(Xr),Kr=function(e){return function t(a){return Array.isArray(a)&&a.length&&typeof a[0]=="number"?[a]:a.reduce(function(u,c){return Array.isArray(c)&&Array.isArray(c[0])?u.concat(t(c)):(u.push(c),u)},[])}(e)};ln instanceof Function||(ln=ln.default);var Kn={},Qr={get exports(){return Kn},set exports(e){Kn=e}}.exports=function(e){return new Pe(e)};function Pe(e){this.value=e}function Lo(e,t,a){var u=[],c=[],d=!0;return function p(E){var T=a?Mo(E):E,M={},L=!0,I={node:T,node_:E,path:[].concat(u),parent:c[c.length-1],parents:c,key:u.slice(-1)[0],isRoot:u.length===0,level:u.length,circular:null,update:function(D,ie){I.isRoot||(I.parent.node[I.key]=D),I.node=D,ie&&(L=!1)},delete:function(D){delete I.parent.node[I.key],D&&(L=!1)},remove:function(D){Fo(I.parent.node)?I.parent.node.splice(I.key,1):delete I.parent.node[I.key],D&&(L=!1)},keys:null,before:function(D){M.before=D},after:function(D){M.after=D},pre:function(D){M.pre=D},post:function(D){M.post=D},stop:function(){d=!1},block:function(){L=!1}};if(!d)return I;function R(){if(typeof I.node=="object"&&I.node!==null){I.keys&&I.node_===I.node||(I.keys=fn(I.node)),I.isLeaf=I.keys.length==0;for(var D=0;D<c.length;D++)if(c[D].node_===E){I.circular=c[D];break}}else I.isLeaf=!0,I.keys=null;I.notLeaf=!I.isLeaf,I.notRoot=!I.isRoot}R();var te=t.call(I,I.node);return te!==void 0&&I.update&&I.update(te),M.before&&M.before.call(I,I.node),L&&(typeof I.node!="object"||I.node===null||I.circular||(c.push(I),R(),dn(I.keys,function(D,ie){u.push(D),M.pre&&M.pre.call(I,I.node[D],D);var v=p(I.node[D]);a&&pn.call(I.node,D)&&(I.node[D]=v.node),v.isLast=ie==I.keys.length-1,v.isFirst=ie==0,M.post&&M.post.call(I,v),u.pop()}),c.pop()),M.after&&M.after.call(I,I.node)),I}(e).node}function Mo(e){if(typeof e=="object"&&e!==null){var t;if(Fo(e))t=[];else if(Tt(e)==="[object Date]")t=new Date(e.getTime?e.getTime():e);else if(function(c){return Tt(c)==="[object RegExp]"}(e))t=new RegExp(e);else if(function(c){return Tt(c)==="[object Error]"}(e))t={message:e.message};else if(function(c){return Tt(c)==="[object Boolean]"}(e))t=new Boolean(e);else if(function(c){return Tt(c)==="[object Number]"}(e))t=new Number(e);else if(function(c){return Tt(c)==="[object String]"}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var a=e.constructor&&e.constructor.prototype||e.__proto__||{},u=function(){};u.prototype=a,t=new u}return dn(fn(e),function(c){t[c]=e[c]}),t}return e}Pe.prototype.get=function(e){for(var t=this.value,a=0;a<e.length;a++){var u=e[a];if(!t||!pn.call(t,u)){t=void 0;break}t=t[u]}return t},Pe.prototype.has=function(e){for(var t=this.value,a=0;a<e.length;a++){var u=e[a];if(!t||!pn.call(t,u))return!1;t=t[u]}return!0},Pe.prototype.set=function(e,t){for(var a=this.value,u=0;u<e.length-1;u++){var c=e[u];pn.call(a,c)||(a[c]={}),a=a[c]}return a[e[u]]=t,t},Pe.prototype.map=function(e){return Lo(this.value,e,!0)},Pe.prototype.forEach=function(e){return this.value=Lo(this.value,e,!1),this.value},Pe.prototype.reduce=function(e,t){var a=arguments.length===1,u=a?this.value:t;return this.forEach(function(c){this.isRoot&&a||(u=e.call(this,u,c))}),u},Pe.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},Pe.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},Pe.prototype.clone=function(){var e=[],t=[];return function a(u){for(var c=0;c<e.length;c++)if(e[c]===u)return t[c];if(typeof u=="object"&&u!==null){var d=Mo(u);return e.push(u),t.push(d),dn(fn(u),function(p){d[p]=a(u[p])}),e.pop(),t.pop(),d}return u}(this.value)};var fn=Object.keys||function(e){var t=[];for(var a in e)t.push(a);return t};function Tt(e){return Object.prototype.toString.call(e)}var Fo=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},dn=function(e,t){if(e.forEach)return e.forEach(t);for(var a=0;a<e.length;a++)t(e[a],a,e)};dn(fn(Pe.prototype),function(e){Qr[e]=function(t){var a=[].slice.call(arguments,1),u=new Pe(t);return u[e].apply(u,a)}});var pn=Object.hasOwnProperty||function(e,t){return t in e},$r=ve;function ve(e){if(!(this instanceof ve))return new ve(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}ve.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},ve.prototype.equals=function(e){var t;return t=e instanceof ve?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},ve.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ve.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof ve?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},ve.prototype.bbox=function(){return this._valid?this._bbox:null},ve.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],a=e[1];return this._bbox[0]<=t&&this._bbox[1]<=a&&this._bbox[2]>=t&&this._bbox[3]>=a},ve.prototype.intersect=function(e){return this._valid?(t=e instanceof ve?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},ve.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},ve.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ei=function(e){if(!e)return[];var t=ln(Zr(e)),a=[];return t.features.forEach(function(u){u.geometry&&(a=a.concat(Kr(u.geometry.coordinates)))}),a},ti=Kn,ni=$r,No={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},oi=Object.keys(No);function Qn(e){for(var t=ni(),a=ei(e),u=0;u<a.length;u++)t.include(a[u]);return t}Yr.exports=function(e){return Qn(e).bbox()},Ut.polygon=function(e){return Qn(e).polygon()},Ut.bboxify=function(e){return ti(e).map(function(t){t&&oi.some(function(a){return!!t[a]&&No[a].indexOf(t.type)!==-1})&&(t.bbox=Qn(t).bbox(),this.update(t))})};var hn=-90;function $n(e,t){var a=hn,u=90,c=hn,d=90,p=270,E=-270;e.forEach(function(M){var L=Ut(M),I=L[1],R=L[3],te=L[0],D=L[2];I>a&&(a=I),R<u&&(u=R),R>c&&(c=R),I<d&&(d=I),te<p&&(p=te),D>E&&(E=D)});var T=t;return a+T.lat>85&&(T.lat=85-a),c+T.lat>90&&(T.lat=90-c),u+T.lat<-85&&(T.lat=-85-u),d+T.lat<hn&&(T.lat=hn-d),p+T.lng<=-270&&(T.lng+=360*Math.ceil(Math.abs(T.lng)/360)),E+T.lng>=270&&(T.lng-=360*Math.ceil(Math.abs(T.lng)/360)),T}function eo(e,t){var a=$n(e.map(function(u){return u.toGeoJSON()}),t);e.forEach(function(u){var c,d=u.getCoordinates(),p=function(T){var M={lng:T[0]+a.lng,lat:T[1]+a.lat};return[M.lng,M.lat]},E=function(T){return T.map(function(M){return p(M)})};u.type===S.POINT?c=p(d):u.type===S.LINE_STRING||u.type===S.MULTI_POINT?c=d.map(p):u.type===S.POLYGON||u.type===S.MULTI_LINE_STRING?c=d.map(E):u.type===S.MULTI_POLYGON&&(c=d.map(function(T){return T.map(function(M){return E(M)})})),u.incomingCoords(c)})}var ce={onSetup:function(e){var t=this,a={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(a.initiallySelectedFeatureIds.filter(function(u){return t.getFeature(u)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),a},fireUpdate:function(){this.map.fire(H.UPDATE,{action:X.MOVE,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,t=this.getSelected(),a=t.filter(function(E){return e.isInstanceOf("MultiFeature",E)}),u=!1;if(t.length>1){u=!0;var c=t[0].type.replace("Multi","");t.forEach(function(E){E.type.replace("Multi","")!==c&&(u=!1)})}var d=a.length>0,p=t.length>0;this.setActionableState({combineFeatures:u,uncombineFeatures:d,trash:p})},getUniqueIds:function(e){return e.length?e.map(function(t){return t.properties.id}).filter(function(t){return t!==void 0}).reduce(function(t,a){return t.add(a),t},new Ne).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Re.enable(this)},onMouseMove:function(e){return this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};ce.onTap=ce.onClick=function(e,t){return rn(t)?this.clickAnywhere(e,t):on(J.VERTEX)(t)?this.clickOnVertex(e,t):Oo(t)?this.clickOnFeature(e,t):void 0},ce.clickAnywhere=function(e){var t=this,a=this.getSelectedIds();a.length&&(this.clearSelectedFeatures(),a.forEach(function(u){return t.doRender(u)})),Re.enable(this),this.stopExtendedInteractions(e)},ce.clickOnVertex=function(e,t){this.changeMode(x.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:y.MOVE})},ce.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},ce.clickOnFeature=function(e,t){var a=this;Re.disable(this),this.stopExtendedInteractions(e);var u=an(t),c=this.getSelectedIds(),d=t.featureTarget.properties.id,p=this.isSelected(d);if(!u&&p&&this.getFeature(d).type!==S.POINT)return this.changeMode(x.DIRECT_SELECT,{featureId:d});p&&u?(this.deselect(d),this.updateUIClasses({mouse:y.POINTER}),c.length===1&&Re.enable(this)):!p&&u?(this.select(d),this.updateUIClasses({mouse:y.MOVE})):p||u||(c.forEach(function(E){return a.doRender(E)}),this.setSelected(d),this.updateUIClasses({mouse:y.MOVE})),this.doRender(d)},ce.onMouseDown=function(e,t){return ct(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&To(t)?this.startBoxSelect(e,t):void 0},ce.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Zn(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},ce.onTouchStart=function(e,t){if(ct(t))return this.startOnActiveFeature(e,t)},ce.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},ce.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:y.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(w.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var a=Zn(t.originalEvent,this.map.getContainer()),u=Math.min(e.boxSelectStartLocation.x,a.x),c=Math.max(e.boxSelectStartLocation.x,a.x),d=Math.min(e.boxSelectStartLocation.y,a.y),p=Math.max(e.boxSelectStartLocation.y,a.y),E="translate("+u+"px, "+d+"px)";e.boxSelectElement.style.transform=E,e.boxSelectElement.style.WebkitTransform=E,e.boxSelectElement.style.width=c-u+"px",e.boxSelectElement.style.height=p-d+"px"},ce.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var a={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};eo(this.getSelected(),a),e.dragMoveLocation=t.lngLat},ce.onTouchEnd=ce.onMouseUp=function(e,t){var a=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var u=[e.boxSelectStartLocation,Zn(t.originalEvent,this.map.getContainer())],c=this.featuresAt(null,u,"click"),d=this.getUniqueIds(c).filter(function(p){return!a.isSelected(p)});d.length&&(this.select(d),d.forEach(function(p){return a.doRender(p)}),this.updateUIClasses({mouse:y.MOVE}))}this.stopExtendedInteractions(e)},ce.toDisplayFeatures=function(e,t,a){t.properties.active=this.isSelected(t.properties.id)?P.ACTIVE:P.INACTIVE,a(t),this.fireActionable(),t.properties.active===P.ACTIVE&&t.geometry.type!==S.POINT&&cn(t).forEach(a)},ce.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},ce.onCombineFeatures=function(){var e=this.getSelected();if(!(e.length===0||e.length<2)){for(var t=[],a=[],u=e[0].type.replace("Multi",""),c=0;c<e.length;c++){var d=e[c];if(d.type.replace("Multi","")!==u)return;d.type.includes("Multi")?d.getCoordinates().forEach(function(E){t.push(E)}):t.push(d.getCoordinates()),a.push(d.toGeoJSON())}if(a.length>1){var p=this.newFeature({type:S.FEATURE,properties:a[0].properties,geometry:{type:"Multi"+u,coordinates:t}});this.addFeature(p),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([p.id]),this.map.fire(H.COMBINE_FEATURES,{createdFeatures:[p.toGeoJSON()],deletedFeatures:a})}this.fireActionable()}},ce.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(t.length!==0){for(var a=[],u=[],c=function(p){var E=t[p];e.isInstanceOf("MultiFeature",E)&&(E.getFeatures().forEach(function(T){e.addFeature(T),T.properties=E.properties,a.push(T.toGeoJSON()),e.select([T.id])}),e.deleteFeature(E.id,{silent:!0}),u.push(E.toGeoJSON()))},d=0;d<t.length;d++)c(d);a.length>1&&this.map.fire(H.UNCOMBINE_FEATURES,{createdFeatures:a,deletedFeatures:u}),this.fireActionable()}};var Ao=on(J.VERTEX),ri=on(J.MIDPOINT),$e={fireUpdate:function(){this.map.fire(H.UPDATE,{action:X.CHANGE_COORDINATES,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var a=t.featureTarget.properties,u=e.selectedCoordPaths.indexOf(a.coord_path);an(t)||u!==-1?an(t)&&u===-1&&e.selectedCoordPaths.push(a.coord_path):e.selectedCoordPaths=[a.coord_path];var c=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(c)},onMidpoint:function(e,t){this.startDragging(e,t);var a=t.featureTarget.properties;e.feature.addCoordinate(a.coord_path,a.lng,a.lat),this.fireUpdate(),e.selectedCoordPaths=[a.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(a){return{feature_id:e,coord_path:a}})},onFeature:function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,a){eo(this.getSelected(),a),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,a){for(var u=e.selectedCoordPaths.map(function(E){return e.feature.getCoordinate(E)}),c=$n(u.map(function(E){return{type:S.FEATURE,properties:{},geometry:{type:S.POINT,coordinates:E}}}),a),d=0;d<u.length;d++){var p=u[d];e.feature.updateCoordinate(e.selectedCoordPaths[d],p[0]+c.lng,p[1]+c.lat)}},clickNoTarget:function(){this.changeMode(x.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(x.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,a=this.getFeature(t);if(!a)throw new Error("You must provide a featureId to enter direct_select mode");if(a.type===S.POINT)throw new TypeError("direct_select mode doesn't handle point features");var u={featureId:t,feature:a,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,u.selectedCoordPaths)),this.setSelected(t),Re.disable(this),this.setActionableState({trash:!0}),u},onStop:function(){Re.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,a){e.featureId===t.properties.id?(t.properties.active=P.ACTIVE,a(t),cn(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(a)):(t.properties.active=P.INACTIVE,a(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(t,a){return a.localeCompare(t,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(x.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var a=ct(t),u=Ao(t),c=e.selectedCoordPaths.length===0;return a&&c||u&&!c?this.updateUIClasses({mouse:y.MOVE}):this.updateUIClasses({mouse:y.NONE}),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};$e.onTouchStart=$e.onMouseDown=function(e,t){return Ao(t)?this.onVertex(e,t):ct(t)?this.onFeature(e,t):ri(t)?this.onMidpoint(e,t):void 0},$e.onDrag=function(e,t){if(e.canDragMove===!0){e.dragMoving=!0,t.originalEvent.stopPropagation();var a={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,a):this.dragFeature(e,t,a),e.dragMoveLocation=t.lngLat}},$e.onClick=function(e,t){return rn(t)?this.clickNoTarget(e,t):ct(t)?this.clickActiveFeature(e,t):Xn(t)?this.clickInactive(e,t):void this.stopDragging(e)},$e.onTap=function(e,t){return rn(t)?this.clickNoTarget(e,t):ct(t)?this.clickActiveFeature(e,t):Xn(t)?this.clickInactive(e,t):void 0},$e.onTouchEnd=$e.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var Ue={};function gn(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}Ue.onSetup=function(){var e=this.newFeature({type:S.FEATURE,properties:{},geometry:{type:S.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(N.POINT),this.setActionableState({trash:!0}),{point:e}},Ue.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)},Ue.onTap=Ue.onClick=function(e,t){this.updateUIClasses({mouse:y.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(H.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.point.id]})},Ue.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Ue.toDisplayFeatures=function(e,t,a){var u=t.properties.id===e.point.id;if(t.properties.active=u?P.ACTIVE:P.INACTIVE,!u)return a(t)},Ue.onTrash=Ue.stopDrawingAndRemove,Ue.onKeyUp=function(e,t){if(sn(t)||un(t))return this.stopDrawingAndRemove(e,t)};var lt={onSetup:function(){var e=this.newFeature({type:S.FEATURE,properties:{},geometry:{type:S.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Re.disable(this),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(N.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&gn(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:y.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Dt(t)&&this.updateUIClasses({mouse:y.POINTER})}};lt.onTap=lt.onClick=function(e,t){return Dt(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},lt.onKeyUp=function(e,t){sn(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)):un(t)&&this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},lt.onStop=function(e){this.updateUIClasses({mouse:y.NONE}),Re.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(H.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT,{},{silent:!0})))},lt.toDisplayFeatures=function(e,t,a){var u=t.properties.id===e.polygon.id;if(t.properties.active=u?P.ACTIVE:P.INACTIVE,!u)return a(t);if(t.geometry.coordinates.length!==0){var c=t.geometry.coordinates[0].length;if(!(c<3)){if(t.properties.meta=J.FEATURE,a(St(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),c>3){var d=t.geometry.coordinates[0].length-3;a(St(e.polygon.id,t.geometry.coordinates[0][d],"0."+d,!1))}if(c<=4){var p=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(a({type:S.FEATURE,properties:t.properties,geometry:{coordinates:p,type:S.LINE_STRING}}),c===3)return}return a(t)}}},lt.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)};var ft={onSetup:function(e){var t,a,u=(e=e||{}).featureId,c="forward";if(u){if(!(t=this.getFeature(u)))throw new Error("Could not find a feature with the provided featureId");var d=e.from;if(d&&d.type==="Feature"&&d.geometry&&d.geometry.type==="Point"&&(d=d.geometry),d&&d.type==="Point"&&d.coordinates&&d.coordinates.length===2&&(d=d.coordinates),!d||!Array.isArray(d))throw new Error("Please use the `from` property to indicate which point to continue the line from");var p=t.coordinates.length-1;if(t.coordinates[p][0]===d[0]&&t.coordinates[p][1]===d[1])a=p+1,t.addCoordinate.apply(t,[a].concat(t.coordinates[p]));else{if(t.coordinates[0][0]!==d[0]||t.coordinates[0][1]!==d[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");c="backwards",a=0,t.addCoordinate.apply(t,[a].concat(t.coordinates[0]))}}else t=this.newFeature({type:S.FEATURE,properties:{},geometry:{type:S.LINE_STRING,coordinates:[]}}),a=0,this.addFeature(t);return this.clearSelectedFeatures(),Re.disable(this),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(N.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:a,direction:c}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&gn(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&gn(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:y.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Dt(t)&&this.updateUIClasses({mouse:y.POINTER})}};ft.onTap=ft.onClick=function(e,t){if(Dt(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},ft.onKeyUp=function(e,t){un(t)?this.changeMode(x.SIMPLE_SELECT,{featureIds:[e.line.id]}):sn(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT))},ft.onStop=function(e){Re.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(H.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT,{},{silent:!0})))},ft.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)},ft.toDisplayFeatures=function(e,t,a){var u=t.properties.id===e.line.id;if(t.properties.active=u?P.ACTIVE:P.INACTIVE,!u)return a(t);t.geometry.coordinates.length<2||(t.properties.meta=J.FEATURE,a(St(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],""+(e.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),a(t))};var Po={simple_select:ce,direct_select:$e,draw_point:Ue,draw_polygon:lt,draw_line_string:ft},ii={defaultMode:x.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:So,modes:Po,controls:{},userProperties:!1},ai={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},si={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function jo(e,t){return e.map(function(a){return a.source?a:Qe(a,{id:a.id+"."+t,source:t==="hot"?O.HOT:O.COLD})})}var _n={};(function(e,t){var a="__lodash_hash_undefined__",u=9007199254740991,c="[object Arguments]",d="[object Array]",p="[object Boolean]",E="[object Date]",T="[object Error]",M="[object Function]",L="[object Map]",I="[object Number]",R="[object Object]",te="[object Promise]",D="[object RegExp]",ie="[object Set]",v="[object String]",F="[object Symbol]",z="[object WeakMap]",_e="[object ArrayBuffer]",ae="[object DataView]",to=/^\[object .+?Constructor\]$/,di=/^(?:0|[1-9]\d*)$/,K={};K["[object Float32Array]"]=K["[object Float64Array]"]=K["[object Int8Array]"]=K["[object Int16Array]"]=K["[object Int32Array]"]=K["[object Uint8Array]"]=K["[object Uint8ClampedArray]"]=K["[object Uint16Array]"]=K["[object Uint32Array]"]=!0,K[c]=K[d]=K[_e]=K[p]=K[ae]=K[E]=K[T]=K[M]=K[L]=K[I]=K[R]=K[D]=K[ie]=K[v]=K[z]=!1;var Ro=typeof qt=="object"&&qt&&qt.Object===Object&&qt,pi=typeof self=="object"&&self&&self.Object===Object&&self,Je=Ro||pi||Function("return this")(),Do=t&&!t.nodeType&&t,Uo=Do&&e&&!e.nodeType&&e,Go=Uo&&Uo.exports===Do,no=Go&&Ro.process,Bo=function(){try{return no&&no.binding&&no.binding("util")}catch{}}(),Vo=Bo&&Bo.isTypedArray;function hi(h,_){for(var k=-1,A=h==null?0:h.length;++k<A;)if(_(h[k],k,h))return!0;return!1}function gi(h){var _=-1,k=Array(h.size);return h.forEach(function(A,Q){k[++_]=[Q,A]}),k}function _i(h){var _=-1,k=Array(h.size);return h.forEach(function(A){k[++_]=A}),k}var Jo,zo,Wo,yi=Array.prototype,mi=Function.prototype,mn=Object.prototype,oo=Je["__core-js_shared__"],qo=mi.toString,Ge=mn.hasOwnProperty,Yo=(Jo=/[^.]+$/.exec(oo&&oo.keys&&oo.keys.IE_PROTO||""))?"Symbol(src)_1."+Jo:"",Ho=mn.toString,bi=RegExp("^"+qo.call(Ge).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xo=Go?Je.Buffer:void 0,bn=Je.Symbol,Zo=Je.Uint8Array,Ko=mn.propertyIsEnumerable,vi=yi.splice,dt=bn?bn.toStringTag:void 0,Qo=Object.getOwnPropertySymbols,wi=Xo?Xo.isBuffer:void 0,Ei=(zo=Object.keys,Wo=Object,function(h){return zo(Wo(h))}),ro=Ot(Je,"DataView"),Gt=Ot(Je,"Map"),io=Ot(Je,"Promise"),ao=Ot(Je,"Set"),so=Ot(Je,"WeakMap"),Bt=Ot(Object,"create"),Ci=gt(ro),Si=gt(Gt),Ti=gt(io),Oi=gt(ao),Ii=gt(so),$o=bn?bn.prototype:void 0,uo=$o?$o.valueOf:void 0;function pt(h){var _=-1,k=h==null?0:h.length;for(this.clear();++_<k;){var A=h[_];this.set(A[0],A[1])}}function ze(h){var _=-1,k=h==null?0:h.length;for(this.clear();++_<k;){var A=h[_];this.set(A[0],A[1])}}function ht(h){var _=-1,k=h==null?0:h.length;for(this.clear();++_<k;){var A=h[_];this.set(A[0],A[1])}}function vn(h){var _=-1,k=h==null?0:h.length;for(this.__data__=new ht;++_<k;)this.add(h[_])}function et(h){var _=this.__data__=new ze(h);this.size=_.size}function ki(h,_){var k=Cn(h),A=!k&&Ai(h),Q=!k&&!A&&co(h),B=!k&&!A&&!Q&&ur(h),ne=k||A||Q||B,se=ne?function(fe,Be){for(var We=-1,we=Array(fe);++We<fe;)we[We]=Be(We);return we}(h.length,String):[],De=se.length;for(var le in h)!_&&!Ge.call(h,le)||ne&&(le=="length"||Q&&(le=="offset"||le=="parent")||B&&(le=="buffer"||le=="byteLength"||le=="byteOffset")||Ni(le,De))||se.push(le);return se}function wn(h,_){for(var k=h.length;k--;)if(rr(h[k][0],_))return k;return-1}function Vt(h){return h==null?h===void 0?"[object Undefined]":"[object Null]":dt&&dt in Object(h)?function(_){var k=Ge.call(_,dt),A=_[dt];try{_[dt]=void 0;var Q=!0}catch{}var B=Ho.call(_);return Q&&(k?_[dt]=A:delete _[dt]),B}(h):function(_){return Ho.call(_)}(h)}function er(h){return Jt(h)&&Vt(h)==c}function tr(h,_,k,A,Q){return h===_||(h==null||_==null||!Jt(h)&&!Jt(_)?h!=h&&_!=_:function(B,ne,se,De,le,fe){var Be=Cn(B),We=Cn(ne),we=Be?d:tt(B),qe=We?d:tt(ne),It=(we=we==c?R:we)==R,Sn=(qe=qe==c?R:qe)==R,kt=we==qe;if(kt&&co(B)){if(!co(ne))return!1;Be=!0,It=!1}if(kt&&!It)return fe||(fe=new et),Be||ur(B)?nr(B,ne,se,De,le,fe):function(Y,W,Tn,nt,lo,je,Ye){switch(Tn){case ae:if(Y.byteLength!=W.byteLength||Y.byteOffset!=W.byteOffset)return!1;Y=Y.buffer,W=W.buffer;case _e:return!(Y.byteLength!=W.byteLength||!je(new Zo(Y),new Zo(W)));case p:case E:case I:return rr(+Y,+W);case T:return Y.name==W.name&&Y.message==W.message;case D:case v:return Y==W+"";case L:var ot=gi;case ie:var Wt=1&nt;if(ot||(ot=_i),Y.size!=W.size&&!Wt)return!1;var On=Ye.get(Y);if(On)return On==W;nt|=2,Ye.set(Y,W);var Lt=nr(ot(Y),ot(W),nt,lo,je,Ye);return Ye.delete(Y),Lt;case F:if(uo)return uo.call(Y)==uo.call(W)}return!1}(B,ne,we,se,De,le,fe);if(!(1&se)){var zt=It&&Ge.call(B,"__wrapped__"),cr=Sn&&Ge.call(ne,"__wrapped__");if(zt||cr){var ji=zt?B.value():B,xi=cr?ne.value():ne;return fe||(fe=new et),le(ji,xi,se,De,fe)}}return kt?(fe||(fe=new et),function(Y,W,Tn,nt,lo,je){var Ye=1&Tn,ot=or(Y),Wt=ot.length,On=or(W).length;if(Wt!=On&&!Ye)return!1;for(var Lt=Wt;Lt--;){var _t=ot[Lt];if(!(Ye?_t in W:Ge.call(W,_t)))return!1}var lr=je.get(Y);if(lr&&je.get(W))return lr==W;var In=!0;je.set(Y,W),je.set(W,Y);for(var fo=Ye;++Lt<Wt;){var kn=Y[_t=ot[Lt]],Ln=W[_t];if(nt)var fr=Ye?nt(Ln,kn,_t,W,Y,je):nt(kn,Ln,_t,Y,W,je);if(!(fr===void 0?kn===Ln||lo(kn,Ln,Tn,nt,je):fr)){In=!1;break}fo||(fo=_t=="constructor")}if(In&&!fo){var Mn=Y.constructor,Fn=W.constructor;Mn==Fn||!("constructor"in Y)||!("constructor"in W)||typeof Mn=="function"&&Mn instanceof Mn&&typeof Fn=="function"&&Fn instanceof Fn||(In=!1)}return je.delete(Y),je.delete(W),In}(B,ne,se,De,le,fe)):!1}(h,_,k,A,tr,Q))}function Li(h){return!(!sr(h)||function(_){return!!Yo&&Yo in _}(h))&&(ir(h)?bi:to).test(gt(h))}function Mi(h){if(k=(_=h)&&_.constructor,A=typeof k=="function"&&k.prototype||mn,_!==A)return Ei(h);var _,k,A,Q=[];for(var B in Object(h))Ge.call(h,B)&&B!="constructor"&&Q.push(B);return Q}function nr(h,_,k,A,Q,B){var ne=1&k,se=h.length,De=_.length;if(se!=De&&!(ne&&De>se))return!1;var le=B.get(h);if(le&&B.get(_))return le==_;var fe=-1,Be=!0,We=2&k?new vn:void 0;for(B.set(h,_),B.set(_,h);++fe<se;){var we=h[fe],qe=_[fe];if(A)var It=ne?A(qe,we,fe,_,h,B):A(we,qe,fe,h,_,B);if(It!==void 0){if(It)continue;Be=!1;break}if(We){if(!hi(_,function(Sn,kt){if(zt=kt,!We.has(zt)&&(we===Sn||Q(we,Sn,k,A,B)))return We.push(kt);var zt})){Be=!1;break}}else if(we!==qe&&!Q(we,qe,k,A,B)){Be=!1;break}}return B.delete(h),B.delete(_),Be}function or(h){return function(_,k,A){var Q=k(_);return Cn(_)?Q:function(B,ne){for(var se=-1,De=ne.length,le=B.length;++se<De;)B[le+se]=ne[se];return B}(Q,A(_))}(h,Pi,Fi)}function En(h,_){var k,A,Q=h.__data__;return((A=typeof(k=_))=="string"||A=="number"||A=="symbol"||A=="boolean"?k!=="__proto__":k===null)?Q[typeof _=="string"?"string":"hash"]:Q.map}function Ot(h,_){var k=function(A,Q){return A==null?void 0:A[Q]}(h,_);return Li(k)?k:void 0}pt.prototype.clear=function(){this.__data__=Bt?Bt(null):{},this.size=0},pt.prototype.delete=function(h){var _=this.has(h)&&delete this.__data__[h];return this.size-=_?1:0,_},pt.prototype.get=function(h){var _=this.__data__;if(Bt){var k=_[h];return k===a?void 0:k}return Ge.call(_,h)?_[h]:void 0},pt.prototype.has=function(h){var _=this.__data__;return Bt?_[h]!==void 0:Ge.call(_,h)},pt.prototype.set=function(h,_){var k=this.__data__;return this.size+=this.has(h)?0:1,k[h]=Bt&&_===void 0?a:_,this},ze.prototype.clear=function(){this.__data__=[],this.size=0},ze.prototype.delete=function(h){var _=this.__data__,k=wn(_,h);return!(k<0)&&(k==_.length-1?_.pop():vi.call(_,k,1),--this.size,!0)},ze.prototype.get=function(h){var _=this.__data__,k=wn(_,h);return k<0?void 0:_[k][1]},ze.prototype.has=function(h){return wn(this.__data__,h)>-1},ze.prototype.set=function(h,_){var k=this.__data__,A=wn(k,h);return A<0?(++this.size,k.push([h,_])):k[A][1]=_,this},ht.prototype.clear=function(){this.size=0,this.__data__={hash:new pt,map:new(Gt||ze),string:new pt}},ht.prototype.delete=function(h){var _=En(this,h).delete(h);return this.size-=_?1:0,_},ht.prototype.get=function(h){return En(this,h).get(h)},ht.prototype.has=function(h){return En(this,h).has(h)},ht.prototype.set=function(h,_){var k=En(this,h),A=k.size;return k.set(h,_),this.size+=k.size==A?0:1,this},vn.prototype.add=vn.prototype.push=function(h){return this.__data__.set(h,a),this},vn.prototype.has=function(h){return this.__data__.has(h)},et.prototype.clear=function(){this.__data__=new ze,this.size=0},et.prototype.delete=function(h){var _=this.__data__,k=_.delete(h);return this.size=_.size,k},et.prototype.get=function(h){return this.__data__.get(h)},et.prototype.has=function(h){return this.__data__.has(h)},et.prototype.set=function(h,_){var k=this.__data__;if(k instanceof ze){var A=k.__data__;if(!Gt||A.length<199)return A.push([h,_]),this.size=++k.size,this;k=this.__data__=new ht(A)}return k.set(h,_),this.size=k.size,this};var Fi=Qo?function(h){return h==null?[]:(h=Object(h),function(_,k){for(var A=-1,Q=_==null?0:_.length,B=0,ne=[];++A<Q;){var se=_[A];k(se,A,_)&&(ne[B++]=se)}return ne}(Qo(h),function(_){return Ko.call(h,_)}))}:function(){return[]},tt=Vt;function Ni(h,_){return!!(_=_??u)&&(typeof h=="number"||di.test(h))&&h>-1&&h%1==0&&h<_}function gt(h){if(h!=null){try{return qo.call(h)}catch{}try{return h+""}catch{}}return""}function rr(h,_){return h===_||h!=h&&_!=_}(ro&&tt(new ro(new ArrayBuffer(1)))!=ae||Gt&&tt(new Gt)!=L||io&&tt(io.resolve())!=te||ao&&tt(new ao)!=ie||so&&tt(new so)!=z)&&(tt=function(h){var _=Vt(h),k=_==R?h.constructor:void 0,A=k?gt(k):"";if(A)switch(A){case Ci:return ae;case Si:return L;case Ti:return te;case Oi:return ie;case Ii:return z}return _});var Ai=er(function(){return arguments}())?er:function(h){return Jt(h)&&Ge.call(h,"callee")&&!Ko.call(h,"callee")},Cn=Array.isArray,co=wi||function(){return!1};function ir(h){if(!sr(h))return!1;var _=Vt(h);return _==M||_=="[object GeneratorFunction]"||_=="[object AsyncFunction]"||_=="[object Proxy]"}function ar(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=u}function sr(h){var _=typeof h;return h!=null&&(_=="object"||_=="function")}function Jt(h){return h!=null&&typeof h=="object"}var ur=Vo?function(h){return function(_){return h(_)}}(Vo):function(h){return Jt(h)&&ar(h.length)&&!!K[Vt(h)]};function Pi(h){return(_=h)!=null&&ar(_.length)&&!ir(_)?ki(h):Mi(h);var _}e.exports=function(h,_){return tr(h,_)}})({get exports(){return _n},set exports(e){_n=e}},_n);var ui=_n;function xo(e,t){return e.length===t.length&&JSON.stringify(e.map(function(a){return a}).sort())===JSON.stringify(t.map(function(a){return a}).sort())}var ci={Polygon:Ae,LineString:Ve,Point:ut,MultiPolygon:Oe,MultiLineString:Oe,MultiPoint:Oe},li=Object.freeze({__proto__:null,CommonSelectors:Wr,constrainFeatureMovement:$n,createMidPoint:Io,createSupplementaryPoints:cn,createVertex:St,doubleClickZoom:Re,euclideanDistance:Wn,featuresAt:Et,getFeatureAtAndSetCursors:tn,isClick:qn,isEventAtCoordinates:gn,isTap:Yn,mapEventToBoundingBox:st,ModeHandler:r,moveFeatures:eo,sortFeatures:ke,stringSetsAreEqual:xo,StringSet:Ne,theme:So,toDenseArray:Rt}),fi=function(e,t){var a={options:e=function(c){c===void 0&&(c={});var d=Qe(c);return c.controls||(d.controls={}),c.displayControlsDefault===!1?d.controls=Qe(si,c.controls):d.controls=Qe(ai,c.controls),(d=Qe(ii,d)).styles=jo(d.styles,"cold").concat(jo(d.styles,"hot")),d}(e)};t=function(c,d){return d.modes=x,d.getFeatureIdsAt=function(p){return Et.click({point:p},null,c).map(function(E){return E.properties.id})},d.getSelectedIds=function(){return c.store.getSelectedIds()},d.getSelected=function(){return{type:S.FEATURE_COLLECTION,features:c.store.getSelectedIds().map(function(p){return c.store.get(p)}).map(function(p){return p.toGeoJSON()})}},d.getSelectedPoints=function(){return{type:S.FEATURE_COLLECTION,features:c.store.getSelectedCoordinates().map(function(p){return{type:S.FEATURE,properties:{},geometry:{type:S.POINT,coordinates:p.coordinates}}})}},d.set=function(p){if(p.type===void 0||p.type!==S.FEATURE_COLLECTION||!Array.isArray(p.features))throw new Error("Invalid FeatureCollection");var E=c.store.createRenderBatch(),T=c.store.getAllIds().slice(),M=d.add(p),L=new Ne(M);return(T=T.filter(function(I){return!L.has(I)})).length&&d.delete(T),E(),M},d.add=function(p){var E=JSON.parse(JSON.stringify(ko(p))).features.map(function(T){if(T.id=T.id||xt(),T.geometry===null)throw new Error("Invalid geometry: null");if(c.store.get(T.id)===void 0||c.store.get(T.id).type!==T.geometry.type){var M=ci[T.geometry.type];if(M===void 0)throw new Error("Invalid geometry type: "+T.geometry.type+".");var L=new M(c,T);c.store.add(L)}else{var I=c.store.get(T.id);I.properties=T.properties,ui(I.getCoordinates(),T.geometry.coordinates)||I.incomingCoords(T.geometry.coordinates)}return T.id});return c.store.render(),E},d.get=function(p){var E=c.store.get(p);if(E)return E.toGeoJSON()},d.getAll=function(){return{type:S.FEATURE_COLLECTION,features:c.store.getAll().map(function(p){return p.toGeoJSON()})}},d.delete=function(p){return c.store.delete(p,{silent:!0}),d.getMode()!==x.DIRECT_SELECT||c.store.getSelectedIds().length?c.store.render():c.events.changeMode(x.SIMPLE_SELECT,void 0,{silent:!0}),d},d.deleteAll=function(){return c.store.delete(c.store.getAllIds(),{silent:!0}),d.getMode()===x.DIRECT_SELECT?c.events.changeMode(x.SIMPLE_SELECT,void 0,{silent:!0}):c.store.render(),d},d.changeMode=function(p,E){return E===void 0&&(E={}),p===x.SIMPLE_SELECT&&d.getMode()===x.SIMPLE_SELECT?(xo(E.featureIds||[],c.store.getSelectedIds())||(c.store.setSelected(E.featureIds,{silent:!0}),c.store.render()),d):(p===x.DIRECT_SELECT&&d.getMode()===x.DIRECT_SELECT&&E.featureId===c.store.getSelectedIds()[0]||c.events.changeMode(p,E,{silent:!0}),d)},d.getMode=function(){return c.events.getMode()},d.trash=function(){return c.events.trash({silent:!0}),d},d.combineFeatures=function(){return c.events.combineFeatures({silent:!0}),d},d.uncombineFeatures=function(){return c.events.uncombineFeatures({silent:!0}),d},d.setFeatureProperty=function(p,E,T){return c.store.setFeatureProperty(p,E,T),d},d}(a,t),a.api=t;var u=zr(a);return t.onAdd=u.onAdd,t.onRemove=u.onRemove,t.types=N,t.options=e,t};function yn(e){fi(e,this)}return yn.modes=Po,yn.constants=me,yn.lib=li,yn})})(xr);var Wa=xr.exports;const qa=Ui(Wa);function Ya(i,n,r){let o;Ee(i,vt,f=>r(1,o=f));let s,l=Gi();return Bn(async()=>{s=new qa({displayControlsDefault:!1,controls:{polygon:!0}}),o.addControl(s),o.on("draw.create",f=>{const b=f.features[0];s.deleteAll(),l("polygon",b.geometry)})}),mo(()=>{o.removeControl(s)}),[]}class is extends Ce{constructor(n){super(),Se(this,n,Ya,null,Te,{})}}export{es as A,os as B,rs as I,ts as L,ns as M,is as S,go as a,Za as b,_o as c,$a as d,Rn as e,Ka as f,Qa as g,jr as h,Ki as i,Xa as j,wt as k,mt as l,vt as m,Jn as n,Ar as o,Vi as u};
