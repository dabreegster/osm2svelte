import{S as N,i as A,s as G,k as w,l as j,m as b,o as E,a as $,q as g,v as O,w as R,C as L,d as k,D,E as M,Y,Z,_ as x,A as X,$ as ee,a0 as J,n as v,e as K,u as C,g as Q,b as h,c as U,t as W,y as S,H as te,h as V,a1 as ne,L as le,K as re,M as q,P as se,Q as oe,j as ie,R as ae,x as ue,T as fe,U as pe,V as de,W as ce,X as me,N as _e}from"./SelectImportArea-202112ca.js";function ye(o){let e,n=o[0].size+"",t,l,s,r,a,m;return{c(){e=w("div"),t=j(n),l=j(" ways edited"),s=b(),r=w("button"),r.textContent="Download .osc",E(r,"type","button")},m(p,c){$(p,e,c),g(e,t),g(e,l),$(p,s,c),$(p,r,c),a||(m=O(r,"click",o[1]),a=!0)},p(p,[c]){c&1&&n!==(n=p[0].size+"")&&R(t,n)},i:L,o:L,d(p){p&&k(e),p&&k(s),p&&k(r),a=!1,m()}}}function ge(o,e,n){let t;D(o,M,a=>n(3,t=a));let l=new Set;function s(a){l.add(a.detail),n(0,l)}function r(){let a=`<osmChange version="0.6" generator="osm2streets">
`;a+=`<create/>
`,a+=`<modify>
`;for(let m of l)a+=t.wayToXml(m),a+=`
`;a+=`</modify>
`,a+="</osmChange>",Y("lane_edits.osc",a)}return[l,r,s]}class $e extends N{constructor(e){super(),A(this,e,ge,ye,G,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function z(o,e,n){const t=o.slice();return t[11]=e[n],t[12]=e,t[13]=n,t}function H(o,e){let n,t,l,s,r,a,m,p,c,i,d,u;function f(){e[5].call(l,e[12],e[13])}function _(){e[6].call(a,e[12],e[13])}function I(){return e[7](e[11])}return{key:o,first:null,c(){n=w("tr"),t=w("td"),l=w("input"),s=b(),r=w("td"),a=w("input"),m=b(),p=w("td"),c=w("button"),c.textContent="Delete",i=b(),E(l,"type","text"),E(a,"type","text"),E(c,"type","button"),this.first=n},m(y,T){$(y,n,T),g(n,t),g(t,l),J(l,e[11].key),g(n,s),g(n,r),g(r,a),J(a,e[11].value),g(n,m),g(n,p),g(p,c),g(n,i),d||(u=[O(l,"input",f),O(a,"input",_),O(c,"click",I)],d=!0)},p(y,T){e=y,T&1&&l.value!==e[11].key&&J(l,e[11].key),T&1&&a.value!==e[11].value&&J(a,e[11].value)},d(y){y&&k(n),d=!1,X(u)}}}function ke(o){let e,n,t=[],l=new Map,s,r,a,m,p,c,i=o[0];const d=u=>u[11].id;for(let u=0;u<i.length;u+=1){let f=z(o,i,u),_=d(f);l.set(_,t[u]=H(_,f))}return{c(){e=w("table"),n=w("tbody");for(let u=0;u<t.length;u+=1)t[u].c();s=b(),r=w("button"),r.textContent="Add new tag",a=b(),m=w("button"),m.textContent="Recalculate",E(r,"type","button"),E(m,"type","button")},m(u,f){$(u,e,f),g(e,n);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(n,null);$(u,s,f),$(u,r,f),$(u,a,f),$(u,m,f),p||(c=[O(r,"click",o[2]),O(m,"click",o[3])],p=!0)},p(u,[f]){f&3&&(i=u[0],t=Z(t,f,d,1,u,i,l,n,x,H,null,z))},i:L,o:L,d(u){u&&k(e);for(let f=0;f<t.length;f+=1)t[f].d();u&&k(s),u&&k(r),u&&k(a),u&&k(m),p=!1,X(c)}}}function we(o,e,n){let t;D(o,M,f=>n(9,t=f));let l=ee(),{way:s}=e,r=[],a=0;for(let[f,_]of Object.entries(JSON.parse(t.getOsmTagsForWay(s))))r.push({id:a++,key:f,value:_});function m(f){n(0,r=r.filter(_=>_.id!=f))}function p(){r.push({id:a++,key:"",value:""}),n(0,r)}function c(){let f={};for(let _ of r)_.key&&_.value&&(f[_.key]=_.value);t.overwriteOsmTagsForWay(s,JSON.stringify(f)),M.set(t),l("editedWay",s)}function i(f,_){f[_].key=this.value,n(0,r)}function d(f,_){f[_].value=this.value,n(0,r)}const u=f=>m(f.id);return o.$$set=f=>{"way"in f&&n(4,s=f.way)},[r,m,p,c,s,i,d,u]}class be extends N{constructor(e){super(),A(this,e,we,ke,G,{way:4})}}function he(o){let e;return{c(){e=j("Click a road to edit")},m(n,t){$(n,e,t)},p:L,i:L,o:L,d(n){n&&k(e)}}}function We(o){let e,n,t,l,s,r,a,m=o[0],p,c;r=new ne({props:{source:"current-way",gj:o[2],layerStyle:o[3]}});let i=P(o);return{c(){e=w("a"),n=j("Way "),t=j(o[0]),s=b(),v(r.$$.fragment),a=b(),i.c(),p=K(),E(e,"href",l="http://openstreetmap.org/way/"+o[0]),E(e,"target","_blank")},m(d,u){$(d,e,u),g(e,n),g(e,t),$(d,s,u),C(r,d,u),$(d,a,u),i.m(d,u),$(d,p,u),c=!0},p(d,u){(!c||u&1)&&R(t,d[0]),(!c||u&1&&l!==(l="http://openstreetmap.org/way/"+d[0]))&&E(e,"href",l);const f={};u&4&&(f.gj=d[2]),r.$set(f),u&1&&G(m,m=d[0])?(Q(),h(i,1,1,L),U(),i=P(d),i.c(),W(i,1),i.m(p.parentNode,p)):i.p(d,u)},i(d){c||(W(r.$$.fragment,d),W(i),c=!0)},o(d){h(r.$$.fragment,d),h(i),c=!1},d(d){d&&k(e),d&&k(s),S(r,d),d&&k(a),d&&k(p),i.d(d)}}}function P(o){let e,n;return e=new be({props:{way:o[0]}}),e.$on("editedWay",o[7]),{c(){v(e.$$.fragment)},m(t,l){C(e,t,l),n=!0},p(t,l){const s={};l&1&&(s.way=t[0]),e.$set(s)},i(t){n||(W(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){S(e,t)}}}function ve(o){let e,n,t,l,s,r,a={};e=new $e({props:a}),o[6](e);const m=[We,he],p=[];function c(i,d){return i[0]?0:1}return t=c(o),l=p[t]=m[t](o),{c(){v(e.$$.fragment),n=b(),l.c(),s=K()},m(i,d){C(e,i,d),$(i,n,d),p[t].m(i,d),$(i,s,d),r=!0},p(i,[d]){const u={};e.$set(u);let f=t;t=c(i),t===f?p[t].p(i,d):(Q(),h(p[f],1,1,()=>{p[f]=null}),U(),l=p[t],l?l.p(i,d):(l=p[t]=m[t](i),l.c()),W(l,1),l.m(s.parentNode,s))},i(i){r||(W(e.$$.fragment,i),W(l),r=!0)},o(i){h(e.$$.fragment,i),h(l),r=!1},d(i){o[6](null),S(e,i),i&&k(n),p[t].d(i),i&&k(s)}}}function Ce(o,e,n){let t,l;D(o,M,i=>n(4,t=i)),D(o,te,i=>n(5,l=i));let s,r,a,m={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function p(i){V[i?"unshift":"push"](()=>{s=i,n(1,s)})}const c=i=>s.handleEditedWay(i);return o.$$.update=()=>{o.$$.dirty&49&&(n(0,r=null),n(2,a=null),l?l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(n(0,r=BigInt(l.properties.osm_way_ids[0])),n(2,a=JSON.parse(t.getGeometryForWay(r)))):(n(0,r=null),n(2,a=null)))},[r,s,a,m,t,l,p,c]}class Se extends N{constructor(e){super(),A(this,e,Ce,ve,G,{})}}function Ee(o){let e,n,t,l,s,r,a,m,p,c,i,d,u,f;l=new se({});function _(y){o[6](y)}let I={settings:o[2]};return o[0]!==void 0&&(I.imported=o[0]),r=new oe({props:I}),V.push(()=>ie(r,"imported",_)),p=new ae({props:{imported:o[0]}}),i=new Se({}),{c(){e=w("div"),n=w("h1"),n.textContent="osm2streets lane editor",t=b(),v(l.$$.fragment),s=b(),v(r.$$.fragment),m=b(),v(p.$$.fragment),c=b(),v(i.$$.fragment),d=b(),u=w("div"),u.innerHTML=`<strong>Warnings:</strong> 
      <ul><li><strong>This tool is an early experiment</strong></li> 
        <li>Don&#39;t use this tool without understanding OSM tagging</li> 
        <li>Be careful around sidepaths, footways, and dual carriageways</li> 
        <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>`,E(e,"slot","left")},m(y,T){$(y,e,T),g(e,n),g(e,t),C(l,e,null),g(e,s),C(r,e,null),g(e,m),C(p,e,null),g(e,c),C(i,e,null),g(e,d),g(e,u),f=!0},p(y,T){const B={};!a&&T&1&&(a=!0,B.imported=y[0],ue(()=>a=!1)),r.$set(B);const F={};T&1&&(F.imported=y[0]),p.$set(F)},i(y){f||(W(l.$$.fragment,y),W(r.$$.fragment,y),W(p.$$.fragment,y),W(i.$$.fragment,y),f=!0)},o(y){h(l.$$.fragment,y),h(r.$$.fragment,y),h(p.$$.fragment,y),h(i.$$.fragment,y),f=!1},d(y){y&&k(e),S(l),S(r),S(p),S(i)}}}function Te(o){let e,n,t,l;return e=new ce({}),e.$on("polygon",o[5]),t=new me({props:{layers:o[1],showControls:!1}}),{c(){v(e.$$.fragment),n=b(),v(t.$$.fragment)},m(s,r){C(e,s,r),$(s,n,r),C(t,s,r),l=!0},p(s,r){const a={};r&2&&(a.layers=s[1]),t.$set(a)},i(s){l||(W(e.$$.fragment,s),W(t.$$.fragment,s),l=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),l=!1},d(s){S(e,s),s&&k(n),S(t,s)}}}function Le(o){let e,n,t;return n=new fe({props:{$$slots:{default:[Te]},$$scope:{ctx:o}}}),{c(){e=w("div"),v(n.$$.fragment),E(e,"slot","main")},m(l,s){$(l,e,s),C(n,e,null),t=!0},p(l,s){const r={};s&131&&(r.$$scope={dirty:s,ctx:l}),n.$set(r)},i(l){t||(W(n.$$.fragment,l),t=!0)},o(l){h(n.$$.fragment,l),t=!1},d(l){l&&k(e),S(n)}}}function Oe(o){let e,n;return e=new le({props:{$$slots:{main:[Le],left:[Ee]},$$scope:{ctx:o}}}),{c(){v(e.$$.fragment)},m(t,l){C(e,t,l),n=!0},p(t,[l]){const s={};l&131&&(s.$$scope={dirty:l,ctx:t}),e.$set(s)},i(t){n||(W(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){S(e,t)}}}function De(o,e,n){let t,l;D(o,q,c=>n(3,t=c)),D(o,M,c=>n(4,l=c));let s={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1,osm2lanes:!1},r={kind:"nothing"},a=[];re(async()=>{await pe()});const m=c=>de(c,r,s);function p(c){r=c,n(0,r)}return o.$$.update=()=>{o.$$.dirty&1&&r.kind=="done"&&(M.set(r.network),q.set(r.boundaryGJ)),o.$$.dirty&24&&l&&t&&n(1,a=_e(l,t))},[r,a,s,t,l,m,p]}class Me extends N{constructor(e){super(),A(this,e,De,Oe,G,{})}}new Me({target:document.getElementById("app")});
