import{S as T,i as A,s as D,b as q,a as F,c as y,d as b,m as k,e as d,f as H,t as v,g as C,h as $,j as L,k as S,l as g,n as P,o as j,p as h,q as E,r as I,u as W,v as J,w as Z,x as K,y as Y,z as x,L as ee,A as te}from"./maplibre-gl-f4f0e05d.js";import{L as Q,a as U,h as V,n as M,b as ne,m as X,c as re,d as oe,A as se,I as le,M as ie,i as ae,e as pe}from"./Map-45907be2.js";import{T as fe}from"./TopLeftPanel-c7512dd1.js";function ue(i){let e,s,t,o,r;e=new Q({props:{source:"connected-roads",gj:i[0],layerStyle:i[2],show:i[1]}});function a(l){i[5](l)}let n={gj:i[0],name:"Roads connected to intersection",downloadable:!1};return i[1]!==void 0&&(n.show=i[1]),t=new U({props:n}),q.push(()=>F(t,"show",a)),{c(){y(e.$$.fragment),s=b(),y(t.$$.fragment)},m(l,p){k(e,l,p),d(l,s,p),k(t,l,p),r=!0},p(l,[p]){const u={};p&1&&(u.gj=l[0]),p&2&&(u.show=l[1]),e.$set(u);const c={};p&1&&(c.gj=l[0]),!o&&p&2&&(o=!0,c.show=l[1],H(()=>o=!1)),t.$set(c)},i(l){r||(v(e.$$.fragment,l),v(t.$$.fragment,l),r=!0)},o(l){C(e.$$.fragment,l),C(t.$$.fragment,l),r=!1},d(l){l&&$(s),L(e,l),L(t,l)}}}function ce(i,e,s){let t,o;S(i,V,p=>s(3,t=p)),S(i,M,p=>s(4,o=p));let r,a=!0,n={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function l(p){a=p,s(1,a)}return i.$$.update=()=>{i.$$.dirty&24&&(o&&t?s(0,r=JSON.parse(o.debugRoadsConnectedToIntersectionGeojson(t.properties.id))):s(0,r=void 0))},[r,a,n,t,o,l]}class me extends T{constructor(e){super(),A(this,e,ce,ue,D,{})}}function de(i){let e,s,t,o,r;e=new Q({props:{source:"movements",gj:i[0],layerStyle:i[2],show:i[1]}});function a(l){i[5](l)}let n={gj:i[0],name:"Movement arrows",downloadable:!1};return i[1]!==void 0&&(n.show=i[1]),t=new U({props:n}),q.push(()=>F(t,"show",a)),{c(){y(e.$$.fragment),s=b(),y(t.$$.fragment)},m(l,p){k(e,l,p),d(l,s,p),k(t,l,p),r=!0},p(l,[p]){const u={};p&1&&(u.gj=l[0]),p&2&&(u.show=l[1]),e.$set(u);const c={};p&1&&(c.gj=l[0]),!o&&p&2&&(o=!0,c.show=l[1],H(()=>o=!1)),t.$set(c)},i(l){r||(v(e.$$.fragment,l),v(t.$$.fragment,l),r=!0)},o(l){C(e.$$.fragment,l),C(t.$$.fragment,l),r=!1},d(l){l&&$(s),L(e,l),L(t,l)}}}function $e(i,e,s){let t,o;S(i,M,p=>s(3,t=p)),S(i,ne,p=>s(4,o=p));let r,a=!0,n={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function l(p){a=p,s(1,a)}return i.$$.update=()=>{if(i.$$.dirty&24)if(t&&o){let p=o.properties;s(0,r=JSON.parse(t.debugMovementsFromLaneGeojson(p.road,p.index)))}else s(0,r=void 0)},[r,a,n,t,o,l]}class _e extends T{constructor(e){super(),A(this,e,$e,de,D,{})}}function ge(i){let e,s,t,o,r,a;return{c(){e=g("div"),s=g("label"),t=g("input"),o=P(`
    Clockwise ordering of roads`),j(t,"type","checkbox")},m(n,l){d(n,e,l),h(e,s),h(s,t),t.checked=i[0],h(s,o),r||(a=E(t,"change",i[5]),r=!0)},p(n,[l]){l&1&&(t.checked=n[0])},i:I,o:I,d(n){n&&$(e),r=!1,a()}}}function we(i,e,s){let t,o,r;S(i,X,p=>s(2,t=p)),S(i,V,p=>s(3,o=p)),S(i,M,p=>s(4,r=p));let a=[],n=!1;function l(){n=this.checked,s(0,n)}return i.$$.update=()=>{if(i.$$.dirty&31){for(let p of a)p.remove();if(s(1,a=[]),n&&o){let p=JSON.parse(r.debugClockwiseOrderingForIntersectionGeojson(o.properties.id));for(let u of p.features)a.push(new W.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1}).setLngLat(u.geometry.coordinates).setHTML(u.properties.label).addTo(t))}}},[n,a,t,o,r,l]}class he extends T{constructor(e){super(),A(this,e,we,ge,D,{})}}function ye(i){let e,s,t,o,r,a;return e=new _e({}),t=new he({}),r=new me({}),{c(){y(e.$$.fragment),s=b(),y(t.$$.fragment),o=b(),y(r.$$.fragment)},m(n,l){k(e,n,l),d(n,s,l),k(t,n,l),d(n,o,l),k(r,n,l),a=!0},p:I,i(n){a||(v(e.$$.fragment,n),v(t.$$.fragment,n),v(r.$$.fragment,n),a=!0)},o(n){C(e.$$.fragment,n),C(t.$$.fragment,n),C(r.$$.fragment,n),a=!1},d(n){n&&($(s),$(o)),L(e,n),L(t,n),L(r,n)}}}class be extends T{constructor(e){super(),A(this,e,null,ye,D,{})}}function R(i,e,s){const t=i.slice();return t[4]=e[s],t}function G(i){let e,s=i[4]+"",t,o,r;return{c(){e=g("a"),t=P(s),r=P(","),j(e,"href",o="https://www.openstreetmap.org/node/"+i[4]),j(e,"target","_blank")},m(a,n){d(a,e,n),h(e,t),d(a,r,n)},p(a,n){n&1&&s!==(s=a[4]+"")&&K(t,s),n&1&&o!==(o="https://www.openstreetmap.org/node/"+a[4])&&j(e,"href",o)},d(a){a&&($(e),$(r))}}}function ke(i){let e,s,t,o,r,a,n,l,p,u=J(i[0].properties.osm_node_ids),c=[];for(let m=0;m<u.length;m+=1)c[m]=G(R(i,u,m));return{c(){e=g("pre"),e.textContent=`${JSON.stringify(i[1],null,"  ")}`,s=b(),t=g("div"),o=P(`OSM nodes:
  `);for(let m=0;m<c.length;m+=1)c[m].c();r=b(),a=g("div"),n=g("button"),n.textContent="Collapse intersection",j(n,"type","button")},m(m,_){d(m,e,_),d(m,s,_),d(m,t,_),h(t,o);for(let f=0;f<c.length;f+=1)c[f]&&c[f].m(t,null);d(m,r,_),d(m,a,_),h(a,n),l||(p=E(n,"click",i[2]),l=!0)},p(m,[_]){if(_&1){u=J(m[0].properties.osm_node_ids);let f;for(f=0;f<u.length;f+=1){const O=R(m,u,f);c[f]?c[f].p(O,_):(c[f]=G(O),c[f].c(),c[f].m(t,null))}for(;f<c.length;f+=1)c[f].d(1);c.length=u.length}},i:I,o:I,d(m){m&&($(e),$(s),$(t),$(r),$(a)),Z(c,m),l=!1,p()}}}function ve(i,e,s){let t;S(i,M,n=>s(3,t=n));let{intersection:o}=e,r=structuredClone(o.properties);delete r.osm_node_ids;function a(){t.collapseIntersection(o.properties.id),M.set(t)}return i.$$set=n=>{"intersection"in n&&s(0,o=n.intersection)},[o,r,a]}class Ce extends T{constructor(e){super(),A(this,e,ve,ke,D,{intersection:0})}}function z(i,e,s){const t=i.slice();return t[5]=e[s],t}function B(i){let e,s=i[5]+"",t,o,r;return{c(){e=g("a"),t=P(s),r=P(","),j(e,"href",o="https://www.openstreetmap.org/way/"+i[5]),j(e,"target","_blank")},m(a,n){d(a,e,n),h(e,t),d(a,r,n)},p(a,n){n&1&&s!==(s=a[5]+"")&&K(t,s),n&1&&o!==(o="https://www.openstreetmap.org/way/"+a[5])&&j(e,"href",o)},d(a){a&&($(e),$(r))}}}function Le(i){let e,s,t,o,r,a,n,l,p,u,c,m=J(i[0].properties.osm_way_ids),_=[];for(let f=0;f<m.length;f+=1)_[f]=B(z(i,m,f));return{c(){e=g("pre"),e.textContent=`${JSON.stringify(i[1],null,"  ")}`,s=b(),t=g("div"),o=P(`OSM ways:
  `);for(let f=0;f<_.length;f+=1)_[f].c();r=b(),a=g("div"),n=g("button"),n.textContent="Collapse short road",l=b(),p=g("button"),p.textContent="Zip side-path",j(n,"type","button"),j(p,"type","button")},m(f,O){d(f,e,O),d(f,s,O),d(f,t,O),h(t,o);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(t,null);d(f,r,O),d(f,a,O),h(a,n),h(a,l),h(a,p),u||(c=[E(n,"click",i[2]),E(p,"click",i[3])],u=!0)},p(f,[O]){if(O&1){m=J(f[0].properties.osm_way_ids);let w;for(w=0;w<m.length;w+=1){const N=z(f,m,w);_[w]?_[w].p(N,O):(_[w]=B(N),_[w].c(),_[w].m(t,null))}for(;w<_.length;w+=1)_[w].d(1);_.length=m.length}},i:I,o:I,d(f){f&&($(e),$(s),$(t),$(r),$(a)),Z(_,f),u=!1,Y(c)}}}function Se(i,e,s){let t;S(i,M,l=>s(4,t=l));let{lane:o}=e,r=structuredClone(o.properties);delete r.osm_way_ids;function a(){t.collapseShortRoad(o.properties.rod),M.set(t)}function n(){t.zipSidepath(o.properties.rod),M.set(t)}return i.$$set=l=>{"lane"in l&&s(0,o=l.lane)},[o,r,a,n]}class je extends T{constructor(e){super(),A(this,e,Se,Le,D,{lane:0})}}function Oe(i,e,s){let t,o,r;S(i,X,n=>s(0,t=n)),S(i,re,n=>s(1,o=n)),S(i,oe,n=>s(2,r=n));let a=new W.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});return x(()=>{a.remove()}),i.$$.update=()=>{if(i.$$.dirty&7)if(r){let n=document.createElement("div");new je({target:n,props:{lane:r}});let l=r.geometry.coordinates[0][0];a.setLngLat(l).setDOMContent(n).addTo(t)}else if(o){let n=document.createElement("div");new Ce({target:n,props:{intersection:o}});let l=o.geometry.coordinates[0][0];a.setLngLat(l).setDOMContent(n).addTo(t)}else a.remove()},[t,o,r]}class Ie extends T{constructor(e){super(),A(this,e,Oe,null,D,{})}}function Me(i){let e,s,t,o,r,a,n,l,p;return o=new se({}),l=new le({}),{c(){e=g("div"),s=g("h1"),s.textContent="osm2streets Street Explorer",t=b(),y(o.$$.fragment),r=b(),a=g("hr"),n=b(),y(l.$$.fragment),j(e,"slot","left")},m(u,c){d(u,e,c),h(e,s),h(e,t),k(o,e,null),h(e,r),h(e,a),h(e,n),k(l,e,null),p=!0},p:I,i(u){p||(v(o.$$.fragment,u),v(l.$$.fragment,u),p=!0)},o(u){C(o.$$.fragment,u),C(l.$$.fragment,u),p=!1},d(u){u&&$(e),L(o),L(l)}}}function Te(i){let e,s,t,o,r,a;return e=new pe({}),r=new be({}),{c(){y(e.$$.fragment),s=b(),t=g("hr"),o=b(),y(r.$$.fragment)},m(n,l){k(e,n,l),d(n,s,l),d(n,t,l),d(n,o,l),k(r,n,l),a=!0},p:I,i(n){a||(v(e.$$.fragment,n),v(r.$$.fragment,n),a=!0)},o(n){C(e.$$.fragment,n),C(r.$$.fragment,n),a=!1},d(n){n&&($(s),$(t),$(o)),L(e,n),L(r,n)}}}function Ae(i){let e,s,t,o;return e=new fe({props:{$$slots:{default:[Te]},$$scope:{ctx:i}}}),t=new Ie({}),{c(){y(e.$$.fragment),s=b(),y(t.$$.fragment)},m(r,a){k(e,r,a),d(r,s,a),k(t,r,a),o=!0},p(r,a){const n={};a&1&&(n.$$scope={dirty:a,ctx:r}),e.$set(n)},i(r){o||(v(e.$$.fragment,r),v(t.$$.fragment,r),o=!0)},o(r){C(e.$$.fragment,r),C(t.$$.fragment,r),o=!1},d(r){r&&$(s),L(e,r),L(t,r)}}}function De(i){let e,s,t;return s=new ie({props:{$$slots:{default:[Ae]},$$scope:{ctx:i}}}),{c(){e=g("div"),y(s.$$.fragment),j(e,"slot","main")},m(o,r){d(o,e,r),k(s,e,null),t=!0},p(o,r){const a={};r&1&&(a.$$scope={dirty:r,ctx:o}),s.$set(a)},i(o){t||(v(s.$$.fragment,o),t=!0)},o(o){C(s.$$.fragment,o),t=!1},d(o){o&&$(e),L(s)}}}function Pe(i){let e,s;return e=new ee({props:{$$slots:{main:[De],left:[Me]},$$scope:{ctx:i}}}),{c(){y(e.$$.fragment)},m(t,o){k(e,t,o),s=!0},p(t,[o]){const r={};o&1&&(r.$$scope={dirty:o,ctx:t}),e.$set(r)},i(t){s||(v(e.$$.fragment,t),s=!0)},o(t){C(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function Ee(i){return te(async()=>{await ae()}),[]}class Je extends T{constructor(e){super(),A(this,e,Ee,Pe,D,{})}}new Je({target:document.getElementById("app")});
