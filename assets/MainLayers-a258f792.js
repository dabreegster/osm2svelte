import{S as J,i as q,s as V,l as k,n as B,D as oe,O as Ke,e as A,p as w,P as Te,q as U,r as Q,h as P,y as Pe,Q as Qe,R as ne,o as G,t as L,G as Ye,g as M,H as xe,A as Be,u as je,z as ze,J as et,K as tt,M as nt,N as rt,b as N,T as ot,U as st,d as F,V as it,W as lt,a as X,c as E,m as $,f as Z,j as D,k as z,x as Je}from"./OverpassSelector-3c22d5e3.js";let u;const K=new Array(128).fill(void 0);K.push(void 0,null,!0,!1);function v(n){return K[n]}let fe=K.length;function at(n){n<132||(K[n]=fe,fe=n)}function he(n){const e=v(n);return at(n),e}const qe=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});qe.decode();let ae=null;function we(){return(ae===null||ae.byteLength===0)&&(ae=new Uint8Array(u.memory.buffer)),ae}function O(n,e){return qe.decode(we().subarray(n,n+e))}function R(n){fe===K.length&&K.push(K.length+1);const e=fe;return fe=K[e],K[e]=n,e}function Se(n){return n==null}let _e=null;function _t(){return(_e===null||_e.byteLength===0)&&(_e=new Float64Array(u.memory.buffer)),_e}let ue=null;function y(){return(ue===null||ue.byteLength===0)&&(ue=new Int32Array(u.memory.buffer)),ue}let ee=0;const ye=new TextEncoder("utf-8"),ut=typeof ye.encodeInto=="function"?function(n,e){return ye.encodeInto(n,e)}:function(n,e){const r=ye.encode(n);return e.set(r),{read:n.length,written:r.length}};function se(n,e,r){if(r===void 0){const _=ye.encode(n),i=e(_.length);return we().subarray(i,i+_.length).set(_),ee=_.length,i}let t=n.length,o=e(t);const s=we();let l=0;for(;l<t;l++){const _=n.charCodeAt(l);if(_>127)break;s[o+l]=_}if(l!==t){l!==0&&(n=n.slice(l)),o=r(o,t,t=l+n.length*3);const _=we().subarray(o+l,o+t),i=ut(n,_);l+=i.written}return ee=l,o}function Ce(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const o=n.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=n.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(n)){const o=n.length;let s="[";o>0&&(s+=Ce(n[0]));for(let l=1;l<o;l++)s+=", "+Ce(n[l]);return s+="]",s}const r=/\[object ([^\]]+)\]/.exec(toString.call(n));let t;if(r.length>1)t=r[1];else return toString.call(n);if(t=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:t}let ce=null;function ct(){return(ce===null||ce.byteLength===0)&&(ce=new Uint32Array(u.memory.buffer)),ce}function ft(n,e){const t=ct().subarray(n/4,n/4+e),o=[];for(let s=0;s<t.length;s++)o.push(he(t[s]));return o}function re(n,e){try{return n.apply(this,e)}catch(r){u.__wbindgen_exn_store(R(r))}}class Re{static __wrap(e){const r=Object.create(Re.prototype);return r.ptr=e,r}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();u.__wbg_jsdebugstreets_free(e)}getLabel(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsdebugstreets_getLabel(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}getNetwork(){const e=u.jsdebugstreets_getNetwork(this.ptr);return he(e)}toDebugGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsdebugstreets_toDebugGeojson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];let o;return e!==0&&(o=O(e,r).slice(),u.__wbindgen_free(e,r*1)),o}finally{u.__wbindgen_add_to_stack_pointer(16)}}}class de{static __wrap(e){const r=Object.create(de.prototype);return r.ptr=e,r}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();u.__wbg_jsstreetnetwork_free(e)}constructor(e,r,t){try{const _=u.__wbindgen_add_to_stack_pointer(-16),i=se(e,u.__wbindgen_malloc,u.__wbindgen_realloc),a=ee,d=se(r,u.__wbindgen_malloc,u.__wbindgen_realloc),c=ee;u.jsstreetnetwork_new(_,i,a,d,c,R(t));var o=y()[_/4+0],s=y()[_/4+1],l=y()[_/4+2];if(l)throw he(s);return de.__wrap(o)}finally{u.__wbindgen_add_to_stack_pointer(16)}}toGeojsonPlain(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toGeojsonPlain(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}toLanePolygonsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toLanePolygonsGeojson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}toLaneMarkingsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toLaneMarkingsGeojson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}toIntersectionMarkingsGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toIntersectionMarkingsGeojson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}toGraphviz(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toGraphviz(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}getDebugSteps(){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getDebugSteps(o,this.ptr);var e=y()[o/4+0],r=y()[o/4+1],t=ft(e,r).slice();return u.__wbindgen_free(e,r*4),t}finally{u.__wbindgen_add_to_stack_pointer(16)}}debugClockwiseOrderingGeojson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugClockwiseOrderingGeojson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}debugClockwiseOrderingForIntersectionGeojson(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugClockwiseOrderingForIntersectionGeojson(o,this.ptr,e);var r=y()[o/4+0],t=y()[o/4+1];return O(r,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,t)}}debugMovementsFromLaneGeojson(e,r){try{const s=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugMovementsFromLaneGeojson(s,this.ptr,e,r);var t=y()[s/4+0],o=y()[s/4+1];return O(t,o)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(t,o)}}debugRoadsConnectedToIntersectionGeojson(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_debugRoadsConnectedToIntersectionGeojson(o,this.ptr,e);var r=y()[o/4+0],t=y()[o/4+1];return O(r,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,t)}}getOsmTagsForWay(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getOsmTagsForWay(o,this.ptr,e);var r=y()[o/4+0],t=y()[o/4+1];return O(r,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,t)}}toJson(){try{const t=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_toJson(t,this.ptr);var e=y()[t/4+0],r=y()[t/4+1];return O(e,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(e,r)}}getGeometryForWay(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_getGeometryForWay(o,this.ptr,e);var r=y()[o/4+0],t=y()[o/4+1];return O(r,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,t)}}wayToXml(e){try{const o=u.__wbindgen_add_to_stack_pointer(-16);u.jsstreetnetwork_wayToXml(o,this.ptr,e);var r=y()[o/4+0],t=y()[o/4+1];return O(r,t)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_free(r,t)}}overwriteOsmTagsForWay(e,r){const t=se(r,u.__wbindgen_malloc,u.__wbindgen_realloc),o=ee;u.jsstreetnetwork_overwriteOsmTagsForWay(this.ptr,e,t,o)}collapseShortRoad(e){u.jsstreetnetwork_collapseShortRoad(this.ptr,e)}collapseIntersection(e){u.jsstreetnetwork_collapseIntersection(this.ptr,e)}zipSidepath(e){u.jsstreetnetwork_zipSidepath(this.ptr,e)}}async function dt(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(t){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const r=await n.arrayBuffer();return await WebAssembly.instantiate(r,e)}else{const r=await WebAssembly.instantiate(n,e);return r instanceof WebAssembly.Instance?{instance:r,module:n}:r}}function gt(){const n={};return n.wbg={},n.wbg.__wbg_jsdebugstreets_new=function(e){const r=Re.__wrap(e);return R(r)},n.wbg.__wbindgen_boolean_get=function(e){const r=v(e);return typeof r=="boolean"?r?1:0:2},n.wbg.__wbindgen_object_drop_ref=function(e){he(e)},n.wbg.__wbindgen_is_object=function(e){const r=v(e);return typeof r=="object"&&r!==null},n.wbg.__wbindgen_is_undefined=function(e){return v(e)===void 0},n.wbg.__wbindgen_in=function(e,r){return v(e)in v(r)},n.wbg.__wbg_jsstreetnetwork_new=function(e){const r=de.__wrap(e);return R(r)},n.wbg.__wbindgen_string_new=function(e,r){const t=O(e,r);return R(t)},n.wbg.__wbindgen_error_new=function(e,r){const t=new Error(O(e,r));return R(t)},n.wbg.__wbindgen_jsval_loose_eq=function(e,r){return v(e)==v(r)},n.wbg.__wbindgen_number_get=function(e,r){const t=v(r),o=typeof t=="number"?t:void 0;_t()[e/8+1]=Se(o)?0:o,y()[e/4+0]=!Se(o)},n.wbg.__wbindgen_string_get=function(e,r){const t=v(r),o=typeof t=="string"?t:void 0;var s=Se(o)?0:se(o,u.__wbindgen_malloc,u.__wbindgen_realloc),l=ee;y()[e/4+1]=l,y()[e/4+0]=s},n.wbg.__wbindgen_object_clone_ref=function(e){const r=v(e);return R(r)},n.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,r){const t=v(e)[v(r)];return R(t)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return R(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,r){const t=v(r).stack,o=se(t,u.__wbindgen_malloc,u.__wbindgen_realloc),s=ee;y()[e/4+1]=s,y()[e/4+0]=o},n.wbg.__wbg_error_f851667af71bcfc6=function(e,r){try{console.error(O(e,r))}finally{u.__wbindgen_free(e,r)}},n.wbg.__wbg_now_c644db5194be8437=function(e){return v(e).now()},n.wbg.__wbg_debug_8db2eed1bf6c1e2a=function(e){console.debug(v(e))},n.wbg.__wbg_error_fe807da27c4a4ced=function(e){console.error(v(e))},n.wbg.__wbg_info_9e6db45ac337c3b5=function(e){console.info(v(e))},n.wbg.__wbg_log_7bb108d119bafbc1=function(e){console.log(v(e))},n.wbg.__wbg_warn_e57696dbb3977030=function(e){console.warn(v(e))},n.wbg.__wbg_newnoargs_2b8b6bd7753c76ba=function(e,r){const t=new Function(O(e,r));return R(t)},n.wbg.__wbg_get_baf4855f9a986186=function(){return re(function(e,r){const t=Reflect.get(v(e),v(r));return R(t)},arguments)},n.wbg.__wbg_call_95d1ea488d03e4e8=function(){return re(function(e,r){const t=v(e).call(v(r));return R(t)},arguments)},n.wbg.__wbg_self_e7c1f827057f6584=function(){return re(function(){const e=self.self;return R(e)},arguments)},n.wbg.__wbg_window_a09ec664e14b1b81=function(){return re(function(){const e=window.window;return R(e)},arguments)},n.wbg.__wbg_globalThis_87cbb8506fecf3a9=function(){return re(function(){const e=globalThis.globalThis;return R(e)},arguments)},n.wbg.__wbg_global_c85a9259e621f3db=function(){return re(function(){const e=global.global;return R(e)},arguments)},n.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(e){let r;try{r=v(e)instanceof ArrayBuffer}catch{r=!1}return r},n.wbg.__wbg_buffer_cf65c07de34b9a08=function(e){const r=v(e).buffer;return R(r)},n.wbg.__wbg_new_537b7341ce90bb31=function(e){const r=new Uint8Array(v(e));return R(r)},n.wbg.__wbg_set_17499e8aa4003ebd=function(e,r,t){v(e).set(v(r),t>>>0)},n.wbg.__wbg_length_27a2afe8ab42b09f=function(e){return v(e).length},n.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(e){let r;try{r=v(e)instanceof Uint8Array}catch{r=!1}return r},n.wbg.__wbindgen_debug_string=function(e,r){const t=Ce(v(r)),o=se(t,u.__wbindgen_malloc,u.__wbindgen_realloc),s=ee;y()[e/4+1]=s,y()[e/4+0]=o},n.wbg.__wbindgen_throw=function(e,r){throw new Error(O(e,r))},n.wbg.__wbindgen_memory=function(){const e=u.memory;return R(e)},n}function bt(n,e){return u=n.exports,pt.__wbindgen_wasm_module=e,_e=null,ue=null,ce=null,ae=null,u}async function pt(n){typeof n>"u"&&(n="/osm2svelte/assets/osm2streets_js_bg.wasm");const e=gt();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:t}=await dt(await n,e);return bt(r,t)}function wt(n){let e,r,t,o,s,l,_,i,a;return{c(){e=k("div"),r=B(`App:
  `),t=k("select"),o=k("option"),o.textContent="Street Explorer",s=k("option"),s.textContent="Lane editor",l=k("option"),l.textContent="Route profile tool",_=k("option"),_.textContent="Road width tool",o.__value="index.html",oe(o,o.__value),s.__value="lane_editor.html",oe(s,s.__value),l.__value="route_profile.html",oe(l,l.__value),_.__value="thicken_roads.html",oe(_,_.__value),n[0]===void 0&&Ke(()=>n[2].call(t))},m(d,c){A(d,e,c),w(e,r),w(e,t),w(t,o),w(t,s),w(t,l),w(t,_),Te(t,n[0],!0),i||(a=[U(t,"change",n[2]),U(t,"change",n[1])],i=!0)},p(d,[c]){c&1&&Te(t,d[0])},i:Q,o:Q,d(d){d&&P(e),i=!1,Pe(a)}}}function yt(n,e,r){let t=window.location.pathname.split("/").pop()||"index.html",o=t;function s(){o!=t&&(window.location.href=o)}function l(){o=Qe(this),r(0,o)}return[o,s,l]}class Kt extends J{constructor(e){super(),q(this,e,yt,wt,V,{})}}const ge=ne(null),te=ne(null),Fe=ne(null),Le=ne(null),Ge=ne(null),Me=ne(null),Oe=ne(null);te.subscribe(n=>{Le.set(null),Ge.set(null),Me.set(null),Oe.set(null)});function Ie(n){let e;const r=n[3].default,t=et(r,n,n[2],null);return{c(){t&&t.c()},m(o,s){t&&t.m(o,s),e=!0},p(o,s){t&&t.p&&(!e||s&4)&&tt(t,r,o,o[2],e?rt(r,o[2],s,null):nt(o[2]),null)},i(o){e||(L(t,o),e=!0)},o(o){M(t,o),e=!1},d(o){t&&t.d(o)}}}function ht(n){let e,r,t=n[1]&&Ie(n);return{c(){e=k("div"),t&&t.c(),G(e,"class","map svelte-12dpf1u")},m(o,s){A(o,e,s),t&&t.m(e,null),n[4](e),r=!0},p(o,[s]){o[1]?t?(t.p(o,s),s&2&&L(t,1)):(t=Ie(o),t.c(),L(t,1),t.m(e,null)):t&&(Ye(),M(t,1,1,()=>{t=null}),xe())},i(o){r||(L(t),r=!0)},o(o){M(t),r=!1},d(o){o&&P(e),t&&t.d(),n[4](null)}}}function mt(n,e,r){let{$$slots:t={},$$scope:o}=e,s,l,_=!1;Be(()=>{s=new je.Map({container:l,style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo",hash:!0}),s.addControl(new je.ScaleControl({})),s.addControl(new je.NavigationControl({}),"bottom-right"),s.on("load",()=>{r(1,_=!0),ge.set(s)}),new ResizeObserver(()=>{s.resize()}).observe(l)}),ze(()=>{s.remove()});function i(a){N[a?"unshift":"push"](()=>{l=a,r(0,l)})}return n.$$set=a=>{"$$scope"in a&&r(2,o=a.$$scope)},[l,_,o,t,i]}class Qt extends J{constructor(e){super(),q(this,e,mt,ht,V,{})}}function Ve(n,e,r){if(n!==null)for(var t,o,s,l,_,i,a,d=0,c=0,b,f=n.type,h=f==="FeatureCollection",C=f==="Feature",S=h?n.features.length:1,m=0;m<S;m++){a=h?n.features[m].geometry:C?n.geometry:n,b=a?a.type==="GeometryCollection":!1,_=b?a.geometries.length:1;for(var I=0;I<_;I++){var g=0,p=0;if(l=b?a.geometries[I]:a,l!==null){i=l.coordinates;var j=l.type;switch(d=r&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(e(i,c,m,g,p)===!1)return!1;c++,g++;break;case"LineString":case"MultiPoint":for(t=0;t<i.length;t++){if(e(i[t],c,m,g,p)===!1)return!1;c++,j==="MultiPoint"&&g++}j==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(t=0;t<i.length;t++){for(o=0;o<i[t].length-d;o++){if(e(i[t][o],c,m,g,p)===!1)return!1;c++}j==="MultiLineString"&&g++,j==="Polygon"&&p++}j==="Polygon"&&g++;break;case"MultiPolygon":for(t=0;t<i.length;t++){for(p=0,o=0;o<i[t].length;o++){for(s=0;s<i[t][o].length-d;s++){if(e(i[t][o][s],c,m,g,p)===!1)return!1;c++}p++}g++}break;case"GeometryCollection":for(t=0;t<l.geometries.length;t++)if(Ve(l.geometries[t],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ae(n){var e=[1/0,1/0,-1/0,-1/0];return Ve(n,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}Ae.default=Ae;function me(n,e,r){let t=["case"];for(let[o,s]of Object.entries(e))t.push(["==",["get",n],o]),t.push(s);return t.push(r),t}function Xe(n,e,r){return["case",["boolean",["feature-state",n],!1],r,e]}function Ue(){return{type:"FeatureCollection",features:[]}}function Ze(n){return Ae(n)}function kt(n){let e=ot(ge),r,t=!1;for(let o=Ne.length-1;o>=0;o--){let s=Ne[o];if(s==n){t=!0;break}e.getLayer(s)&&(r=s)}if(!t)throw new Error(`Layer ID ${n} not defined in layerZorder`);return r}const Ne=["boundary-layer","lane-polygons-layer","intersection-polygons-layer","lane-markings-layer","intersection-markings-layer","movements-layer","connected-roads-layer","road-weights-layer","current-way-layer","building-hitboxes-layer","road_label"];function He(n,e){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),r.setAttribute("download",n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function vt(n){let e,r,t,o,s,l,_,i,a,d,c,b,f,h,C,S,m,I,g,p,j,Y,T,ie,Ee,le,W,$e,ke,ve,De;return ke=st(n[6][0]),{c(){e=k("details"),r=k("summary"),r.textContent="Processing Options",t=F(),o=k("label"),s=k("input"),l=B(`
    Debug each transformation step`),_=F(),i=k("label"),a=k("input"),d=B(`
    Enable dual carriageway experiment`),c=F(),b=k("label"),f=k("input"),h=B(`
    Enable sidepath zipping experiment`),C=F(),S=k("label"),m=k("input"),I=B(`
    Enable osm2lanes experiment`),g=F(),p=k("div"),j=B(`Sidewalks:
    `),Y=k("label"),T=k("input"),ie=B(`
      use mapped footways`),Ee=F(),le=k("label"),W=k("input"),$e=B(`
      infer on roads`),G(r,"class","svelte-fio7ln"),G(s,"type","checkbox"),G(o,"class","svelte-fio7ln"),G(a,"type","checkbox"),G(i,"class","svelte-fio7ln"),G(f,"type","checkbox"),G(b,"class","svelte-fio7ln"),G(m,"type","checkbox"),G(S,"class","svelte-fio7ln"),G(T,"type","radio"),T.__value=!1,oe(T,T.__value),G(Y,"class","svelte-fio7ln"),G(W,"type","radio"),W.__value=!0,oe(W,W.__value),G(le,"class","svelte-fio7ln"),G(p,"class","svelte-fio7ln"),G(e,"class","svelte-fio7ln"),ke.p(T,W)},m(H,x){A(H,e,x),w(e,r),w(e,t),w(e,o),w(o,s),s.checked=n[0].debug_each_step,w(o,l),w(e,_),w(e,i),w(i,a),a.checked=n[0].dual_carriageway_experiment,w(i,d),w(e,c),w(e,b),w(b,f),f.checked=n[0].sidepath_zipping_experiment,w(b,h),w(e,C),w(e,S),w(S,m),m.checked=n[0].osm2lanes,w(S,I),w(e,g),w(e,p),w(p,j),w(p,Y),w(Y,T),T.checked=T.__value===n[0].inferred_sidewalks,w(Y,ie),w(p,Ee),w(p,le),w(le,W),W.checked=W.__value===n[0].inferred_sidewalks,w(le,$e),ve||(De=[U(s,"change",n[1]),U(a,"change",n[2]),U(f,"change",n[3]),U(m,"change",n[4]),U(T,"change",n[5]),U(W,"change",n[7])],ve=!0)},p(H,[x]){x&1&&(s.checked=H[0].debug_each_step),x&1&&(a.checked=H[0].dual_carriageway_experiment),x&1&&(f.checked=H[0].sidepath_zipping_experiment),x&1&&(m.checked=H[0].osm2lanes),x&1&&(T.checked=T.__value===H[0].inferred_sidewalks),x&1&&(W.checked=W.__value===H[0].inferred_sidewalks)},i:Q,o:Q,d(H){H&&P(e),ke.r(),ve=!1,Pe(De)}}}function jt(n,e,r){let{settings:t={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1,osm2lanes:!1}}=e;const o=[[]];function s(){t.debug_each_step=this.checked,r(0,t)}function l(){t.dual_carriageway_experiment=this.checked,r(0,t)}function _(){t.sidepath_zipping_experiment=this.checked,r(0,t)}function i(){t.osm2lanes=this.checked,r(0,t)}function a(){t.inferred_sidewalks=this.__value,r(0,t)}function d(){t.inferred_sidewalks=this.__value,r(0,t)}return n.$$set=c=>{"settings"in c&&r(0,t=c.settings)},[t,s,l,_,i,a,o,d]}class St extends J{constructor(e){super(),q(this,e,jt,vt,V,{settings:0})}}function Ct(n){let e,r,t,o,s,l,_,i;return{c(){e=k("div"),r=k("button"),r.textContent="Update OSM data",t=F(),o=k("button"),o.textContent="Download osm.xml",s=F(),l=k("button"),l.textContent="Reset view",G(r,"type","button"),G(o,"type","button"),G(l,"type","button")},m(a,d){A(a,e,d),w(e,r),w(e,t),w(e,o),w(e,s),w(e,l),_||(i=[U(r,"click",n[6]),U(o,"click",n[5]),U(l,"click",n[7])],_=!0)},p:Q,d(a){a&&P(e),_=!1,Pe(i)}}}function Ft(n){let e,r,t=n[2].msg+"",o;return{c(){e=k("p"),r=B("Error: "),o=B(t)},m(s,l){A(s,e,l),w(e,r),w(e,o)},p(s,l){l&4&&t!==(t=s[2].msg+"")&&Je(o,t)},d(s){s&&P(e)}}}function Lt(n){let e;return{c(){e=k("p"),e.textContent="Use the polygon tool to select an area to import"},m(r,t){A(r,e,t)},p:Q,d(r){r&&P(e)}}}function Gt(n){let e,r,t,o,s,l,_,i,a,d,c,b={map:n[4]};e=new it({props:b}),n[11](e),e.$on("load",n[8]),e.$on("resetToNone",n[9]),e.$on("error",n[10]);function f(p){n[12](p)}let h={};n[1]!==void 0&&(h.testCase=n[1]),s=new lt({props:h}),N.push(()=>X(s,"testCase",f)),s.$on("load",n[8]),s.$on("resetToNone",n[9]),s.$on("error",n[10]);function C(p,j){if(p[2].kind==="nothing")return Lt;if(p[2].kind==="error")return Ft;if(p[2].kind==="done")return Ct}let S=C(n),m=S&&S(n);function I(p){n[13](p)}let g={};return n[0]!==void 0&&(g.settings=n[0]),a=new St({props:g}),N.push(()=>X(a,"settings",I)),{c(){E(e.$$.fragment),r=F(),t=k("fieldset"),o=k("legend"),E(s.$$.fragment),_=F(),m&&m.c(),i=F(),E(a.$$.fragment)},m(p,j){$(e,p,j),A(p,r,j),A(p,t,j),w(t,o),$(s,o,null),w(t,_),m&&m.m(t,null),A(p,i,j),$(a,p,j),c=!0},p(p,[j]){const Y={};j&16&&(Y.map=p[4]),e.$set(Y);const T={};!l&&j&2&&(l=!0,T.testCase=p[1],Z(()=>l=!1)),s.$set(T),S===(S=C(p))&&m?m.p(p,j):(m&&m.d(1),m=S&&S(p),m&&(m.c(),m.m(t,null)));const ie={};!d&&j&1&&(d=!0,ie.settings=p[0],Z(()=>d=!1)),a.$set(ie)},i(p){c||(L(e.$$.fragment,p),L(s.$$.fragment,p),L(a.$$.fragment,p),c=!0)},o(p){M(e.$$.fragment,p),M(s.$$.fragment,p),M(a.$$.fragment,p),c=!1},d(p){p&&(P(r),P(t),P(i)),n[11](null),D(e,p),D(s),m&&m.d(),D(a,p)}}}function Mt(n,e,r){let t;z(n,ge,g=>r(4,t=g));let o={kind:"nothing"},s,l,_=new URLSearchParams(window.location.search).get("test")||"none";function i(g){o.kind=="done"&&g&&(console.log("Settings changed, re-importing"),a(o.osmXml,o.boundaryGj))}function a(g,p){try{let j=new de(g,JSON.stringify(p),s);r(2,o={kind:"done",boundaryGj:p,osmXml:g,network:j}),te.set(o.network),Fe.set(o.boundaryGj)}catch(j){r(2,o={kind:"error",msg:j.toString()})}}function d(){o.kind==="done"&&He("osm.xml",o.osmXml)}function c(){o.kind==="done"&&l.importPolygon(o.boundaryGj)}function b(){o.kind==="done"&&t.fitBounds(Ze(o.boundaryGj),{animate:!1,padding:10})}function f(g){a(g.detail.osmXml,g.detail.boundaryGj),r(1,_=g.detail.testCase)}function h(g){r(2,o={kind:"nothing"}),te.set(null),Fe.set(null)}function C(g){r(2,o={kind:"error",msg:g.detail})}function S(g){N[g?"unshift":"push"](()=>{l=g,r(3,l)})}function m(g){_=g,r(1,_)}function I(g){s=g,r(0,s)}return n.$$.update=()=>{if(n.$$.dirty&1&&i(s),n.$$.dirty&2){let g=new URL(window.location);_!="none"?g.searchParams.set("test",_):g.searchParams.delete("test"),window.history.pushState({},"",g)}},[s,_,o,l,t,d,c,b,f,h,C,S,m,I]}class Yt extends J{constructor(e){super(),q(this,e,Mt,Gt,V,{})}}function Ot(n,e,r){let t;z(n,ge,g=>r(7,t=g));let{source:o}=e,{show:s=!0}=e,{gj:l}=e,{layerStyle:_}=e,{interactive:i=!1}=e,{hoveredFeature:a=null}=e,{clickedFeature:d=null}=e,c,b,f=`${o}-layer`;Be(()=>{h(),t.addSource(o,{type:"geojson",data:l??Ue()}),t.addLayer({id:f,source:o,..._},kt(f)),s||t.setLayoutProperty(f,"visibility","none"),i&&(t.on("mousemove",f,C),t.on("mouseleave",f,S),t.on("click",m))}),ze(()=>{i&&(t.off("mousemove",C),t.off("mouseleave",S),t.off("click",m),I()),t.getLayer(f)&&t.removeLayer(f),t.removeSource(o)});function h(){if(l&&"features"in l)for(let[g,p]of l.features.entries())p.id=g+1}function C(g){g.features.length>0&&c!=g.features[0].id&&(I(),c=g.features[0].id,t.setFeatureState({source:o,id:c},{hover:!0}),"features"in l&&r(0,a=l.features.find(p=>p.id==c)))}function S(){I(),r(0,a=null),c=void 0}function m(g){d!==null&&t.setFeatureState({source:o,id:b},{clicked:!1});let p=t.queryRenderedFeatures(g.point,{layers:[f]});p.length==1?(b=p[0].id,t.setFeatureState({source:o,id:b},{clicked:!0}),"features"in l&&r(1,d=l.features.find(j=>j.id==b))):(r(1,d=null),b=void 0)}function I(){c!==void 0&&t.setFeatureState({source:o,id:c},{hover:!1})}return n.$$set=g=>{"source"in g&&r(2,o=g.source),"show"in g&&r(3,s=g.show),"gj"in g&&r(4,l=g.gj),"layerStyle"in g&&r(5,_=g.layerStyle),"interactive"in g&&r(6,i=g.interactive),"hoveredFeature"in g&&r(0,a=g.hoveredFeature),"clickedFeature"in g&&r(1,d=g.clickedFeature)},n.$$.update=()=>{if(n.$$.dirty&148){let g=t.getSource(o);g&&(console.log(`GeoJSON data for ${o} changed, updating`),h(),g.setData(l??Ue()),r(0,a=null),c=void 0,r(1,d=null),b=void 0)}n.$$.dirty&136&&t.getLayer(f)&&t.setLayoutProperty(f,"visibility",s?"visible":"none")},[a,d,o,s,l,_,i,t]}class be extends J{constructor(e){super(),q(this,e,Ot,null,V,{source:2,show:3,gj:4,layerStyle:5,interactive:6,hoveredFeature:0,clickedFeature:1})}}function We(n){let e,r,t,o,s;return{c(){e=k("button"),r=B("Download"),G(e,"type","button"),e.disabled=t=!n[1]},m(l,_){A(l,e,_),w(e,r),o||(s=U(e,"click",n[4]),o=!0)},p(l,_){_&2&&t!==(t=!l[1])&&(e.disabled=t)},d(l){l&&P(e),o=!1,s()}}}function At(n){let e,r,t,o,s,l,_,i,a=n[3]&&We(n);return{c(){e=k("div"),r=k("label"),t=k("input"),o=F(),s=B(n[2]),l=F(),a&&a.c(),G(t,"type","checkbox")},m(d,c){A(d,e,c),w(e,r),w(r,t),t.checked=n[0],w(r,o),w(r,s),w(e,l),a&&a.m(e,null),_||(i=U(t,"change",n[5]),_=!0)},p(d,[c]){c&1&&(t.checked=d[0]),c&4&&Je(s,d[2]),d[3]?a?a.p(d,c):(a=We(d),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:Q,o:Q,d(d){d&&P(e),a&&a.d(),_=!1,i()}}}function Pt(n,e,r){let{gj:t}=e,{name:o}=e,{show:s}=e,{downloadable:l=!0}=e;function _(){He(`${o}.geojson`,JSON.stringify(t))}function i(){s=this.checked,r(0,s)}return n.$$set=a=>{"gj"in a&&r(1,t=a.gj),"name"in a&&r(2,o=a.name),"show"in a&&r(0,s=a.show),"downloadable"in a&&r(3,l=a.downloadable)},[s,t,o,l,_,i]}class pe extends J{constructor(e){super(),q(this,e,Pt,At,V,{gj:1,name:2,show:0,downloadable:3})}}function Rt(n){let e,r,t,o,s;e=new be({props:{source:"boundary",gj:n[0],layerStyle:n[2],show:n[1]}});function l(i){n[5](i)}let _={gj:n[0],name:"Boundary"};return n[1]!==void 0&&(_.show=n[1]),t=new pe({props:_}),N.push(()=>X(t,"show",l)),{c(){E(e.$$.fragment),r=F(),E(t.$$.fragment)},m(i,a){$(e,i,a),A(i,r,a),$(t,i,a),s=!0},p(i,[a]){const d={};a&1&&(d.gj=i[0]),a&2&&(d.show=i[1]),e.$set(d);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],Z(()=>o=!1)),t.$set(c)},i(i){s||(L(e.$$.fragment,i),L(t.$$.fragment,i),s=!0)},o(i){M(e.$$.fragment,i),M(t.$$.fragment,i),s=!1},d(i){i&&P(r),D(e,i),D(t,i)}}}function Et(n,e,r){let t,o;z(n,ge,a=>r(3,t=a)),z(n,Fe,a=>r(4,o=a));let s,l=!0,_={type:"line",paint:{"line-color":"blue","line-width":4}};function i(a){l=a,r(1,l)}return n.$$.update=()=>{n.$$.dirty&25&&(o?(r(0,s=structuredClone(o)),t.fitBounds(Ze(s),{animate:!1,padding:10})):r(0,s=void 0))},[s,l,_,t,o,i]}class $t extends J{constructor(e){super(),q(this,e,Et,Rt,V,{})}}function Dt(n){let e,r,t,o,s;e=new be({props:{source:"intersection-markings",gj:n[0],layerStyle:n[2],show:n[1]}});function l(i){n[4](i)}let _={gj:n[0],name:"Intersection markings"};return n[1]!==void 0&&(_.show=n[1]),t=new pe({props:_}),N.push(()=>X(t,"show",l)),{c(){E(e.$$.fragment),r=F(),E(t.$$.fragment)},m(i,a){$(e,i,a),A(i,r,a),$(t,i,a),s=!0},p(i,[a]){const d={};a&1&&(d.gj=i[0]),a&2&&(d.show=i[1]),e.$set(d);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],Z(()=>o=!1)),t.$set(c)},i(i){s||(L(e.$$.fragment,i),L(t.$$.fragment,i),s=!0)},o(i){M(e.$$.fragment,i),M(t.$$.fragment,i),s=!1},d(i){i&&P(r),D(e,i),D(t,i)}}}function Tt(n,e,r){let t;z(n,te,i=>r(3,t=i));let o,s=!0,l={type:"fill",paint:{"fill-color":me("type",{"sidewalk corner":"#CCCCCC"},"red"),"fill-opacity":.9}};function _(i){s=i,r(1,s)}return n.$$.update=()=>{n.$$.dirty&8&&(t?r(0,o=JSON.parse(t.toIntersectionMarkingsGeojson())):r(0,o=void 0))},[o,s,l,t,_]}class It extends J{constructor(e){super(),q(this,e,Tt,Dt,V,{})}}function Ut(n){let e,r,t,o,s,l,_;function i(f){n[6](f)}function a(f){n[7](f)}let d={source:"intersection-polygons",gj:n[0],layerStyle:n[4],interactive:!0,show:n[1]};n[2]!==void 0&&(d.hoveredFeature=n[2]),n[3]!==void 0&&(d.clickedFeature=n[3]),e=new be({props:d}),N.push(()=>X(e,"hoveredFeature",i)),N.push(()=>X(e,"clickedFeature",a));function c(f){n[8](f)}let b={gj:n[0],name:"Intersection polygons"};return n[1]!==void 0&&(b.show=n[1]),s=new pe({props:b}),N.push(()=>X(s,"show",c)),{c(){E(e.$$.fragment),o=F(),E(s.$$.fragment)},m(f,h){$(e,f,h),A(f,o,h),$(s,f,h),_=!0},p(f,[h]){const C={};h&1&&(C.gj=f[0]),h&2&&(C.show=f[1]),!r&&h&4&&(r=!0,C.hoveredFeature=f[2],Z(()=>r=!1)),!t&&h&8&&(t=!0,C.clickedFeature=f[3],Z(()=>t=!1)),e.$set(C);const S={};h&1&&(S.gj=f[0]),!l&&h&2&&(l=!0,S.show=f[1],Z(()=>l=!1)),s.$set(S)},i(f){_||(L(e.$$.fragment,f),L(s.$$.fragment,f),_=!0)},o(f){M(e.$$.fragment,f),M(s.$$.fragment,f),_=!1},d(f){f&&P(o),D(e,f),D(s,f)}}}function Nt(n,e,r){let t,o,s;z(n,te,b=>r(5,t=b)),z(n,Me,b=>r(2,o=b)),z(n,Oe,b=>r(3,s=b));let l,_=!0,i={type:"fill",filter:["==",["get","type"],"intersection"],paint:{"fill-color":me("intersection_kind",{Connection:"#666",Intersection:"#966",Terminus:"#999",MapEdge:"#696"},"#666"),"fill-opacity":Xe("hover",.9,.4)}};function a(b){o=b,Me.set(o)}function d(b){s=b,Oe.set(s)}function c(b){_=b,r(1,_)}return n.$$.update=()=>{n.$$.dirty&32&&(t?r(0,l=JSON.parse(t.toGeojsonPlain())):r(0,l=void 0))},[l,_,o,s,i,t,a,d,c]}class Wt extends J{constructor(e){super(),q(this,e,Nt,Ut,V,{})}}function Bt(n){let e,r,t,o,s;e=new be({props:{source:"lane-markings",gj:n[0],layerStyle:n[2],show:n[1]}});function l(i){n[4](i)}let _={gj:n[0],name:"Lane markings "};return n[1]!==void 0&&(_.show=n[1]),t=new pe({props:_}),N.push(()=>X(t,"show",l)),{c(){E(e.$$.fragment),r=F(),E(t.$$.fragment)},m(i,a){$(e,i,a),A(i,r,a),$(t,i,a),s=!0},p(i,[a]){const d={};a&1&&(d.gj=i[0]),a&2&&(d.show=i[1]),e.$set(d);const c={};a&1&&(c.gj=i[0]),!o&&a&2&&(o=!0,c.show=i[1],Z(()=>o=!1)),t.$set(c)},i(i){s||(L(e.$$.fragment,i),L(t.$$.fragment,i),s=!0)},o(i){M(e.$$.fragment,i),M(t.$$.fragment,i),s=!1},d(i){i&&P(r),D(e,i),D(t,i)}}}function zt(n,e,r){let t;z(n,te,i=>r(3,t=i));let o,s=!0,l={type:"fill",paint:{"fill-color":me("type",{"center line":"yellow","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};function _(i){s=i,r(1,s)}return n.$$.update=()=>{n.$$.dirty&8&&(t?r(0,o=JSON.parse(t.toLaneMarkingsGeojson())):r(0,o=void 0))},[o,s,l,t,_]}class Jt extends J{constructor(e){super(),q(this,e,zt,Bt,V,{})}}function qt(n){let e,r,t,o,s,l,_;function i(f){n[6](f)}function a(f){n[7](f)}let d={source:"lane-polygons",gj:n[0],layerStyle:n[4],interactive:!0,show:n[1]};n[2]!==void 0&&(d.clickedFeature=n[2]),n[3]!==void 0&&(d.hoveredFeature=n[3]),e=new be({props:d}),N.push(()=>X(e,"clickedFeature",i)),N.push(()=>X(e,"hoveredFeature",a));function c(f){n[8](f)}let b={gj:n[0],name:"Lane polygons"};return n[1]!==void 0&&(b.show=n[1]),s=new pe({props:b}),N.push(()=>X(s,"show",c)),{c(){E(e.$$.fragment),o=F(),E(s.$$.fragment)},m(f,h){$(e,f,h),A(f,o,h),$(s,f,h),_=!0},p(f,[h]){const C={};h&1&&(C.gj=f[0]),h&2&&(C.show=f[1]),!r&&h&4&&(r=!0,C.clickedFeature=f[2],Z(()=>r=!1)),!t&&h&8&&(t=!0,C.hoveredFeature=f[3],Z(()=>t=!1)),e.$set(C);const S={};h&1&&(S.gj=f[0]),!l&&h&2&&(l=!0,S.show=f[1],Z(()=>l=!1)),s.$set(S)},i(f){_||(L(e.$$.fragment,f),L(s.$$.fragment,f),_=!0)},o(f){M(e.$$.fragment,f),M(s.$$.fragment,f),_=!1},d(f){f&&P(o),D(e,f),D(s,f)}}}function Vt(n,e,r){let t,o,s;z(n,te,b=>r(5,t=b)),z(n,Le,b=>r(2,o=b)),z(n,Ge,b=>r(3,s=b));let l,_=!0,i={type:"fill",paint:{"fill-color":me("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":Xe("hover",.9,.4)}};function a(b){o=b,Le.set(o)}function d(b){s=b,Ge.set(s)}function c(b){_=b,r(1,_)}return n.$$.update=()=>{n.$$.dirty&32&&(t?r(0,l=JSON.parse(t.toLanePolygonsGeojson())):r(0,l=void 0))},[l,_,o,s,i,t,a,d,c]}class Xt extends J{constructor(e){super(),q(this,e,Vt,qt,V,{})}}function Zt(n){let e,r,t,o,s,l,_,i,a,d;return e=new $t({}),t=new Wt({}),s=new It({}),_=new Xt({}),a=new Jt({}),{c(){E(e.$$.fragment),r=F(),E(t.$$.fragment),o=F(),E(s.$$.fragment),l=F(),E(_.$$.fragment),i=F(),E(a.$$.fragment)},m(c,b){$(e,c,b),A(c,r,b),$(t,c,b),A(c,o,b),$(s,c,b),A(c,l,b),$(_,c,b),A(c,i,b),$(a,c,b),d=!0},p:Q,i(c){d||(L(e.$$.fragment,c),L(t.$$.fragment,c),L(s.$$.fragment,c),L(_.$$.fragment,c),L(a.$$.fragment,c),d=!0)},o(c){M(e.$$.fragment,c),M(t.$$.fragment,c),M(s.$$.fragment,c),M(_.$$.fragment,c),M(a.$$.fragment,c),d=!1},d(c){c&&(P(r),P(o),P(l),P(i)),D(e,c),D(t,c),D(s,c),D(_,c),D(a,c)}}}class xt extends J{constructor(e){super(),q(this,e,null,Zt,V,{})}}export{Kt as A,Yt as I,be as L,Qt as M,pe as a,Ge as b,Oe as c,Le as d,xt as e,He as f,Ue as g,Me as h,pt as i,Xe as j,ge as m,te as n};
