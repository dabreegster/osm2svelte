import{S as N,i as A,s as I,l as g,m as G,n as w,p as W,a as h,r as y,w as J,x as P,E as L,d as k,F as j,f as q,J as x,K as ee,B as Q,M as te,C as F,o as C,e as U,v as E,g as V,b,c as Y,t as v,z as S,j as Z,L as ne,I as le,k as re,y as oe}from"./OverpassSelector-a1b80286.js";import{n as D,f as se,a as ae,g as ie,b as H,A as ue,I as fe,M as pe,i as ce,L as de,d as _e}from"./ImportControls-fddb5cd0.js";function me(r){let e,n=r[0].size+"",t,l,o,s,u,c;return{c(){e=g("div"),t=G(n),l=G(" ways edited"),o=w(),s=g("button"),s.textContent="Download .osc",W(s,"type","button")},m(d,_){h(d,e,_),y(e,t),y(e,l),h(d,o,_),h(d,s,_),u||(c=J(s,"click",r[1]),u=!0)},p(d,[_]){_&1&&n!==(n=d[0].size+"")&&P(t,n)},i:L,o:L,d(d){d&&(k(e),k(o),k(s)),u=!1,c()}}}function ye(r,e,n){let t;j(r,D,u=>n(3,t=u));let l=new Set;function o(u){l.add(u.detail),n(0,l)}function s(){let u=`<osmChange version="0.6" generator="osm2streets">
`;u+=`<create/>
`,u+=`<modify>
`;for(let c of l)u+=t.wayToXml(c),u+=`
`;u+=`</modify>
`,u+="</osmChange>",se("lane_edits.osc",u)}return[l,s,o]}class ge extends N{constructor(e){super(),A(this,e,ye,me,I,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function K(r,e,n){const t=r.slice();return t[11]=e[n],t[12]=e,t[13]=n,t}function R(r,e){let n,t,l,o,s,u,c,d,_,a,p,i;function f(){e[5].call(l,e[12],e[13])}function m(){e[6].call(u,e[12],e[13])}function M(){return e[7](e[11])}return{key:r,first:null,c(){n=g("tr"),t=g("td"),l=g("input"),o=w(),s=g("td"),u=g("input"),c=w(),d=g("td"),_=g("button"),_.textContent="Delete",a=w(),W(l,"type","text"),W(u,"type","text"),W(_,"type","button"),this.first=n},m(O,T){h(O,n,T),y(n,t),y(t,l),F(l,e[11].key),y(n,o),y(n,s),y(s,u),F(u,e[11].value),y(n,c),y(n,d),y(d,_),y(n,a),p||(i=[J(l,"input",f),J(u,"input",m),J(_,"click",M)],p=!0)},p(O,T){e=O,T&1&&l.value!==e[11].key&&F(l,e[11].key),T&1&&u.value!==e[11].value&&F(u,e[11].value)},d(O){O&&k(n),p=!1,Q(i)}}}function he(r){let e,n,t=[],l=new Map,o,s,u,c,d,_,a=q(r[0]);const p=i=>i[11].id;for(let i=0;i<a.length;i+=1){let f=K(r,a,i),m=p(f);l.set(m,t[i]=R(m,f))}return{c(){e=g("table"),n=g("tbody");for(let i=0;i<t.length;i+=1)t[i].c();o=w(),s=g("button"),s.textContent="Add new tag",u=w(),c=g("button"),c.textContent="Recalculate",W(s,"type","button"),W(c,"type","button")},m(i,f){h(i,e,f),y(e,n);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(n,null);h(i,o,f),h(i,s,f),h(i,u,f),h(i,c,f),d||(_=[J(s,"click",r[2]),J(c,"click",r[3])],d=!0)},p(i,[f]){f&3&&(a=q(i[0]),t=x(t,f,p,1,i,a,l,n,ee,R,null,K))},i:L,o:L,d(i){i&&(k(e),k(o),k(s),k(u),k(c));for(let f=0;f<t.length;f+=1)t[f].d();d=!1,Q(_)}}}function ke(r,e,n){let t;j(r,D,f=>n(9,t=f));let l=te(),{way:o}=e,s=[],u=0;for(let[f,m]of Object.entries(JSON.parse(t.getOsmTagsForWay(o))))s.push({id:u++,key:f,value:m});function c(f){n(0,s=s.filter(m=>m.id!=f))}function d(){s.push({id:u++,key:"",value:""}),n(0,s)}function _(){let f={};for(let m of s)m.key&&m.value&&(f[m.key]=m.value);t.overwriteOsmTagsForWay(o,JSON.stringify(f)),D.set(t),l("editedWay",o)}function a(f,m){f[m].key=this.value,n(0,s)}function p(f,m){f[m].value=this.value,n(0,s)}const i=f=>c(f.id);return r.$$set=f=>{"way"in f&&n(4,o=f.way)},[s,c,d,_,o,a,p,i]}class $e extends N{constructor(e){super(),A(this,e,ke,he,I,{way:4})}}function we(r){let e;return{c(){e=G("Click a road to edit")},m(n,t){h(n,e,t)},p:L,i:L,o:L,d(n){n&&k(e)}}}function be(r){let e,n,t,l,o,s,u,c=r[0],d,_;s=new ie({props:{source:"current-way",gj:r[2],layerStyle:r[3]}});let a=X(r);return{c(){e=g("a"),n=G("Way "),t=G(r[0]),o=w(),C(s.$$.fragment),u=w(),a.c(),d=U(),W(e,"href",l="http://openstreetmap.org/way/"+r[0]),W(e,"target","_blank")},m(p,i){h(p,e,i),y(e,n),y(e,t),h(p,o,i),E(s,p,i),h(p,u,i),a.m(p,i),h(p,d,i),_=!0},p(p,i){(!_||i&1)&&P(t,p[0]),(!_||i&1&&l!==(l="http://openstreetmap.org/way/"+p[0]))&&W(e,"href",l);const f={};i&4&&(f.gj=p[2]),s.$set(f),i&1&&I(c,c=p[0])?(V(),b(a,1,1,L),Y(),a=X(p),a.c(),v(a,1),a.m(d.parentNode,d)):a.p(p,i)},i(p){_||(v(s.$$.fragment,p),v(a),_=!0)},o(p){b(s.$$.fragment,p),b(a),_=!1},d(p){p&&(k(e),k(o),k(u),k(d)),S(s,p),a.d(p)}}}function X(r){let e,n;return e=new $e({props:{way:r[0]}}),e.$on("editedWay",r[7]),{c(){C(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.way=t[0]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){S(e,t)}}}function ve(r){let e,n,t,l,o,s,u={};e=new ge({props:u}),r[6](e);const c=[be,we],d=[];function _(a,p){return a[0]?0:1}return t=_(r),l=d[t]=c[t](r),{c(){C(e.$$.fragment),n=w(),l.c(),o=U()},m(a,p){E(e,a,p),h(a,n,p),d[t].m(a,p),h(a,o,p),s=!0},p(a,[p]){const i={};e.$set(i);let f=t;t=_(a),t===f?d[t].p(a,p):(V(),b(d[f],1,1,()=>{d[f]=null}),Y(),l=d[t],l?l.p(a,p):(l=d[t]=c[t](a),l.c()),v(l,1),l.m(o.parentNode,o))},i(a){s||(v(e.$$.fragment,a),v(l),s=!0)},o(a){b(e.$$.fragment,a),b(l),s=!1},d(a){a&&(k(n),k(o)),r[6](null),S(e,a),d[t].d(a)}}}function We(r,e,n){let t,l;j(r,D,a=>n(4,t=a)),j(r,ae,a=>n(5,l=a));let o,s,u,c={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function d(a){Z[a?"unshift":"push"](()=>{o=a,n(1,o)})}const _=a=>o.handleEditedWay(a);return r.$$.update=()=>{r.$$.dirty&49&&(n(0,s=null),n(2,u=null),l?l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(n(0,s=BigInt(l.properties.osm_way_ids[0])),n(2,u=JSON.parse(t.getGeometryForWay(s)))):(n(0,s=null),n(2,u=null)))},[s,o,u,c,t,l,d,_]}class Ce extends N{constructor(e){super(),A(this,e,We,ve,I,{})}}function Ee(r){let e,n,t,l,o,s,u,c,d,_,a,p,i,f,m,M;l=new ue({});function O($){r[4]($)}let T={};return r[0]!==void 0&&(T.imported=r[0]),c=new fe({props:T}),Z.push(()=>re(c,"imported",O)),i=new Ce({}),{c(){e=g("div"),n=g("h1"),n.textContent="osm2streets lane editor",t=w(),C(l.$$.fragment),o=w(),s=g("hr"),u=w(),C(c.$$.fragment),_=w(),a=g("hr"),p=w(),C(i.$$.fragment),f=w(),m=g("div"),m.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m($,B){h($,e,B),y(e,n),y(e,t),E(l,e,null),y(e,o),y(e,s),y(e,u),E(c,e,null),y(e,_),y(e,a),y(e,p),E(i,e,null),y(e,f),y(e,m),M=!0},p($,B){const z={};!d&&B&1&&(d=!0,z.imported=$[0],oe(()=>d=!1)),c.$set(z)},i($){M||(v(l.$$.fragment,$),v(c.$$.fragment,$),v(i.$$.fragment,$),M=!0)},o($){b(l.$$.fragment,$),b(c.$$.fragment,$),b(i.$$.fragment,$),M=!1},d($){$&&k(e),S(l),S(c),S(i)}}}function Se(r){let e,n;return e=new de({props:{layers:r[1],showControls:!1}}),{c(){C(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p(t,l){const o={};l&2&&(o.layers=t[1]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){S(e,t)}}}function Le(r){let e,n,t;return n=new pe({props:{$$slots:{default:[Se]},$$scope:{ctx:r}}}),{c(){e=g("div"),C(n.$$.fragment),W(e,"slot","main")},m(l,o){h(l,e,o),E(n,e,null),t=!0},p(l,o){const s={};o&34&&(s.$$scope={dirty:o,ctx:l}),n.$set(s)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){b(n.$$.fragment,l),t=!1},d(l){l&&k(e),S(n)}}}function Oe(r){let e,n;return e=new ne({props:{$$slots:{main:[Le],left:[Ee]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment)},m(t,l){E(e,t,l),n=!0},p(t,[l]){const o={};l&35&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){S(e,t)}}}function Te(r,e,n){let t,l;j(r,H,c=>n(2,t=c)),j(r,D,c=>n(3,l=c));let o={kind:"nothing"},s=[];le(async()=>{await ce()});function u(c){o=c,n(0,o)}return r.$$.update=()=>{r.$$.dirty&1&&o.kind=="done"&&(D.set(o.network),H.set(o.boundaryGJ)),r.$$.dirty&12&&l&&t&&n(1,s=_e(l,t))},[o,s,t,l,u]}class Me extends N{constructor(e){super(),A(this,e,Te,Oe,I,{})}}new Me({target:document.getElementById("app")});
