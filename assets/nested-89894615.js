import{S as N,i as B,s as D,l as g,n as M,d as k,o as W,e as $,p as y,q as T,x as H,r as C,h,k as A,v as q,B as Q,y as R,C as U,D as I,E as V,c as E,F as X,m as S,G as K,g as b,H as P,t as v,j as L,b as Y,L as Z,A as x,I as ee}from"./OverpassSelector-5e168ca4.js";import{n as F,f as te,d as ne,L as le,A as re,I as se,M as ae,i as oe,e as ie}from"./MainLayers-0bd72852.js";function ue(o){let e,n=o[0].size+"",t,l,a,r,f,p;return{c(){e=g("div"),t=M(n),l=M(" ways edited"),a=k(),r=g("button"),r.textContent="Download .osc",W(r,"type","button")},m(d,_){$(d,e,_),y(e,t),y(e,l),$(d,a,_),$(d,r,_),f||(p=T(r,"click",o[1]),f=!0)},p(d,[_]){_&1&&n!==(n=d[0].size+"")&&H(t,n)},i:C,o:C,d(d){d&&(h(e),h(a),h(r)),f=!1,p()}}}function fe(o,e,n){let t;A(o,F,f=>n(3,t=f));let l=new Set;function a(f){l.add(f.detail),n(0,l)}function r(){let f=`<osmChange version="0.6" generator="osm2streets">
`;f+=`<create/>
`,f+=`<modify>
`;for(let p of l)f+=t.wayToXml(p),f+=`
`;f+=`</modify>
`,f+="</osmChange>",te("lane_edits.osc",f)}return[l,r,a]}class ce extends N{constructor(e){super(),B(this,e,fe,ue,D,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function G(o,e,n){const t=o.slice();return t[11]=e[n],t[12]=e,t[13]=n,t}function J(o,e){let n,t,l,a,r,f,p,d,_,s,i,c;function u(){e[5].call(l,e[12],e[13])}function m(){e[6].call(f,e[12],e[13])}function w(){return e[7](e[11])}return{key:o,first:null,c(){n=g("tr"),t=g("td"),l=g("input"),a=k(),r=g("td"),f=g("input"),p=k(),d=g("td"),_=g("button"),_.textContent="Delete",s=k(),W(l,"type","text"),W(f,"type","text"),W(_,"type","button"),this.first=n},m(O,j){$(O,n,j),y(n,t),y(t,l),I(l,e[11].key),y(n,a),y(n,r),y(r,f),I(f,e[11].value),y(n,p),y(n,d),y(d,_),y(n,s),i||(c=[T(l,"input",u),T(f,"input",m),T(_,"click",w)],i=!0)},p(O,j){e=O,j&1&&l.value!==e[11].key&&I(l,e[11].key),j&1&&f.value!==e[11].value&&I(f,e[11].value)},d(O){O&&h(n),i=!1,R(c)}}}function de(o){let e,n,t=[],l=new Map,a,r,f,p,d,_,s=q(o[0]);const i=c=>c[11].id;for(let c=0;c<s.length;c+=1){let u=G(o,s,c),m=i(u);l.set(m,t[c]=J(m,u))}return{c(){e=g("table"),n=g("tbody");for(let c=0;c<t.length;c+=1)t[c].c();a=k(),r=g("button"),r.textContent="Add new tag",f=k(),p=g("button"),p.textContent="Recalculate",W(r,"type","button"),W(p,"type","button")},m(c,u){$(c,e,u),y(e,n);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(n,null);$(c,a,u),$(c,r,u),$(c,f,u),$(c,p,u),d||(_=[T(r,"click",o[2]),T(p,"click",o[3])],d=!0)},p(c,[u]){u&3&&(s=q(c[0]),t=Q(t,u,i,1,c,s,l,n,V,J,null,G))},i:C,o:C,d(c){c&&(h(e),h(a),h(r),h(f),h(p));for(let u=0;u<t.length;u+=1)t[u].d();d=!1,R(_)}}}function pe(o,e,n){let t;A(o,F,u=>n(9,t=u));let l=U(),{way:a}=e,r=[],f=0;for(let[u,m]of Object.entries(JSON.parse(t.getOsmTagsForWay(a))))r.push({id:f++,key:u,value:m});function p(u){n(0,r=r.filter(m=>m.id!=u))}function d(){r.push({id:f++,key:"",value:""}),n(0,r)}function _(){let u={};for(let m of r)m.key&&m.value&&(u[m.key]=m.value);t.overwriteOsmTagsForWay(a,JSON.stringify(u)),F.set(t),l("editedWay",a)}function s(u,m){u[m].key=this.value,n(0,r)}function i(u,m){u[m].value=this.value,n(0,r)}const c=u=>p(u.id);return o.$$set=u=>{"way"in u&&n(4,a=u.way)},[r,p,d,_,a,s,i,c]}class _e extends N{constructor(e){super(),B(this,e,pe,de,D,{way:4})}}function me(o){let e;return{c(){e=M("Click a road to edit")},m(n,t){$(n,e,t)},p:C,i:C,o:C,d(n){n&&h(e)}}}function ye(o){let e,n,t,l,a,r,f,p=o[0],d,_;r=new le({props:{source:"current-way",gj:o[2],layerStyle:o[3]}});let s=z(o);return{c(){e=g("a"),n=M("Way "),t=M(o[0]),a=k(),E(r.$$.fragment),f=k(),s.c(),d=X(),W(e,"href",l="http://openstreetmap.org/way/"+o[0]),W(e,"target","_blank")},m(i,c){$(i,e,c),y(e,n),y(e,t),$(i,a,c),S(r,i,c),$(i,f,c),s.m(i,c),$(i,d,c),_=!0},p(i,c){(!_||c&1)&&H(t,i[0]),(!_||c&1&&l!==(l="http://openstreetmap.org/way/"+i[0]))&&W(e,"href",l);const u={};c&4&&(u.gj=i[2]),r.$set(u),c&1&&D(p,p=i[0])?(K(),b(s,1,1,C),P(),s=z(i),s.c(),v(s,1),s.m(d.parentNode,d)):s.p(i,c)},i(i){_||(v(r.$$.fragment,i),v(s),_=!0)},o(i){b(r.$$.fragment,i),b(s),_=!1},d(i){i&&(h(e),h(a),h(f),h(d)),L(r,i),s.d(i)}}}function z(o){let e,n;return e=new _e({props:{way:o[0]}}),e.$on("editedWay",o[7]),{c(){E(e.$$.fragment)},m(t,l){S(e,t,l),n=!0},p(t,l){const a={};l&1&&(a.way=t[0]),e.$set(a)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ge(o){let e,n,t,l,a,r,f={};e=new ce({props:f}),o[6](e);const p=[ye,me],d=[];function _(s,i){return s[0]?0:1}return t=_(o),l=d[t]=p[t](o),{c(){E(e.$$.fragment),n=k(),l.c(),a=X()},m(s,i){S(e,s,i),$(s,n,i),d[t].m(s,i),$(s,a,i),r=!0},p(s,[i]){const c={};e.$set(c);let u=t;t=_(s),t===u?d[t].p(s,i):(K(),b(d[u],1,1,()=>{d[u]=null}),P(),l=d[t],l?l.p(s,i):(l=d[t]=p[t](s),l.c()),v(l,1),l.m(a.parentNode,a))},i(s){r||(v(e.$$.fragment,s),v(l),r=!0)},o(s){b(e.$$.fragment,s),b(l),r=!1},d(s){s&&(h(n),h(a)),o[6](null),L(e,s),d[t].d(s)}}}function $e(o,e,n){let t,l;A(o,F,s=>n(4,t=s)),A(o,ne,s=>n(5,l=s));let a,r,f,p={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function d(s){Y[s?"unshift":"push"](()=>{a=s,n(1,a)})}const _=s=>a.handleEditedWay(s);return o.$$.update=()=>{o.$$.dirty&49&&(n(0,r=null),n(2,f=null),l?l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(n(0,r=BigInt(l.properties.osm_way_ids[0])),n(2,f=JSON.parse(t.getGeometryForWay(r)))):(n(0,r=null),n(2,f=null)))},[r,a,f,p,t,l,d,_]}class he extends N{constructor(e){super(),B(this,e,$e,ge,D,{})}}function ke(o){let e,n,t,l,a,r,f,p,d,_,s,i,c,u,m;return l=new re({}),p=new se({}),i=new he({}),{c(){e=g("div"),n=g("h1"),n.textContent="osm2streets lane editor",t=k(),E(l.$$.fragment),a=k(),r=g("hr"),f=k(),E(p.$$.fragment),d=k(),_=g("hr"),s=k(),E(i.$$.fragment),c=k(),u=g("div"),u.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m(w,O){$(w,e,O),y(e,n),y(e,t),S(l,e,null),y(e,a),y(e,r),y(e,f),S(p,e,null),y(e,d),y(e,_),y(e,s),S(i,e,null),y(e,c),y(e,u),m=!0},p:C,i(w){m||(v(l.$$.fragment,w),v(p.$$.fragment,w),v(i.$$.fragment,w),m=!0)},o(w){b(l.$$.fragment,w),b(p.$$.fragment,w),b(i.$$.fragment,w),m=!1},d(w){w&&h(e),L(l),L(p),L(i)}}}function we(o){let e,n,t;return n=new ie({}),{c(){e=g("div"),E(n.$$.fragment),ee(e,"display","none")},m(l,a){$(l,e,a),S(n,e,null),t=!0},p:C,i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){b(n.$$.fragment,l),t=!1},d(l){l&&h(e),L(n)}}}function be(o){let e,n,t;return n=new ae({props:{$$slots:{default:[we]},$$scope:{ctx:o}}}),{c(){e=g("div"),E(n.$$.fragment),W(e,"slot","main")},m(l,a){$(l,e,a),S(n,e,null),t=!0},p(l,a){const r={};a&1&&(r.$$scope={dirty:a,ctx:l}),n.$set(r)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){b(n.$$.fragment,l),t=!1},d(l){l&&h(e),L(n)}}}function ve(o){let e,n;return e=new Z({props:{$$slots:{main:[be],left:[ke]},$$scope:{ctx:o}}}),{c(){E(e.$$.fragment)},m(t,l){S(e,t,l),n=!0},p(t,[l]){const a={};l&1&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function We(o){return x(async()=>{await oe()}),[]}class Ce extends N{constructor(e){super(),B(this,e,We,ve,D,{})}}new Ce({target:document.getElementById("app")});
