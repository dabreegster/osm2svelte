import{S as N,i as T,s as D,b as H,a as W,c as k,d as v,e as m,m as C,t as _,g as Z,f as h,h as K,j as Q,k as d,l as L,n as S,o as w,p as E,q as j,r as b,u as P,v as I,w as U,x as A,y as V,z as X,A as ne,B as re,L as oe,C as se}from"./OverpassSelector-e2a07632.js";import{L as Y,h as x,n as M,a as ee,b as le,m as te,c as ie,d as ae,A as fe,I as ue,M as pe,i as ce,e as me}from"./MainLayers-b96b8113.js";import{T as de}from"./TopLeftPanel-d416be58.js";function R(l){let e,r;return e=new ee({props:{source:"connected-roads",gj:l[0],layerStyle:l[2],show:l[1]}}),{c(){v(e.$$.fragment)},m(n,o){C(e,n,o),r=!0},p(n,o){const t={};o&1&&(t.gj=n[0]),o&2&&(t.show=n[1]),e.$set(t)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){h(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function $e(l){let e,r,n,o,t=l[0]&&R(l);function a(i){l[5](i)}let s={gj:l[0],name:"Roads connected to intersection",downloadable:!1};return l[1]!==void 0&&(s.show=l[1]),r=new Y({props:s}),H.push(()=>W(r,"show",a)),{c(){t&&t.c(),e=k(),v(r.$$.fragment)},m(i,f){t&&t.m(i,f),m(i,e,f),C(r,i,f),o=!0},p(i,[f]){i[0]?t?(t.p(i,f),f&1&&_(t,1)):(t=R(i),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(Z(),h(t,1,1,()=>{t=null}),K());const p={};f&1&&(p.gj=i[0]),!n&&f&2&&(n=!0,p.show=i[1],Q(()=>n=!1)),r.$set(p)},i(i){o||(_(t),_(r.$$.fragment,i),o=!0)},o(i){h(t),h(r.$$.fragment,i),o=!1},d(i){i&&d(e),t&&t.d(i),L(r,i)}}}function _e(l,e,r){let n,o;S(l,x,f=>r(3,n=f)),S(l,M,f=>r(4,o=f));let t,a=!0,s={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(f){a=f,r(1,a)}return l.$$.update=()=>{l.$$.dirty&24&&(o&&n?r(0,t=JSON.parse(o.debugRoadsConnectedToIntersectionGeojson(n.properties.id))):r(0,t=void 0))},[t,a,s,n,o,i]}class ge extends N{constructor(e){super(),T(this,e,_e,$e,D,{})}}function B(l){let e,r;return e=new ee({props:{source:"movements",gj:l[0],layerStyle:l[2],show:l[1]}}),{c(){v(e.$$.fragment)},m(n,o){C(e,n,o),r=!0},p(n,o){const t={};o&1&&(t.gj=n[0]),o&2&&(t.show=n[1]),e.$set(t)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){h(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function we(l){let e,r,n,o,t=l[0]&&B(l);function a(i){l[5](i)}let s={gj:l[0],name:"Movement arrows",downloadable:!1};return l[1]!==void 0&&(s.show=l[1]),r=new Y({props:s}),H.push(()=>W(r,"show",a)),{c(){t&&t.c(),e=k(),v(r.$$.fragment)},m(i,f){t&&t.m(i,f),m(i,e,f),C(r,i,f),o=!0},p(i,[f]){i[0]?t?(t.p(i,f),f&1&&_(t,1)):(t=B(i),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(Z(),h(t,1,1,()=>{t=null}),K());const p={};f&1&&(p.gj=i[0]),!n&&f&2&&(n=!0,p.show=i[1],Q(()=>n=!1)),r.$set(p)},i(i){o||(_(t),_(r.$$.fragment,i),o=!0)},o(i){h(t),h(r.$$.fragment,i),o=!1},d(i){i&&d(e),t&&t.d(i),L(r,i)}}}function he(l,e,r){let n,o;S(l,M,f=>r(3,n=f)),S(l,le,f=>r(4,o=f));let t,a=!0,s={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(f){a=f,r(1,a)}return l.$$.update=()=>{if(l.$$.dirty&24)if(n&&o){let f=o.properties;r(0,t=JSON.parse(n.debugMovementsFromLaneGeojson(f.road,f.index)))}else r(0,t=void 0)},[t,a,s,n,o,i]}class ye extends N{constructor(e){super(),T(this,e,he,we,D,{})}}function be(l){let e,r,n,o,t,a;return{c(){e=w("div"),r=w("label"),n=w("input"),o=E(`
    Clockwise ordering of roads`),j(n,"type","checkbox")},m(s,i){m(s,e,i),b(e,r),b(r,n),n.checked=l[0],b(r,o),t||(a=P(n,"change",l[5]),t=!0)},p(s,[i]){i&1&&(n.checked=s[0])},i:I,o:I,d(s){s&&d(e),t=!1,a()}}}function ke(l,e,r){let n,o,t;S(l,te,f=>r(2,n=f)),S(l,x,f=>r(3,o=f)),S(l,M,f=>r(4,t=f));let a=[],s=!1;function i(){s=this.checked,r(0,s)}return l.$$.update=()=>{if(l.$$.dirty&31){for(let f of a)f.remove();if(r(1,a=[]),s&&o){let f=JSON.parse(t.debugClockwiseOrderingForIntersectionGeojson(o.properties.id));for(let p of f.features)a.push(new U.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1}).setLngLat(p.geometry.coordinates).setHTML(p.properties.label).addTo(n))}}},[s,a,n,o,t,i]}class ve extends N{constructor(e){super(),T(this,e,ke,be,D,{})}}function Ce(l){let e,r,n,o,t,a;return e=new ye({}),n=new ve({}),t=new ge({}),{c(){v(e.$$.fragment),r=k(),v(n.$$.fragment),o=k(),v(t.$$.fragment)},m(s,i){C(e,s,i),m(s,r,i),C(n,s,i),m(s,o,i),C(t,s,i),a=!0},p:I,i(s){a||(_(e.$$.fragment,s),_(n.$$.fragment,s),_(t.$$.fragment,s),a=!0)},o(s){h(e.$$.fragment,s),h(n.$$.fragment,s),h(t.$$.fragment,s),a=!1},d(s){s&&(d(r),d(o)),L(e,s),L(n,s),L(t,s)}}}class Le extends N{constructor(e){super(),T(this,e,null,Ce,D,{})}}function G(l,e,r){const n=l.slice();return n[4]=e[r],n}function z(l){let e,r=l[4]+"",n,o,t;return{c(){e=w("a"),n=E(r),t=E(","),j(e,"href",o="https://www.openstreetmap.org/node/"+l[4]),j(e,"target","_blank")},m(a,s){m(a,e,s),b(e,n),m(a,t,s)},p(a,s){s&1&&r!==(r=a[4]+"")&&X(n,r),s&1&&o!==(o="https://www.openstreetmap.org/node/"+a[4])&&j(e,"href",o)},d(a){a&&(d(e),d(t))}}}function Se(l){let e,r,n,o,t,a,s,i,f,p=A(l[0].properties.osm_node_ids),g=[];for(let c=0;c<p.length;c+=1)g[c]=z(G(l,p,c));return{c(){e=w("pre"),e.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=k(),n=w("div"),o=E(`OSM nodes:
  `);for(let c=0;c<g.length;c+=1)g[c].c();t=k(),a=w("div"),s=w("button"),s.textContent="Collapse intersection",j(s,"type","button")},m(c,$){m(c,e,$),m(c,r,$),m(c,n,$),b(n,o);for(let u=0;u<g.length;u+=1)g[u]&&g[u].m(n,null);m(c,t,$),m(c,a,$),b(a,s),i||(f=P(s,"click",l[2]),i=!0)},p(c,[$]){if($&1){p=A(c[0].properties.osm_node_ids);let u;for(u=0;u<p.length;u+=1){const O=G(c,p,u);g[u]?g[u].p(O,$):(g[u]=z(O),g[u].c(),g[u].m(n,null))}for(;u<g.length;u+=1)g[u].d(1);g.length=p.length}},i:I,o:I,d(c){c&&(d(e),d(r),d(n),d(t),d(a)),V(g,c),i=!1,f()}}}function je(l,e,r){let n;S(l,M,s=>r(3,n=s));let{intersection:o}=e,t=structuredClone(o.properties);delete t.osm_node_ids;function a(){n.collapseIntersection(o.properties.id),M.set(n)}return l.$$set=s=>{"intersection"in s&&r(0,o=s.intersection)},[o,t,a]}class Oe extends N{constructor(e){super(),T(this,e,je,Se,D,{intersection:0})}}function q(l,e,r){const n=l.slice();return n[5]=e[r],n}function F(l){let e,r=l[5]+"",n,o,t;return{c(){e=w("a"),n=E(r),t=E(","),j(e,"href",o="https://www.openstreetmap.org/way/"+l[5]),j(e,"target","_blank")},m(a,s){m(a,e,s),b(e,n),m(a,t,s)},p(a,s){s&1&&r!==(r=a[5]+"")&&X(n,r),s&1&&o!==(o="https://www.openstreetmap.org/way/"+a[5])&&j(e,"href",o)},d(a){a&&(d(e),d(t))}}}function Ie(l){let e,r,n,o,t,a,s,i,f,p,g,c=A(l[0].properties.osm_way_ids),$=[];for(let u=0;u<c.length;u+=1)$[u]=F(q(l,c,u));return{c(){e=w("pre"),e.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=k(),n=w("div"),o=E(`OSM ways:
  `);for(let u=0;u<$.length;u+=1)$[u].c();t=k(),a=w("div"),s=w("button"),s.textContent="Collapse short road",i=k(),f=w("button"),f.textContent="Zip side-path",j(s,"type","button"),j(f,"type","button")},m(u,O){m(u,e,O),m(u,r,O),m(u,n,O),b(n,o);for(let y=0;y<$.length;y+=1)$[y]&&$[y].m(n,null);m(u,t,O),m(u,a,O),b(a,s),b(a,i),b(a,f),p||(g=[P(s,"click",l[2]),P(f,"click",l[3])],p=!0)},p(u,[O]){if(O&1){c=A(u[0].properties.osm_way_ids);let y;for(y=0;y<c.length;y+=1){const J=q(u,c,y);$[y]?$[y].p(J,O):($[y]=F(J),$[y].c(),$[y].m(n,null))}for(;y<$.length;y+=1)$[y].d(1);$.length=c.length}},i:I,o:I,d(u){u&&(d(e),d(r),d(n),d(t),d(a)),V($,u),p=!1,ne(g)}}}function Me(l,e,r){let n;S(l,M,i=>r(4,n=i));let{lane:o}=e,t=structuredClone(o.properties);delete t.osm_way_ids;function a(){n.collapseShortRoad(o.properties.rod),M.set(n)}function s(){n.zipSidepath(o.properties.rod),M.set(n)}return l.$$set=i=>{"lane"in i&&r(0,o=i.lane)},[o,t,a,s]}class Ne extends N{constructor(e){super(),T(this,e,Me,Ie,D,{lane:0})}}function Te(l,e,r){let n,o,t;S(l,te,s=>r(0,n=s)),S(l,ie,s=>r(1,o=s)),S(l,ae,s=>r(2,t=s));let a=new U.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});return re(()=>{a.remove()}),l.$$.update=()=>{if(l.$$.dirty&7)if(t){let s=document.createElement("div");new Ne({target:s,props:{lane:t}});let i=t.geometry.coordinates[0][0];a.setLngLat(i).setDOMContent(s).addTo(n)}else if(o){let s=document.createElement("div");new Oe({target:s,props:{intersection:o}});let i=o.geometry.coordinates[0][0];a.setLngLat(i).setDOMContent(s).addTo(n)}else a.remove()},[n,o,t]}class De extends N{constructor(e){super(),T(this,e,Te,null,D,{})}}function Ee(l){let e,r,n,o,t,a,s,i,f;return o=new fe({}),i=new ue({}),{c(){e=w("div"),r=w("h1"),r.textContent="osm2streets Street Explorer",n=k(),v(o.$$.fragment),t=k(),a=w("hr"),s=k(),v(i.$$.fragment),j(e,"slot","left")},m(p,g){m(p,e,g),b(e,r),b(e,n),C(o,e,null),b(e,t),b(e,a),b(e,s),C(i,e,null),f=!0},p:I,i(p){f||(_(o.$$.fragment,p),_(i.$$.fragment,p),f=!0)},o(p){h(o.$$.fragment,p),h(i.$$.fragment,p),f=!1},d(p){p&&d(e),L(o),L(i)}}}function Pe(l){let e,r,n,o,t,a;return e=new me({}),t=new Le({}),{c(){v(e.$$.fragment),r=k(),n=w("hr"),o=k(),v(t.$$.fragment)},m(s,i){C(e,s,i),m(s,r,i),m(s,n,i),m(s,o,i),C(t,s,i),a=!0},p:I,i(s){a||(_(e.$$.fragment,s),_(t.$$.fragment,s),a=!0)},o(s){h(e.$$.fragment,s),h(t.$$.fragment,s),a=!1},d(s){s&&(d(r),d(n),d(o)),L(e,s),L(t,s)}}}function Ae(l){let e,r,n,o;return e=new de({props:{$$slots:{default:[Pe]},$$scope:{ctx:l}}}),n=new De({}),{c(){v(e.$$.fragment),r=k(),v(n.$$.fragment)},m(t,a){C(e,t,a),m(t,r,a),C(n,t,a),o=!0},p(t,a){const s={};a&1&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(t){o||(_(e.$$.fragment,t),_(n.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),h(n.$$.fragment,t),o=!1},d(t){t&&d(r),L(e,t),L(n,t)}}}function Je(l){let e,r,n;return r=new pe({props:{$$slots:{default:[Ae]},$$scope:{ctx:l}}}),{c(){e=w("div"),v(r.$$.fragment),j(e,"slot","main")},m(o,t){m(o,e,t),C(r,e,null),n=!0},p(o,t){const a={};t&1&&(a.$$scope={dirty:t,ctx:o}),r.$set(a)},i(o){n||(_(r.$$.fragment,o),n=!0)},o(o){h(r.$$.fragment,o),n=!1},d(o){o&&d(e),L(r)}}}function Re(l){let e,r;return e=new oe({props:{$$slots:{main:[Je],left:[Ee]},$$scope:{ctx:l}}}),{c(){v(e.$$.fragment)},m(n,o){C(e,n,o),r=!0},p(n,[o]){const t={};o&1&&(t.$$scope={dirty:o,ctx:n}),e.$set(t)},i(n){r||(_(e.$$.fragment,n),r=!0)},o(n){h(e.$$.fragment,n),r=!1},d(n){L(e,n)}}}function Be(l){return se(async()=>{await ce()}),[]}class Ge extends N{constructor(e){super(),T(this,e,Be,Re,D,{})}}new Ge({target:document.getElementById("app")});
